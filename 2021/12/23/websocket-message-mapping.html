<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://babal.dev/assets/css/syntax.css"><link rel="stylesheet" href="https://babal.dev/assets/css/table_of_content.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> WebSocket @MessageMapping - A0__oN</title><link rel="shortcut icon" href="https://babal.dev/favicon.png"><link rel="alternate" type="application/atom+xml" title="A0__oN" href="https://babal.dev/atom.xml"><link rel="alternate" type="application/json" title="A0__oN" href="https://babal.dev/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://babal.dev/sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,300;1,400;1,500;1,600;1,700;1,900&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--highlight-text-color: #6cb4a0;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--text-font: Play;--source-code-font: Source Code Pro;--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--highlight-text-color: #6cb4a0;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 125);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:var(--text-font),monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{font-family:var(--source-code-font),monospace;margin:unset;padding:0.1rem;color:var(--highlight-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:5.5rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:2rem;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;margin-bottom:1.5rem;font-size:2rem}h2{font-size:1.8rem}h3{font-size:1.6rem}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.post ul{margin:0px;margin:0px 0px 10px 10px}.post ol{margin:0px;margin:0px 0px 10px 15px}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}.highlight{margin:0px}main{display:flex;max-width:55rem;margin:-5rem auto 0;padding:2.4rem 2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:3rem}section.posts{margin-top:1rem}section.notes{margin-top:0;margin-bottom:2rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}#search-results li::before{content:"›";display:inline-block;margin-left:-1.3em;width:1.3em;color:var(--main-text-color)}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;margin:-6em auto;padding:1px;list-style-type:none;width:100%}.timeline:before{position:absolute;left:50%;content:' ';display:block;width:6px;margin-left:-3px;background:var(--light-text-color);z-index:5;height:150%}.timeline li{padding:2em 0}.timeline li::after{content:"";display:block;clear:both;visibility:hidden}.direction-l{position:relative;float:none;width:100%;text-align:center}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .time-wrapper{float:none}.direction-r{position:relative;float:none;width:100%;text-align:center}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .time-wrapper{float:none}.flag-wrapper{position:relative;display:inline-block;text-align:center}.flag-wrapper .flag{position:relative;display:inline;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left;background:#fff;z-index:15}.time-wrapper{line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle;display:block;position:relative;margin:4px 0 0 0;z-index:14}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{font-size:0.9em;line-height:1.5em;position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}.desc ul{list-style:circle}.desc ul li{padding:0;margin-left:20px;text-align:left}.pagination{margin-top:3em;display:flex;justify-content:space-between}.text-left-align{text-align:left}pre{white-space:pre;overflow-x:scroll}</style></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-TAG"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-TAG'); </script><body><main><div class="table-of-contents-btn-wrapper"> <button class="table-of-contents-btn" onclick="toggleTableOfContents()"> <i class="fa fa-bars"></i> </button></div><section class="post"><div class="flex-row-between"> <a href="https://babal.dev/">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button> <span class="table-of-contents-btn-spacer"></span></div><time datetime="2021-12-23T00:00:00-05:00">Dec 23, 2021 - 10 ' read </time><h1 class="title"> WebSocket @MessageMapping</h1><span class="meta"> Tags:&nbsp; <a href="https://babal.dev/tag/java">java</a>, <a href="https://babal.dev/tag/kotlin">kotlin</a>, <a href="https://babal.dev/tag/websocket">websocket</a>, <a href="https://babal.dev/tag/spring">spring</a>, <a href="https://babal.dev/tag/spring-boot">spring-boot</a>, <a href="https://babal.dev/tag/reactjs">reactjs</a></span><div class="table-of-content-wrapper"><nav role="navigation"><ul class="summary"><li class="table-of-contents-label">Table Of Contents</li><li> <a href="/2021/12/23/websocket-message-mapping"> WebSocket @MessageMapping </a><ul><li><a href="#tldr"><strong><code class="language-plaintext highlighter-rouge">TL;DR</code></strong></a></li><li><a href="#related-post">Related Post</a></li><li><a href="#messagemapping---process-incoming-data">@MessageMapping - Process incoming data</a></li><li><a href="#reactjs-app-subscribe-to-list-of-room">ReactJS App Subscribe To List Of Room</a></li><li><a href="#rendering-list-of-rooms">Rendering List Of Rooms</a></li><li><a href="#reactjs-app-create-room">ReactJS App Create Room</a></li><li><a href="#reactjs-app-join-room">ReactJS App Join Room</a></li></ul></li></ul></nav></div><h4 id="tldr"> <strong><code class="language-plaintext highlighter-rouge">TL;DR</code></strong> <a href="#tldr">#</a></h4><p><a target="_blank" href="https://github.com/amantuladhar/sse-websocket-reactive-api-kafka/tree/002-simple-chat-box-with-custom-rooms">Source Code</a></p><hr /><p> </p><h4 id="related-post"> Related Post <a href="#related-post">#</a></h4><ul><li><a target="_blank" href="/2021/12/22/websocket-basics-with-spring-boot">Part 1</a> - WebSocket Basics</li><li><a target="_blank" href="/2021/12/23/websocket-message-mapping">Part 2</a> - (Current) WebSocket <code class="language-plaintext highlighter-rouge">@MessageMapping</code></li></ul><h4 id="messagemapping---process-incoming-data"> @MessageMapping - Process incoming data <a href="#messagemapping---process-incoming-data">#</a></h4><p>On our previous post <a target="_blank" href="/2021/12/22/websocket-basics-with-spring-boot">Part 1</a> we create a simple chat app. Let’s extend the app and add ability to create and join rooms.</p><p>In order for us to create a custom room, we need ability to <code class="language-plaintext highlighter-rouge">send()</code> a message and process that message on server. On our previous post, we created a mechanism to <code class="language-plaintext highlighter-rouge">send()</code> a message, but server did not process that message. If you want server to process the message that is received, you need to create a method that is annotated with <code class="language-plaintext highlighter-rouge">@MessageMapping(url)</code>. Any data we send is available on method parameter. One catch is - we need to use <code class="language-plaintext highlighter-rouge">@Payload</code> annotation on parameter</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@MessageMapping</span><span class="p">(</span><span class="s">"$BASE_URL/createRoom"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">createCustomRoom</span><span class="p">(</span><span class="nd">@Payload</span> <span class="n">roomName</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre></div></div><p>Now we can do anything we want with the roomName. For our simple purpose we will create a variable to hold room names.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">roomNames</span><span class="p">:</span> <span class="nc">MutableSet</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nc">HashSet</span><span class="p">()</span>

<span class="nd">@SubscribeMapping</span><span class="p">(</span><span class="nc">BASE_URL</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">broadcastAvailableRooms</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">client</span><span class="p">.</span><span class="nf">convertAndSend</span><span class="p">(</span><span class="nc">BASE_URL</span><span class="p">,</span> <span class="n">roomNames</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">@MessageMapping</span><span class="p">(</span><span class="s">"$BASE_URL/createRoom"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">createCustomRoom</span><span class="p">(</span><span class="nd">@Payload</span> <span class="n">roomName</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">roomNames</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">roomName</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">roomNames</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">roomName</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">broadcastAvailableRooms</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div><p>We will add room to our list if it doesn’t exist, and then we will broadcast all available rooms. Note I modified our <strong>base destination URL</strong> <code class="language-plaintext highlighter-rouge">/ws/simple-chat-box</code> to broadcast list of rooms.</p><h4 id="reactjs-app-subscribe-to-list-of-room"> ReactJS App Subscribe To List Of Room <a href="#reactjs-app-subscribe-to-list-of-room">#</a></h4><p>Let’s update our frontend to allow us to create a room and view the list of rooms. First let’s connect our frontend with backend WebSocket and subscribe to <code class="language-plaintext highlighter-rouge">/ws/simple-chat-box</code> which will broadcast list of rooms.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">onUpdateRoomList</span> <span class="o">=</span> <span class="p">(</span><span class="nx">frame</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setRoomList</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">frame</span><span class="p">.</span><span class="nx">body</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">onWebSocketConnect</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_stompClient</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setStompClient</span><span class="p">(</span><span class="nx">_stompClient</span><span class="p">)</span>
  <span class="nx">_stompClient</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">baseDestinationUrl</span><span class="p">,</span> <span class="nx">onUpdateRoomList</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">_stompClient</span> <span class="o">=</span> <span class="nx">Stomp</span><span class="p">.</span><span class="nx">over</span><span class="p">(</span><span class="nx">SockJS</span><span class="p">(</span><span class="nx">wsConnectUrl</span><span class="p">));</span>
    <span class="nx">_stompClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">({},</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">onWebSocketConnect</span><span class="p">(</span><span class="nx">_stompClient</span><span class="p">))</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div><p> </p><h4 id="rendering-list-of-rooms"> Rendering List Of Rooms <a href="#rendering-list-of-rooms">#</a></h4><p>Displaying the list of room names</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="si">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">roomList</span><span class="si">}</span><span class="p">&gt;</span>
  <span class="si">{</span>
    <span class="nx">roomList</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="p">?</span> <span class="nx">roomList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">room</span> <span class="o">=&gt;</span> <span class="p">(</span>
          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">className</span><span class="p">=</span><span class="si">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">room</span><span class="si">}</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">onClickJoinRoom</span><span class="p">(</span><span class="nx">room</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
            Join <span class="si">{</span><span class="nx">room</span><span class="si">}</span>
          <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">)</span>
      <span class="p">)</span>
      <span class="p">:</span> <span class="p">(</span><span class="dl">"</span><span class="s2">No Chat Rooms</span><span class="dl">"</span><span class="p">)</span>
  <span class="si">}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div></div><p> </p><h4 id="reactjs-app-create-room"> ReactJS App Create Room <a href="#reactjs-app-create-room">#</a></h4><p>Frontend is now subscribed to URL that broadcasts list of room available. Now let’s add UI to allow user to create room. Remember we already have backend code that create a room.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="p">=</span><span class="s">"text"</span>
    <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">createRoomName</span><span class="si">}</span>
    <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">({</span><span class="na">target</span><span class="p">:</span> <span class="p">{</span><span class="nx">value</span><span class="p">}})</span> <span class="o">=&gt;</span> <span class="nx">setCreateRoomName</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">onClickCreateRoom</span><span class="si">}</span><span class="p">&gt;</span>Create Room<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

<span class="kd">const</span> <span class="nx">onClickCreateRoom</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">stompClient</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">baseDestinationUrl</span><span class="p">}</span><span class="s2">/createRoom`</span><span class="p">,</span> <span class="nx">createRoomName</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><p>If you create a room now the UI should auto update.</p><h4 id="reactjs-app-join-room"> ReactJS App Join Room <a href="#reactjs-app-join-room">#</a></h4><p>Now it is time to add ability to join the room. When we implemented a UI to display list of room we also added <code class="language-plaintext highlighter-rouge">onClick</code> handler that calls <code class="language-plaintext highlighter-rouge">onClickJoinRoom</code>.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">onClickJoinRoom</span> <span class="o">=</span> <span class="p">(</span><span class="nx">roomName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">roomSubRef</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">roomSubRef</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">setJoinRoomName</span><span class="p">(</span><span class="nx">roomName</span><span class="p">)</span>
  <span class="nx">setMessages</span><span class="p">([])</span>
  <span class="kd">const</span> <span class="nx">roomRef</span> <span class="o">=</span> <span class="nx">stompClient</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">baseDestinationUrl</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">roomName</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">onUpdateMessagesForRoom</span><span class="p">)</span>
  <span class="nx">setRoomSubRef</span><span class="p">(</span><span class="nx">roomRef</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>Here’s an interesting part, it might look like we are subscribing to endpoint that we did not register on backend. But remember on <a target="_blank" href="/2021/12/22/websocket-basics-with-spring-boot">Part 1</a> I mentioned we can subscribe to any URL we want, it doesn’t need to be registered. We are more or less doing the same thing. But important part here is that we are using baseDestinationUrl as our starting path. Because we registered baseDestinationUrl, any destination URL that client use that is prefixed by baseDestinationUrl can be intercepted by using special annotation like @MessageMapping. baseDestinationUrl/createRoom is one of them. We did not register baseDesUrl/createRoom on our WebSocket configuration, but we were able special behavior to that particular URL because the subscription url was prefixed with baseDestination URl.</p><p>To show the messages we simply display messages content on UI</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Messages for Room: <span class="si">{</span><span class="nx">joinRoomName</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">messages</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">pre</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="p">=</span><span class="s">"text"</span>
           <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">newMessage</span><span class="si">}</span>
           <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">({</span><span class="na">target</span><span class="p">:</span> <span class="p">{</span><span class="nx">value</span><span class="p">}})</span> <span class="o">=&gt;</span> <span class="nx">setNewMessage</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span>
           <span class="na">onKeyDown</span><span class="p">=</span><span class="si">{</span><span class="nx">onKeyDownUserMessage</span><span class="si">}</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div></div><hr /><p>References:</p><ul><li><a target="_blank" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket">Spring Websocket Documentation</a></li></ul></section><section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2021/12/22/websocket-basics-with-spring-boot"><div class="nav-arrow">Previous</div><span class="post-title">WebSocket Basics With Spring Boot And ReactJS</span> </a></nav></section><div id="disqus_thread" class="article-comments"></div><script> (function () { var d = document, s = d.createElement('script'); s.src = 'https://a0on.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <script> function toggleTableOfContents() { var el = document.getElementsByClassName('post')[0]; if (el.classList.contains('with-summary')) { el.classList.remove('with-summary'); } else { el.classList.add("with-summary"); } } </script></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"> <a href="https://github.com/amantuladhar" title="Github profile, nothing much there, yet" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="https://babal.dev/atom.xml" title="Feed RSS" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss" aria-hidden="true"></i></a></div></footer></html>
