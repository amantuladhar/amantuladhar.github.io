<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="https://iosevka-webfonts.github.io/iosevka/Iosevka.css" rel="stylesheet" /><link href=" https://cdn.jsdelivr.net/npm/@fontsource/monaspace-krypton@5.1.0/index.min.css " rel="stylesheet"><link rel="stylesheet" href="https://babal.dev/assets/css/syntax.css"><link rel="stylesheet" href="https://babal.dev/assets/css/table_of_content.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> AngularJS Testing in Nutshell - A0__oN</title><link rel="shortcut icon" href="https://babal.dev/favicon.png"><link rel="alternate" type="application/atom+xml" title="A0__oN" href="https://babal.dev/atom.xml"><link rel="alternate" type="application/json" title="A0__oN" href="https://babal.dev/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="https://babal.dev/sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,300;1,400;1,500;1,600;1,700;1,900&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--text-font: Play;--source-code-font: "Iosevka Web";--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--highlight-text-color: #6cb4a0;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--text-font: Play;--source-code-font: "Iosevka Web";--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--highlight-text-color: #6cb4a0;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 125);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:var(--text-font),monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{font-family:var(--source-code-font),monospace;margin:unset;padding:0.1rem;color:var(--highlight-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:5.5rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:2rem;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;margin-bottom:1.5rem;font-size:2rem}h2{font-size:1.8rem}h3{font-size:1.6rem}h4{font-size:1.4rem}h5{font-size:1.2rem}h6{font-size:1rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.post ul{margin:0px;margin:0px 0px 10px 10px}.post ol{margin:0px;margin:0px 0px 10px 15px}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}.highlight{margin:0px}main{display:flex;max-width:55rem;margin:-5rem auto 0;padding:2.4rem 2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:3rem}section.posts{margin-top:1rem}section.notes{margin-top:0;margin-bottom:2rem}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}#search-results li::before{content:"›";display:inline-block;margin-left:-1.3em;width:1.3em;color:var(--main-text-color)}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;margin:-6em auto;padding:1px;list-style-type:none;width:100%}.timeline:before{position:absolute;left:50%;content:' ';display:block;width:6px;margin-left:-3px;background:var(--light-text-color);z-index:5;height:150%}.timeline li{padding:2em 0}.timeline li::after{content:"";display:block;clear:both;visibility:hidden}.direction-l{position:relative;float:none;width:100%;text-align:center}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .time-wrapper{float:none}.direction-r{position:relative;float:none;width:100%;text-align:center}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .time-wrapper{float:none}.flag-wrapper{position:relative;display:inline-block;text-align:center}.flag-wrapper .flag{position:relative;display:inline;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left;background:#fff;z-index:15}.time-wrapper{line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle;display:block;position:relative;margin:4px 0 0 0;z-index:14}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{font-size:0.9em;line-height:1.5em;position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}.desc ul{list-style:circle}.desc ul li{padding:0;margin-left:20px;text-align:left}.pagination{margin-top:3em;display:flex;justify-content:space-between}.text-left-align{text-align:left}pre{white-space:pre;overflow-x:scroll}</style></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-TAG"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-TAG'); </script><body><main><div class="table-of-contents-btn-wrapper"> <button class="table-of-contents-btn" onclick="toggleTableOfContents()"> <i class="fa fa-bars"></i> </button></div><section class="post"><div class="flex-row-between"> <a href="https://babal.dev/">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button> <span class="table-of-contents-btn-spacer"></span></div><time datetime="2017-07-11T00:00:00-04:00">Jul 11, 2017 - 7 ' read </time><h1 class="title"> AngularJS Testing in Nutshell</h1><span class="meta"> Tags:&nbsp; <a href="https://babal.dev/tag/javascript">javascript</a>, <a href="https://babal.dev/tag/angular">angular</a></span><div class="table-of-content-wrapper"><nav role="navigation"><ul class="summary"><li class="table-of-contents-label">Table Of Contents</li><li> <a href="/2017/07/11/angularjs-testing-in-nutshell"> AngularJS Testing in Nutshell </a><ul><li><a href="#karma">Karma</a></li><li><a href="#jasmine">Jasmine</a></li><li><a href="#testing-controller">Testing Controller</a></li><li><a href="#testing-services">Testing Services</a></li><li><a href="#testing-directive">Testing Directive</a></li><li><a href="#testing-directive-with-templateurl">Testing Directive with templateUrl</a></li><li><a href="#bonus---to-run-single-test-on-karma-using-intellij-idea">Bonus - To run single test on <code class="language-plaintext highlighter-rouge">Karma</code> using IntelliJ Idea</a><ul><li><a href="#update">Update</a></li></ul></li></ul></li></ul></li></ul></nav></div><p>In this post I will talk about AngularJS testing. This will be quick and easy guide to get up and running with AngularJS testing. This post cover basics of :</p><ul><li>Karma</li><li>Jasmine</li><li>Testing Controller</li><li>Testing Services (<code class="language-plaintext highlighter-rouge">http</code> request)</li><li>Testing Directive</li></ul><hr /><h1 id="karma"> Karma <a href="#karma">#</a></h1><ul><li>Is a command line tool that can be used to spawn a web server which loads your application’s source code and executes your tests.</li><li>Configurable : Can be configured to run against a number of browsers, which is useful for being confident that your application works on all browsers you need to support.</li><li>Executed on the command line and will display the results of your tests on the command line once they have run in the browser.</li><li>Default configuration file name: <code class="language-plaintext highlighter-rouge">karma.conf.js</code></li></ul><hr /><h1 id="jasmine"> Jasmine <a href="#jasmine">#</a></h1><ul><li>Is behavior driven development framework for JavaScript.</li><li>AngularJS API recommends Jasmine for unit testing.</li><li>Provides functions to help with structuring your tests.</li><li>Provides API to make assertions.</li></ul><p>Jasmine provides the function to group the tests together.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Description for group of tests</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    
    <span class="c1">// individual tests go here</span>
    
<span class="p">});</span>
</code></pre></div></div><p>In Jasmine we create a <strong>spec</strong>(test) by calling <code class="language-plaintext highlighter-rouge">it</code> function.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is description for test</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    
    <span class="c1">// Test code go here</span>
    
<span class="p">});</span>
</code></pre></div></div><p>So basically our test looks like below.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">some description</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">some descrption</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        
        <span class="c1">//test code go here</span>
        
    <span class="p">});</span>
    
<span class="p">});</span>
</code></pre></div></div><hr /><h1 id="testing-controller"> Testing Controller <a href="#testing-controller">#</a></h1><p>Let us assume that we have controller like below</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">angular</span>
        <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="dl">'</span><span class="s1">appName</span><span class="dl">'</span><span class="p">,</span> <span class="p">[])</span>

        <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="dl">'</span><span class="s1">MainCtrl</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">MainService</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

            <span class="nx">vm</span><span class="p">.</span><span class="nx">someText</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Initial Text</span><span class="dl">'</span><span class="p">;</span>
            <span class="nx">vm</span><span class="p">.</span><span class="nx">serviceReturnedValue</span> <span class="o">=</span> <span class="nx">MainService</span><span class="p">.</span><span class="nx">callMe</span><span class="p">();</span>

            <span class="nx">vm</span><span class="p">.</span><span class="nx">changeText</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">vm</span><span class="p">.</span><span class="nx">someText</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Text Changed</span><span class="dl">'</span><span class="p">;</span>
            <span class="p">};</span>
        <span class="p">});</span>
</code></pre></div></div><p>In order to test this simple controller we need to</p><p><strong>STEP 1</strong>. Load the module using <code class="language-plaintext highlighter-rouge">angular.mock.module('appName');</code> or <code class="language-plaintext highlighter-rouge">module('appName');</code></p><p><strong>STEP 2</strong>. Get the hold of <code class="language-plaintext highlighter-rouge">$controller</code> service using <code class="language-plaintext highlighter-rouge">inject</code> function.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">$controller</span><span class="p">;</span>
<span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_$controller_</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$controller</span> <span class="o">=</span> <span class="nx">_$controller_</span><span class="p">;</span>
<span class="p">});</span>
<span class="c1">// _ (underscore) is used if you want to cache $controller service with same name.</span>
</code></pre></div></div><p><strong>STEP 3</strong>. Initialize the controller using <code class="language-plaintext highlighter-rouge">$controller</code> service.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">// $controller('ControllerName', dependenciesObject);</span>

<span class="kt">var</span> <span class="nc">MainService</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nl">callMe:</span> <span class="n">function</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="err">'</span><span class="nc">Hello</span> <span class="nc">World</span><span class="err">'</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">};</span> <span class="c1">// notice how we are simply mocking services</span>

<span class="kt">var</span> <span class="nc">MainCtrl</span> <span class="o">=</span> <span class="n">$controller</span><span class="o">(</span><span class="err">'</span><span class="nc">MainCtrl</span><span class="err">'</span><span class="o">,</span> <span class="o">{</span><span class="nl">MainService:</span> <span class="nc">MainService</span><span class="o">});</span>

</code></pre></div></div><p><strong>STEP 4</strong>. Make assertion</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">expect</span><span class="p">(</span><span class="nx">MainCtrl</span><span class="p">.</span><span class="nx">someText</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Initial Text</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">MainCtrl</span><span class="p">.</span><span class="nx">someText</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Random Text</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">expect</span><span class="p">(</span><span class="nx">MainCtrl</span><span class="p">.</span><span class="nx">serviceReturnedValue</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">MainCtrl</span><span class="p">.</span><span class="nx">serviceReturnedValue</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Random World</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">MainCtrl</span><span class="p">.</span><span class="nx">changeText</span><span class="p">();</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">MainCtrl</span><span class="p">.</span><span class="nx">someText</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Initial Text</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">MainCtrl</span><span class="p">.</span><span class="nx">someText</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Text Changed</span><span class="dl">'</span><span class="p">);</span>

</code></pre></div></div><p>More on <a href="https://jasmine.github.io/2.4/introduction.html#section-Expectations">Jasmine Expectation here.</a></p><hr /><h1 id="testing-services"> Testing Services <a href="#testing-services">#</a></h1><p>Suppose we have a service that makes AJAX calls, which looks like</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="dl">'</span><span class="s1">MainService</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/:id</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div></div><p>To unit test this component we need to make sure we do not mock the actual service <code class="language-plaintext highlighter-rouge">MainService</code> we are trying to mock. We also need to make sure we do not make an actual call to external resources. So we need to somehow mock the http requests itself. Luckily, we have <code class="language-plaintext highlighter-rouge">$httpBackend</code> service which will help us mock <code class="language-plaintext highlighter-rouge">http</code> requests. Let’s see how we can achieve this</p><p><strong>STEP 1 .</strong> Load the module with <code class="language-plaintext highlighter-rouge">module('appName');</code></p><p><strong>STEP 2 .</strong> Get hold of <code class="language-plaintext highlighter-rouge">$httpBackend</code> and <code class="language-plaintext highlighter-rouge">MainService</code>. Notice we don’t mock <code class="language-plaintext highlighter-rouge">MainService</code> here.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">$httpBackend</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">MainService</span><span class="p">;</span>
<span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_$httpBackend_</span><span class="p">,</span> <span class="nx">_MainService_</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$httpBackend</span> <span class="o">=</span> <span class="nx">_$httpBackend_</span><span class="p">;</span>
    <span class="nx">MainService</span> <span class="o">=</span> <span class="nx">_MainService_</span><span class="p">;</span>
<span class="p">});</span>

</code></pre></div></div><p><strong>STEP 3 .</strong> Mock request that we will be making using <code class="language-plaintext highlighter-rouge">$httpBackend</code>.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">$httpBackend</span>
    <span class="p">.</span><span class="nx">expectGET</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/1</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">respond</span><span class="p">(</span> <span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Aman</span><span class="dl">'</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">);</span>

</code></pre></div></div><p>Notice we are using expectGET method here to expect the GET request to be made and when we get one we tell our mock request to respond with status <code class="language-plaintext highlighter-rouge">200</code> and return an object. Like expectGET we have expectPOST, expectDELETE … etc.</p><p><strong>STEP 4 .</strong> Make a <code class="language-plaintext highlighter-rouge">http</code> request and make it synchronous using <code class="language-plaintext highlighter-rouge">$httpBackend.flush()</code></p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
<span class="nx">MainService</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$httpBackend</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
</code></pre></div></div><p><strong>STEP 5 .</strong> Make Expectation</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Aman</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Random Text</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

</code></pre></div></div><hr /><h1 id="testing-directive"> Testing Directive <a href="#testing-directive">#</a></h1><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// simple directive</span>
<span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDirective</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">elem</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;span&gt;This is appended element&lt;/span&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">});</span>

<span class="c1">// OR</span>

<span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDirective</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">&lt;span&gt;This is appended element&lt;/span&gt;</span><span class="dl">'</span>
    <span class="p">};</span>
<span class="p">});</span>
</code></pre></div></div><p>Let’s see how we can test this directive.</p><p><strong>STEP 1</strong> Load the module. <code class="language-plaintext highlighter-rouge">module('appName');</code></p><p><strong>STEP 2</strong> Get hold of <code class="language-plaintext highlighter-rouge">$compile</code> service and <code class="language-plaintext highlighter-rouge">$rootScope</code></p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">$compile</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">;</span>
<span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_$compile_</span><span class="p">,</span> <span class="nx">_$rootScope_</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$compile</span> <span class="o">=</span> <span class="nx">_$compile_</span><span class="p">;</span>
    <span class="nx">$rootScope</span> <span class="o">=</span> <span class="nx">_$rootScope_</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div><p><strong>STEP 3</strong> Compile the directive</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">directiveElem</span> <span class="o">=</span> <span class="nx">getCompiledElement</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">getCompiledElement</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;div my-directive/&gt;&lt;/div&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">compiledElement</span> <span class="o">=</span> <span class="nx">$compile</span><span class="p">(</span><span class="nx">element</span><span class="p">)(</span><span class="nx">$rootScope</span><span class="p">);</span>
    <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$digest</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">compiledElement</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>For compiling the directive we are first creating the element that has our directive. Then we are using <code class="language-plaintext highlighter-rouge">$compile</code> servie to compile our direcive For completing hte compile process we start the digest cycle Then at end we return the compiled element.</p><p><strong>STEP 4</strong> Make Expectation</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">spanElement</span> <span class="o">=</span> <span class="nx">directiveElem</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">span</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">spanElement</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">spanElement</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is appended element</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">spanElement</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toEqual</span><span class="p">(</span><span class="dl">'</span><span class="s1">Some random text</span><span class="dl">'</span><span class="p">);</span>

</code></pre></div></div><hr /><h1 id="testing-directive-with-templateurl"> Testing Directive with templateUrl <a href="#testing-directive-with-templateurl">#</a></h1><p>Testing a directive with template referred from a file is tricky, as the directive makes an <code class="language-plaintext highlighter-rouge">$httpBackend</code> request to the templateUrl. Adding this template to <code class="language-plaintext highlighter-rouge">$templateCache</code> makes the task of testing easier and the template will be easy to share. This can be done using the karma-ng-html2js-preprocessor.</p><p>This preprocessor converts HTML files into JS strings and generates Angular modules. These modules, when loaded, puts these HTML files into the <code class="language-plaintext highlighter-rouge">$templateCache</code> and therefore Angular won’t try to fetch them from the server.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">preprocessors</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">'</span><span class="s1">path/to/html/template</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">ng-html2js</span><span class="dl">'</span><span class="p">],</span>
<span class="p">},</span>

<span class="nx">ngHtml2JsPreprocessor</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">moduleName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Templates</span><span class="dl">'</span>
<span class="p">}</span>
</code></pre></div></div><p><strong>Just make sure you load <code class="language-plaintext highlighter-rouge">Templates</code> module when you test your directive.</strong></p><hr /><h1 id="bonus---to-run-single-test-on-karma-using-intellij-idea"> Bonus - To run single test on <code class="language-plaintext highlighter-rouge">Karma</code> using IntelliJ Idea <a href="#bonus---to-run-single-test-on-karma-using-intellij-idea">#</a></h1><h3 id="update"> Update <a href="#update">#</a></h3><p>If you update your IntelliJ IDEA and Karma plugin to latest version you can run individual test directly from UI (Like we do in Java test).</p><p><strong>STEP 1</strong> Install <code class="language-plaintext highlighter-rouge">Karma</code> plugin</p><p><strong>STEP 2</strong> Open <code class="language-plaintext highlighter-rouge">karma.conf.js</code> and you will get the run configuration. Run it. <img src="/assets/blog/2017-07-11-angularjs-testing-in-nutshell/karma-run-intellij.png" width="30%" /></p><p><strong>STEP 3</strong> All the test will run the first time. Then after completion open tab <code class="language-plaintext highlighter-rouge">Karma Server</code>. <img src="/assets/blog/2017-07-11-angularjs-testing-in-nutshell/karma-server-intellij.png" width="30%" /></p><p><strong>STEP 4</strong> Notice server is still running. Open the terminal and run following command <code class="language-plaintext highlighter-rouge">karma run path/to/conf/file/karma.conf.js -- --grep=description</code></p><p>For example above we use <code class="language-plaintext highlighter-rouge">karma run path/to/karma.conf.js -- --grep=helloWorld</code> because helloWorld is <code class="language-plaintext highlighter-rouge">describe</code> description.</p><p><img src="/assets/blog/2017-07-11-angularjs-testing-in-nutshell/karma-single-test-run-intellij.png" width="30%" /></p></section><section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2016/12/25/understaing-spy-on-jasmine"><div class="nav-arrow">Previous</div><span class="post-title">Getting familiar with spyOn for Angular Testing</span> </a> <a class="post-nav-item post-nav-next" href="/2017/10/03/java-9-module-intro"><div class="nav-arrow">Next</div><span class="post-title">Introduction to Java 9 Module</span> </a></nav></section><div id="disqus_thread" class="article-comments"></div><script> (function () { var d = document, s = d.createElement('script'); s.src = 'https://a0on.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <script> function toggleTableOfContents() { var el = document.getElementsByClassName('post')[0]; if (el.classList.contains('with-summary')) { el.classList.remove('with-summary'); } else { el.classList.add("with-summary"); } } </script></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"> <a href="https://github.com/amantuladhar" title="Github profile, nothing much there, yet" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="https://babal.dev/atom.xml" title="Feed RSS" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss" aria-hidden="true"></i></a></div></footer></html>
