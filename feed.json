{
    "version": "https://jsonfeed.org/version/1",
    "title": "A0__oN",
    "home_page_url": "https://babal.dev/",
    "feed_url": "https://babal.dev/feed.json",
    "description": "personal blog",
    "icon": "https://babal.dev/apple-touch-icon.png",
    "favicon": "https://babal.dev/favicon.ico",
    "expired": false,
    
    "author":  {
        "name": "Aman Tuladhar",
        "url": null,
        "avatar": null
    },
    
"items": [
    
        {
            "id": "https://babal.dev/2021/12/23/websocket-message-mapping",
            "title": "WebSocket @MessageMapping",
            "summary": "Build a simplest chat app with spring boot and websocket",
            "content_text": "TL;DRSource Code Related Post  Part 1 - WebSocket Basics  Part 2 - (Current) WebSocket @MessageMapping@MessageMapping - Process incoming dataOn our previous post Part 1 we create a simple chat app.Let’s extend the app and add ability to create and join rooms.In order for us to create a custom room, we need ability to send() a message and process that message on server.On our previous post, we created a mechanism to send() a message, but server did not process that message.If you want server to process the message that is received, you need to create a method that is annotated with @MessageMapping(url). Any data we send is available on method parameter.One catch is - we need to use @Payload annotation on parameter@MessageMapping(\"$BASE_URL/createRoom\")fun createCustomRoom(@Payload roomName: String) {}Now we can do anything we want with the roomName. For our simple purpose we will create a variable to hold room names.val roomNames: MutableSet&lt;String&gt; = HashSet()@SubscribeMapping(BASE_URL)fun broadcastAvailableRooms() {    client.convertAndSend(BASE_URL, roomNames);}@MessageMapping(\"$BASE_URL/createRoom\")fun createCustomRoom(@Payload roomName: String) {    if (!roomNames.contains(roomName)) {        roomNames.add(roomName)    }    broadcastAvailableRooms();}We will add room to our list if it doesn’t exist, and then we will broadcast all available rooms.Note I modified our base destination URL /ws/simple-chat-box to broadcast list of rooms.ReactJS App Subscribe To List Of RoomLet’s update our frontend to allow us to create a room and view the list of rooms.First let’s connect our frontend with backend WebSocket and subscribe to /ws/simple-chat-box which will broadcast list of rooms.const onUpdateRoomList = (frame) =&gt; {  setRoomList(JSON.parse(frame.body))}const onWebSocketConnect = (_stompClient) =&gt; {  setStompClient(_stompClient)  _stompClient.subscribe(baseDestinationUrl, onUpdateRoomList)}useEffect(() =&gt; {    const _stompClient = Stomp.over(SockJS(wsConnectUrl));    _stompClient.connect({}, () =&gt; onWebSocketConnect(_stompClient))}, []); Rendering List Of RoomsDisplaying the list of room names&lt;div className={styles.roomList}&gt;  {    roomList.length &gt; 0      ? roomList.map(room =&gt; (          &lt;a className={styles.room} onClick={() =&gt; onClickJoinRoom(room)}&gt;            Join {room}          &lt;/a&gt;        )      )      : (\"No Chat Rooms\")  }&lt;/div&gt; ReactJS App Create RoomFrontend is now subscribed to URL that broadcasts list of room available.Now let’s add UI to allow user to create room. Remember we already have backend codethat create a room.&lt;input type=\"text\"    value={createRoomName}    onChange={({target: {value}}) =&gt; setCreateRoomName(value)}/&gt;&lt;button onClick={onClickCreateRoom}&gt;Create Room&lt;/button&gt;const onClickCreateRoom = () =&gt; {  stompClient.send(`${baseDestinationUrl}/createRoom`, createRoomName)}If you create a room now the UI should auto update.ReactJS App Join RoomNow it is time to add ability to join the room.When we implemented a UI to display list of room we also addedonClick handler that calls onClickJoinRoom.const onClickJoinRoom = (roomName) =&gt; {  if (roomSubRef !== null) {    roomSubRef.unsubscribe();  }  setJoinRoomName(roomName)  setMessages([])  const roomRef = stompClient.subscribe(`${baseDestinationUrl}/${roomName}`, onUpdateMessagesForRoom)  setRoomSubRef(roomRef);}Here’s an interesting part, it might look like we are subscribing to endpoint that we did not register on backend.But remember on Part 1 I mentioned we can subscribe to any URL we want, it doesn’t need to be registered.We are more or less doing the same thing. But important part here is that we are usingbaseDestinationUrl as our starting path. Because we registered baseDestinationUrl, any destination URLthat client use that is prefixed by baseDestinationUrl can be intercepted by using special annotation like@MessageMapping. baseDestinationUrl/createRoom is one of them. We did not register baseDesUrl/createRoomon our WebSocket configuration, but we were able special behavior to that particular URL because thesubscription url was prefixed with baseDestination URl.To show the messages we simply display messages content on UI&lt;h3&gt;Messages for Room: {joinRoomName}&lt;/h3&gt;&lt;pre&gt;{JSON.stringify(messages, null, ' ')}&lt;/pre&gt;&lt;div&gt;    &lt;input type=\"text\"           value={newMessage}           onChange={({target: {value}}) =&gt; setNewMessage(value)}           onKeyDown={onKeyDownUserMessage}/&gt;&lt;/div&gt;References:  Spring Websocket Documentation",
            "content_html": "<h4 id=\"tldr\"><strong><code class=\"language-plaintext highlighter-rouge\">TL;DR</code></strong></h4><p><a target=\"_blank\" href=\"https://github.com/amantuladhar/sse-websocket-reactive-api-kafka/tree/002-simple-chat-box-with-custom-rooms\">Source Code</a></p><hr /><p> </p><h4 id=\"related-post\">Related Post</h4><ul>  <li><a target=\"_blank\" href=\"/2021/12/22/websocket-basics-with-spring-boot\">Part 1</a> - WebSocket Basics</li>  <li><a target=\"_blank\" href=\"/2021/12/23/websocket-message-mapping\">Part 2</a> - (Current) WebSocket <code class=\"language-plaintext highlighter-rouge\">@MessageMapping</code></li></ul><h4 id=\"messagemapping---process-incoming-data\">@MessageMapping - Process incoming data</h4><p>On our previous post <a target=\"_blank\" href=\"/2021/12/22/websocket-basics-with-spring-boot\">Part 1</a> we create a simple chat app.Let’s extend the app and add ability to create and join rooms.</p><p>In order for us to create a custom room, we need ability to <code class=\"language-plaintext highlighter-rouge\">send()</code> a message and process that message on server.On our previous post, we created a mechanism to <code class=\"language-plaintext highlighter-rouge\">send()</code> a message, but server did not process that message.If you want server to process the message that is received, you need to create a method that is annotated with <code class=\"language-plaintext highlighter-rouge\">@MessageMapping(url)</code>. Any data we send is available on method parameter.One catch is - we need to use <code class=\"language-plaintext highlighter-rouge\">@Payload</code> annotation on parameter</p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@MessageMapping</span><span class=\"p\">(</span><span class=\"s\">\"$BASE_URL/createRoom\"</span><span class=\"p\">)</span><span class=\"k\">fun</span> <span class=\"nf\">createCustomRoom</span><span class=\"p\">(</span><span class=\"nd\">@Payload</span> <span class=\"n\">roomName</span><span class=\"p\">:</span> <span class=\"nc\">String</span><span class=\"p\">)</span> <span class=\"p\">{</span><span class=\"p\">}</span></code></pre></div></div><p>Now we can do anything we want with the roomName. For our simple purpose we will create a variable to hold room names.</p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">val</span> <span class=\"py\">roomNames</span><span class=\"p\">:</span> <span class=\"nc\">MutableSet</span><span class=\"p\">&lt;</span><span class=\"nc\">String</span><span class=\"p\">&gt;</span> <span class=\"p\">=</span> <span class=\"nc\">HashSet</span><span class=\"p\">()</span><span class=\"nd\">@SubscribeMapping</span><span class=\"p\">(</span><span class=\"nc\">BASE_URL</span><span class=\"p\">)</span><span class=\"k\">fun</span> <span class=\"nf\">broadcastAvailableRooms</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"n\">client</span><span class=\"p\">.</span><span class=\"nf\">convertAndSend</span><span class=\"p\">(</span><span class=\"nc\">BASE_URL</span><span class=\"p\">,</span> <span class=\"n\">roomNames</span><span class=\"p\">);</span><span class=\"p\">}</span><span class=\"nd\">@MessageMapping</span><span class=\"p\">(</span><span class=\"s\">\"$BASE_URL/createRoom\"</span><span class=\"p\">)</span><span class=\"k\">fun</span> <span class=\"nf\">createCustomRoom</span><span class=\"p\">(</span><span class=\"nd\">@Payload</span> <span class=\"n\">roomName</span><span class=\"p\">:</span> <span class=\"nc\">String</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">if</span> <span class=\"p\">(!</span><span class=\"n\">roomNames</span><span class=\"p\">.</span><span class=\"nf\">contains</span><span class=\"p\">(</span><span class=\"n\">roomName</span><span class=\"p\">))</span> <span class=\"p\">{</span>        <span class=\"n\">roomNames</span><span class=\"p\">.</span><span class=\"nf\">add</span><span class=\"p\">(</span><span class=\"n\">roomName</span><span class=\"p\">)</span>    <span class=\"p\">}</span>    <span class=\"nf\">broadcastAvailableRooms</span><span class=\"p\">();</span><span class=\"p\">}</span></code></pre></div></div><p>We will add room to our list if it doesn’t exist, and then we will broadcast all available rooms.Note I modified our <strong>base destination URL</strong> <code class=\"language-plaintext highlighter-rouge\">/ws/simple-chat-box</code> to broadcast list of rooms.</p><h4 id=\"reactjs-app-subscribe-to-list-of-room\">ReactJS App Subscribe To List Of Room</h4><p>Let’s update our frontend to allow us to create a room and view the list of rooms.First let’s connect our frontend with backend WebSocket and subscribe to <code class=\"language-plaintext highlighter-rouge\">/ws/simple-chat-box</code> which will broadcast list of rooms.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">const</span> <span class=\"nx\">onUpdateRoomList</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">frame</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>  <span class=\"nx\">setRoomList</span><span class=\"p\">(</span><span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">parse</span><span class=\"p\">(</span><span class=\"nx\">frame</span><span class=\"p\">.</span><span class=\"nx\">body</span><span class=\"p\">))</span><span class=\"p\">}</span><span class=\"kd\">const</span> <span class=\"nx\">onWebSocketConnect</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">_stompClient</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>  <span class=\"nx\">setStompClient</span><span class=\"p\">(</span><span class=\"nx\">_stompClient</span><span class=\"p\">)</span>  <span class=\"nx\">_stompClient</span><span class=\"p\">.</span><span class=\"nx\">subscribe</span><span class=\"p\">(</span><span class=\"nx\">baseDestinationUrl</span><span class=\"p\">,</span> <span class=\"nx\">onUpdateRoomList</span><span class=\"p\">)</span><span class=\"p\">}</span><span class=\"nx\">useEffect</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"kd\">const</span> <span class=\"nx\">_stompClient</span> <span class=\"o\">=</span> <span class=\"nx\">Stomp</span><span class=\"p\">.</span><span class=\"nx\">over</span><span class=\"p\">(</span><span class=\"nx\">SockJS</span><span class=\"p\">(</span><span class=\"nx\">wsConnectUrl</span><span class=\"p\">));</span>    <span class=\"nx\">_stompClient</span><span class=\"p\">.</span><span class=\"nx\">connect</span><span class=\"p\">({},</span> <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"nx\">onWebSocketConnect</span><span class=\"p\">(</span><span class=\"nx\">_stompClient</span><span class=\"p\">))</span><span class=\"p\">},</span> <span class=\"p\">[]);</span></code></pre></div></div><p> </p><h4 id=\"rendering-list-of-rooms\">Rendering List Of Rooms</h4><p>Displaying the list of room names</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">&lt;</span><span class=\"nt\">div</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">roomList</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>  <span class=\"si\">{</span>    <span class=\"nx\">roomList</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span>      <span class=\"p\">?</span> <span class=\"nx\">roomList</span><span class=\"p\">.</span><span class=\"nx\">map</span><span class=\"p\">(</span><span class=\"nx\">room</span> <span class=\"o\">=&gt;</span> <span class=\"p\">(</span>          <span class=\"p\">&lt;</span><span class=\"nt\">a</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">room</span><span class=\"si\">}</span> <span class=\"na\">onClick</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"nx\">onClickJoinRoom</span><span class=\"p\">(</span><span class=\"nx\">room</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>            Join <span class=\"si\">{</span><span class=\"nx\">room</span><span class=\"si\">}</span>          <span class=\"p\">&lt;/</span><span class=\"nt\">a</span><span class=\"p\">&gt;</span>        <span class=\"p\">)</span>      <span class=\"p\">)</span>      <span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">No Chat Rooms</span><span class=\"dl\">\"</span><span class=\"p\">)</span>  <span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span></code></pre></div></div><p> </p><h4 id=\"reactjs-app-create-room\">ReactJS App Create Room</h4><p>Frontend is now subscribed to URL that broadcasts list of room available.Now let’s add UI to allow user to create room. Remember we already have backend codethat create a room.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">&lt;</span><span class=\"nt\">input</span> <span class=\"na\">type</span><span class=\"p\">=</span><span class=\"s\">\"text\"</span>    <span class=\"na\">value</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">createRoomName</span><span class=\"si\">}</span>    <span class=\"na\">onChange</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"p\">({</span><span class=\"na\">target</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"p\">}})</span> <span class=\"o\">=&gt;</span> <span class=\"nx\">setCreateRoomName</span><span class=\"p\">(</span><span class=\"nx\">value</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"p\">/&gt;</span><span class=\"p\">&lt;</span><span class=\"nt\">button</span> <span class=\"na\">onClick</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">onClickCreateRoom</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>Create Room<span class=\"p\">&lt;/</span><span class=\"nt\">button</span><span class=\"p\">&gt;</span><span class=\"kd\">const</span> <span class=\"nx\">onClickCreateRoom</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>  <span class=\"nx\">stompClient</span><span class=\"p\">.</span><span class=\"nx\">send</span><span class=\"p\">(</span><span class=\"s2\">`</span><span class=\"p\">${</span><span class=\"nx\">baseDestinationUrl</span><span class=\"p\">}</span><span class=\"s2\">/createRoom`</span><span class=\"p\">,</span> <span class=\"nx\">createRoomName</span><span class=\"p\">)</span><span class=\"p\">}</span></code></pre></div></div><p>If you create a room now the UI should auto update.</p><h4 id=\"reactjs-app-join-room\">ReactJS App Join Room</h4><p>Now it is time to add ability to join the room.When we implemented a UI to display list of room we also added<code class=\"language-plaintext highlighter-rouge\">onClick</code> handler that calls <code class=\"language-plaintext highlighter-rouge\">onClickJoinRoom</code>.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">const</span> <span class=\"nx\">onClickJoinRoom</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">roomName</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">roomSubRef</span> <span class=\"o\">!==</span> <span class=\"kc\">null</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"nx\">roomSubRef</span><span class=\"p\">.</span><span class=\"nx\">unsubscribe</span><span class=\"p\">();</span>  <span class=\"p\">}</span>  <span class=\"nx\">setJoinRoomName</span><span class=\"p\">(</span><span class=\"nx\">roomName</span><span class=\"p\">)</span>  <span class=\"nx\">setMessages</span><span class=\"p\">([])</span>  <span class=\"kd\">const</span> <span class=\"nx\">roomRef</span> <span class=\"o\">=</span> <span class=\"nx\">stompClient</span><span class=\"p\">.</span><span class=\"nx\">subscribe</span><span class=\"p\">(</span><span class=\"s2\">`</span><span class=\"p\">${</span><span class=\"nx\">baseDestinationUrl</span><span class=\"p\">}</span><span class=\"s2\">/</span><span class=\"p\">${</span><span class=\"nx\">roomName</span><span class=\"p\">}</span><span class=\"s2\">`</span><span class=\"p\">,</span> <span class=\"nx\">onUpdateMessagesForRoom</span><span class=\"p\">)</span>  <span class=\"nx\">setRoomSubRef</span><span class=\"p\">(</span><span class=\"nx\">roomRef</span><span class=\"p\">);</span><span class=\"p\">}</span></code></pre></div></div><p>Here’s an interesting part, it might look like we are subscribing to endpoint that we did not register on backend.But remember on <a target=\"_blank\" href=\"/2021/12/22/websocket-basics-with-spring-boot\">Part 1</a> I mentioned we can subscribe to any URL we want, it doesn’t need to be registered.We are more or less doing the same thing. But important part here is that we are usingbaseDestinationUrl as our starting path. Because we registered baseDestinationUrl, any destination URLthat client use that is prefixed by baseDestinationUrl can be intercepted by using special annotation like@MessageMapping. baseDestinationUrl/createRoom is one of them. We did not register baseDesUrl/createRoomon our WebSocket configuration, but we were able special behavior to that particular URL because thesubscription url was prefixed with baseDestination URl.</p><p>To show the messages we simply display messages content on UI</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">&lt;</span><span class=\"nt\">h3</span><span class=\"p\">&gt;</span>Messages for Room: <span class=\"si\">{</span><span class=\"nx\">joinRoomName</span><span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">h3</span><span class=\"p\">&gt;</span><span class=\"p\">&lt;</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span><span class=\"si\">{</span><span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">(</span><span class=\"nx\">messages</span><span class=\"p\">,</span> <span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\"> </span><span class=\"dl\">'</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span><span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>    <span class=\"p\">&lt;</span><span class=\"nt\">input</span> <span class=\"na\">type</span><span class=\"p\">=</span><span class=\"s\">\"text\"</span>           <span class=\"na\">value</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">newMessage</span><span class=\"si\">}</span>           <span class=\"na\">onChange</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"p\">({</span><span class=\"na\">target</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"p\">}})</span> <span class=\"o\">=&gt;</span> <span class=\"nx\">setNewMessage</span><span class=\"p\">(</span><span class=\"nx\">value</span><span class=\"p\">)</span><span class=\"si\">}</span>           <span class=\"na\">onKeyDown</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">onKeyDownUserMessage</span><span class=\"si\">}</span><span class=\"p\">/&gt;</span><span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span></code></pre></div></div><hr /><p>References:</p><ul>  <li><a target=\"_blank\" href=\"https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket\">Spring Websocket Documentation</a></li></ul>",
            "url": "https://babal.dev/2021/12/23/websocket-message-mapping",
            
            
            
            "tags": ["java","kotlin","websocket","spring","spring-boot","reactjs"],
            
            "date_published": "2021-12-23T00:00:00-05:00",
            "date_modified": "2021-12-23T00:00:00-05:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2021/12/22/websocket-basics-with-spring-boot",
            "title": "WebSocket Basics With Spring Boot And ReactJS",
            "summary": "Build a simplest chat app with spring boot and websocket",
            "content_text": "TL;DRSource Code Related Post  Part 1 - (Current) WebSocket Basics  Part 2 - WebSocket @MessageMappingCreate Spring Boot ProjectCreate a spring boot app with websocket dependency from start.spring.io. I am using Kotlin with Gradle in this project. Feel free touse Java or Maven if you want. The concept is same and as far as code goes, it should be easy to convert Kotlin to Java.For reference here’s my build.gradle.ktsimport org.jetbrains.kotlin.gradle.tasks.KotlinCompileplugins {    id(\"org.springframework.boot\") version \"2.6.1\"    id(\"io.spring.dependency-management\") version \"1.0.11.RELEASE\"    kotlin(\"jvm\") version \"1.6.0\"    kotlin(\"plugin.spring\") version \"1.6.0\"}group = \"com.example\"version = \"0.0.1-SNAPSHOT\"java.sourceCompatibility = JavaVersion.VERSION_17repositories {    mavenCentral()}dependencies {    developmentOnly(\"org.springframework.boot:spring-boot-devtools\")    implementation(\"com.fasterxml.jackson.module:jackson-module-kotlin\")    implementation(\"org.jetbrains.kotlin:kotlin-reflect\")    implementation(\"org.jetbrains.kotlin:kotlin-stdlib-jdk8\")    implementation(\"org.springframework.boot:spring-boot-starter-websocket\") 1️⃣}tasks.withType&lt;KotlinCompile&gt; {    kotlinOptions {        freeCompilerArgs = listOf(\"-Xjsr305=strict\")        jvmTarget = \"17\"    }}tasks.withType&lt;Test&gt; {    useJUnitPlatform()}1️⃣ Websocket dependency, which is the most important one for this project.Enable WebSocketNow that our project has required dependency, we are ready to write code to enable WebSocket. To enable websocket we need touse @EnableWebSocketMessageBroker. You can create a new @Configuration class or you can add to existing one. I will add this to our mainclass.@SpringBootApplication@EnableWebSocketMessageBrokerclass DemoApplicationfun main(args: Array&lt;String&gt;) {    runApplication&lt;DemoApplication&gt;(*args)} Configure WebSocket Connect EndpointWe need to define a URL where client can establish a WebSocket connection. To define the endpoint we need to create a @Configuration class thatextends WebSocketMessageBrokerConfigurer@Configurationclass WebSocketConfiguration : WebSocketMessageBrokerConfigurer {}Inside of this class, we can override registerStompEndpoints(registry: StompEndpointRegistry) method. The method has a StompEndpointRegistry asparameter, which we can use to add our endpoint.@Configurationclass WebSocketConfiguration : WebSocketMessageBrokerConfigurer {    companion object {        const val WEB_SOCKET_CONNECT_URL = \"/ws/connect\" // 2️⃣    }    override fun registerStompEndpoints(registry: StompEndpointRegistry) {        super.registerStompEndpoints(registry)        registry.addEndpoint(WEB_SOCKET_CONNECT_URL) // 1️⃣            .setAllowedOrigins(\"http://localhost:3000\") // 3️⃣            .withSockJS() // 4️⃣    }}1️⃣ We use addEndpoint(url: String) method to define our WebSocket connection endpoint.2️⃣ We are setting our connection url to /ws/connect. This is a static constant on Kotlin.3️⃣ Whitelisting request coming from http://localhost:3000. localhost:3000 will be our frontend dev server url.4️⃣ Enable SockJS support. If some browser doesn’t support WebSocket, SockJS can setup alternatively approach without needing to change the code.This is almost like polyfill for WebSocket.At this point we can create a client app that can connect with our WebSocket endpoint.Creating ReactJS App  We will create a ReactJS App to play with our WebSocket API. I will be using NextJS for this project. You don’t have to know NextJS to followthis tutorial.To create a simple ReactJS App using NextJS you can use# Tested on Node 17npx create-next-app frontendOpen frontend app on or IDE of choice. Open pages/index.js and replace with following code.import Link from 'next/link'import styles from '../styles/Home.module.css'export default function Home() {    return (        &lt;div className={styles.container}&gt;            &lt;main className={styles.main}&gt;                &lt;div className={styles.linkWrapper}&gt;                    &lt;Link href={\"/simple-chat-box\"}&gt; // 1️⃣                        &lt;a className={styles.link}&gt;Simple Chatbox&lt;/a&gt;                    &lt;/Link&gt;                &lt;/div&gt;            &lt;/main&gt;        &lt;/div&gt;    )}1️⃣ We are creating a anchor tag that can navigate us to new page i.e /simple-chat-box🤯 Ignore className attribute for now. className attribute doesn’t affect any functionality and is there for purly styling purpose.Now inside of pages directory, create a new folder with name simple-chat-box. Note this name must match 1️⃣. This is how NextJS handlesroutes.Inside of the new folder create a index.js which will get rendered when /simple-chat-box route is called.import SimpleChatBox from './SimpleChatBox.js'; // 1️⃣export default function SimpleChatBoxIndex() {    return &lt;SimpleChatBox/&gt;}1️⃣ We have not created this component yet. So let’s create one inside of pages/simple-chat-box directory.import * as styles from './index.module.scss';export default function SimpleChatBox() {    return (        &lt;div&gt;            &lt;main className={styles.main}&gt;                &lt;h1&gt;Simple Chat Box&lt;/h1&gt;            &lt;/main&gt;        &lt;/div&gt;    )} Add Stomp and SockJS dependency on ReactAPPTo make our frontend code bit easier we will use some open source library. On your package.json add these line to your dependencies section.    \"sockjs-client\": \"^1.5.2\",    \"webstomp-client\": \"^1.2.6\" ReactJS App connect with WebSocket APIAll of our dependency is now in place. All left for us to do is to make appropriate call to establish a handshake. On our SimpleChatBox.js add thiscodeimport * as styles from './index.module.scss';import Stomp from 'webstomp-client';import SockJS from 'sockjs-client';import {useEffect, useState} from 'react';export default function SimpleChatBox() {    const relativeWsConnectUrl = '/ws/connect'; // 1️⃣    const wsConnectUrl = `${process.env.REACT_APP_BACKEND_PROTOCOL}://${process.env.REACT_APP_BACKEND_WS_URL}:${process.env.REACT_APP_BACKEND_PORT}${relativeWsConnectUrl}`;    const [stompClient, setStompClient] = useState(null);    useEffect(() =&gt; {        const stompClient = Stomp.over(SockJS(wsConnectUrl)); // 2️⃣         stompClient.connect({}, // 3️⃣            () =&gt; {                setStompClient(stompClient); // 4️⃣            })    }, []);    return (        &lt;div&gt;            &lt;main className={styles.main}&gt;                &lt;h1&gt;Simple Chat Box&lt;/h1&gt;            &lt;/main&gt;        &lt;/div&gt;    )}Because this is not ReactJS tutorial I will not go into details about ReactJS stuff. But let’s go through some important part of this code.1️⃣ This is the same URL we defined on backend side. relativeWsConnectUrl is used to construct full url for wsConnectUrl. I am setting mybackend server URL as env variable, but feel free to change this to string literal.2️⃣ Initialize SockJS and Stomp to establish a connection. This code is inside of useEffect() so that we do this initialize and connect whencomponent is mounted.3️⃣ Calling connect(header, successHandler, errorHandler) method to initiate a handshake to our backend WebSocket url.4️⃣ Saving our reference to our stompClient for future use. Above code is saving reference after successful connection, but we can do that rightafter initialization if you want.As a bonus let’s update our JSX to display some helpful message return (        &lt;div&gt;            &lt;main className={styles.main}&gt;                &lt;h1&gt;Simple Chat Box&lt;/h1&gt;                &lt;div className={styles.contentWrapper}&gt;                    &lt;div&gt;                        Websocket Connection: &lt;b&gt;{stompClient == null ? 'No Ready' : 'Ready'}&lt;/b&gt;&lt;br/&gt;                        Client Connected: &lt;b&gt;{stompClient?.connected == null ? 'No' : 'Yes'}&lt;/b&gt;&lt;br/&gt;                    &lt;/div&gt;                &lt;/div&gt;            &lt;/main&gt;        &lt;/div&gt;    )If you run backend and frontend now, and on frontend code if you navigate to /simple-chat-box you should see WebSocket connection wassuccessful.Websocket Connection: ReadyClient Connected: Yes Add Subscription EndpointTo add endpoint where client can subscribe to, we need to override configureMessageBroker(registry: MessageBrokerRegistry) methodon WebSocketConfiguration.@Configurationclass WebSocketConfiguration : WebSocketMessageBrokerConfigurer {    companion object {        const val WEB_SOCKET_CONNECT_URL = \"/ws/connect\"        const val SIMPLE_CHAT_BOX_URL = \"/ws/simple-chat-box\" //3️⃣    }    override fun registerStompEndpoints(registry: StompEndpointRegistry) {        super.registerStompEndpoints(registry)        registry.addEndpoint(WEB_SOCKET_CONNECT_URL)            .setAllowedOrigins(\"http://localhost:3000\")            .withSockJS()    }    override fun configureMessageBroker(registry: MessageBrokerRegistry) { // 1️⃣        super.configureMessageBroker(registry)        registry.enableSimpleBroker(SIMPLE_CHAT_BOX_URL) // 2️⃣    }}1️⃣ Implementation for method to override2️⃣ We use enableSimpleBroker(vararg url: String). varargs simply means this methods can accept multiple url separated by comma. This willcreate a in-memory broker.3️⃣ URL where client can subscribe to get our messages.ReactJS App Add a Code To SubscribeOur backend code is now configured to send message to specific urls (/ws/simple-chat-box for us).Note: We can somehow subscribe to any URL we want to e.g even /xyx/foo. I don’t know why this works. If I ever find the reason I will update my finding here.Later in the post I will let you know benefit of explicitly defining our subscription endpoint.On our SimpleChatBox.js let’s update our UI to include the Join Chat button.const onClickJoinChat = () =&gt; {    const subRef = stompClient.subscribe(destinationUrl, onMessageReceived); // 2️⃣    setSubscriptionRef(subRef);};&lt;button disabled={stompClient === null} // 1️⃣        onClick={onClickJoinChat}&gt;    Join Chat&lt;/button&gt;1️⃣ Button implementation for Join Chat2️⃣ We use stompClient subscribe() to subscribe to a specific URL. The first param for the method is the URL you want to subscribe to. Second parameter is a callback that gets called when you receive a update from the URL.ReactJS App Send Message To Subscription URLWe subscribed to a specific destination URL, but if no one update the subscription, no one will get an update.To send a message to subscription we can useconst onChangeUserText = ({target: {value}}) =&gt; (setUserText(value))const onKeyDownUserText = ({keyCode}) =&gt; {    if (subscriptionRef !== null &amp;&amp; keyCode === 13) { // Enter        sendMessage()    }}const sendMessage = () =&gt; {    stompClient.send(destinationUrl, userText) // 2️⃣}&lt;input placeholder=\"Enter your message\" // 1️⃣        type=\"text\"        value={userText}        onChange={onChangeUserText}        onKeyDown={onKeyDownUserText}/&gt;1️⃣ Input field where user can type their messages.2️⃣ Using stompClient to send the message to destinationUrl.send() has multiple implementation, the one I am using take two parameter.First parameter is URL where you want to send message to.Second parameter is the actual message you want to send. For us it is a userText as user entered value gets stored on that variable.Now we have mechanism in place to send message. But what good is sending message if you can’t see it right?Let’s add that part in.&lt;pre&gt;{JSON.stringify(messageHistory, null, '  ')}&lt;/pre&gt; // 1️⃣1️⃣ Here’s messageHistory will store the list of messages that client receives.But how does messageHistory gets updated? Remember onMessageReceived callback we passed when we subscribed to destination URL?. Here’s a implementation for that method.const onMessageReceived = (newState) =&gt; {    setMessageHistory(previousState =&gt; [...previousState, newState.body])    setUserText('')};Dang!! this is getting complex. Show me the whole codeimport * as styles from './index.module.scss';import Head from 'next/head.js';import {useEffect, useState} from 'react';import SockJS from 'sockjs-client';import Stomp from 'webstomp-client';export default function SimpleChatBox() {  const wsConnectUrl = `${process.env.REACT_APP_BACKEND_PROTOCOL}://${process.env.REACT_APP_BACKEND_WS_URL}:${process.env.REACT_APP_BACKEND_PORT}/ws/connect`;  const destinationUrl = '/ws/simple-chat-box'  const [stompClient, setStompClient] = useState(null);  const [messageHistory, setMessageHistory] = useState([]);  const [subscriptionRef, setSubscriptionRef] = useState(null);  const [userText, setUserText] = useState('');  useEffect(() =&gt; {    const stompClient = Stomp.over(SockJS(wsConnectUrl))    stompClient.connect({},      () =&gt; {        setStompClient(stompClient)      })  }, []);  const onMessageReceived = (newState) =&gt; {    setMessageHistory(previousState =&gt; [...previousState, newState.body])    setUserText('')  };  const onClickJoinChat = () =&gt; {    const subRef = stompClient.subscribe(destinationUrl, onMessageReceived)    setSubscriptionRef(subRef)  };  const onChangeUserText = ({target: {value}}) =&gt; (setUserText(value))  const onKeyDownUserText = ({keyCode}) =&gt; {    if (subscriptionRef !== null &amp;&amp; keyCode === 13) { // Enter      sendMessage()    }  }  const sendMessage = () =&gt; {    stompClient.send(destinationUrl, userText)  }  return (    &lt;div&gt;      &lt;Head&gt;        &lt;title&gt;Simple Chat App&lt;/title&gt;      &lt;/Head&gt;      &lt;main className={styles.main}&gt;        &lt;div className={styles.contentWrapper}&gt;          &lt;div&gt;            Websocket Connection: &lt;b&gt;{stompClient == null ? 'No Ready' : 'Ready'}&lt;/b&gt;&lt;br/&gt;            Client Connected: &lt;b&gt;{stompClient?.connected == null ? 'No' : 'Yes'}&lt;/b&gt;&lt;br/&gt;          &lt;/div&gt;          &lt;div&gt;            {subscriptionRef == null              ? &lt;button disabled={stompClient === null}                        onClick={onClickJoinChat}&gt;                Join Chat              &lt;/button&gt;              : ''            }          &lt;/div&gt;          &lt;div&gt;            &lt;pre&gt;{JSON.stringify(messageHistory, null, '  ')}&lt;/pre&gt;            &lt;div&gt;              &lt;input placeholder=\"Enter your message\"                     type=\"text\"                     value={userText}                     onChange={onChangeUserText}                     onKeyDown={onKeyDownUserText}/&gt;            &lt;/div&gt;          &lt;/div&gt;        &lt;/div&gt;      &lt;/main&gt;    &lt;/div&gt;  )}If you run both backend and frontend. You should have a working basic chat system. Make sure you open two browser and try it out. Sending message to client when they subscribe - @SubscribeMappingTo send message to client when they subscribe, we need to add a @Controller.@Controller // 1️⃣class SimpleChatBoxController {    companion object {        const val BASE_URL = WebSocketConfiguration.SIMPLE_CHAT_BOX_URL    }    @SubscribeMapping(BASE_URL) // 2️⃣    @SendTo(BASE_URL) // 3️⃣    fun welcomeToTheChat(): String {        return \"Someone joined the chat\";    }}1️⃣ Define a @Controller to add our WebSocket mapping.2️⃣ @SubscribeMapping - The method will get called whenever client subscribes to provided URL on @SubscribeMapping.3️⃣ @SendTo - Whatever method returns will be published to the destination URL passed into @SendToAlternative way to send message with SimpMessagingTemplate@Controllerclass SimpleChatBoxController(var client: SimpMessagingTemplate) {    companion object {        const val BASE_URL = WebSocketConfiguration.SIMPLE_CHAT_BOX_URL    }    @SubscribeMapping(BASE_URL)    fun welcomeToTheChat() {        client.convertAndSend(BASE_URL, \"Someone joined the chat\")    }}Note: This is the benefit of explicitly defining our endpoint. @SubscribeMapping URL only works when url is registered on our WebSocket configuration.References:  Spring Websocket Documentation",
            "content_html": "<h4 id=\"tldr\"><strong><code class=\"language-plaintext highlighter-rouge\">TL;DR</code></strong></h4><p><a target=\"_blank\" href=\"https://github.com/amantuladhar/sse-websocket-reactive-api-kafka/tree/001-simple-chat-box\">Source Code</a></p><hr /><p> </p><h4 id=\"related-post\">Related Post</h4><ul>  <li><a target=\"_blank\" href=\"/2021/12/22/websocket-basics-with-spring-boot\">Part 1</a> - (Current) WebSocket Basics</li>  <li><a target=\"_blank\" href=\"/2021/12/23/websocket-message-mapping\">Part 2</a> - WebSocket <code class=\"language-plaintext highlighter-rouge\">@MessageMapping</code></li></ul><h4 id=\"create-spring-boot-project\">Create Spring Boot Project</h4><p>Create a spring boot app with websocket dependency from <strong><a target=\"_blank\" href=\"https://start.spring.io/#!type=gradle-project&amp;language=kotlin&amp;platformVersion=2.6.2&amp;packaging=jar&amp;jvmVersion=17&amp;groupId=com.example&amp;artifactId=demo&amp;name=demo&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.demo&amp;dependencies=websocket\">start.spring.io</a></strong>. I am using <strong>Kotlin</strong> with <strong>Gradle</strong> in this project. Feel free touse <strong>Java</strong> or <strong>Maven</strong> if you want. The concept is same and as far as code goes, it should be easy to convert <strong>Kotlin</strong> to <strong>Java</strong>.</p><p>For reference here’s my <code class=\"language-plaintext highlighter-rouge\">build.gradle.kts</code></p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">import</span> <span class=\"nn\">org.jetbrains.kotlin.gradle.tasks.KotlinCompile</span><span class=\"nf\">plugins</span> <span class=\"p\">{</span>    <span class=\"nf\">id</span><span class=\"p\">(</span><span class=\"s\">\"org.springframework.boot\"</span><span class=\"p\">)</span> <span class=\"n\">version</span> <span class=\"s\">\"2.6.1\"</span>    <span class=\"nf\">id</span><span class=\"p\">(</span><span class=\"s\">\"io.spring.dependency-management\"</span><span class=\"p\">)</span> <span class=\"n\">version</span> <span class=\"s\">\"1.0.11.RELEASE\"</span>    <span class=\"nf\">kotlin</span><span class=\"p\">(</span><span class=\"s\">\"jvm\"</span><span class=\"p\">)</span> <span class=\"n\">version</span> <span class=\"s\">\"1.6.0\"</span>    <span class=\"nf\">kotlin</span><span class=\"p\">(</span><span class=\"s\">\"plugin.spring\"</span><span class=\"p\">)</span> <span class=\"n\">version</span> <span class=\"s\">\"1.6.0\"</span><span class=\"p\">}</span><span class=\"n\">group</span> <span class=\"p\">=</span> <span class=\"s\">\"com.example\"</span><span class=\"n\">version</span> <span class=\"p\">=</span> <span class=\"s\">\"0.0.1-SNAPSHOT\"</span><span class=\"n\">java</span><span class=\"p\">.</span><span class=\"n\">sourceCompatibility</span> <span class=\"p\">=</span> <span class=\"nc\">JavaVersion</span><span class=\"p\">.</span><span class=\"nc\">VERSION_17</span><span class=\"nf\">repositories</span> <span class=\"p\">{</span>    <span class=\"nf\">mavenCentral</span><span class=\"p\">()</span><span class=\"p\">}</span><span class=\"nf\">dependencies</span> <span class=\"p\">{</span>    <span class=\"nf\">developmentOnly</span><span class=\"p\">(</span><span class=\"s\">\"org.springframework.boot:spring-boot-devtools\"</span><span class=\"p\">)</span>    <span class=\"nf\">implementation</span><span class=\"p\">(</span><span class=\"s\">\"com.fasterxml.jackson.module:jackson-module-kotlin\"</span><span class=\"p\">)</span>    <span class=\"nf\">implementation</span><span class=\"p\">(</span><span class=\"s\">\"org.jetbrains.kotlin:kotlin-reflect\"</span><span class=\"p\">)</span>    <span class=\"nf\">implementation</span><span class=\"p\">(</span><span class=\"s\">\"org.jetbrains.kotlin:kotlin-stdlib-jdk8\"</span><span class=\"p\">)</span>    <span class=\"nf\">implementation</span><span class=\"p\">(</span><span class=\"s\">\"org.springframework.boot:spring-boot-starter-websocket\"</span><span class=\"p\">)</span> <span class=\"mi\">1</span><span class=\"err\">️⃣</span><span class=\"p\">}</span><span class=\"n\">tasks</span><span class=\"p\">.</span><span class=\"n\">withType</span><span class=\"p\">&lt;</span><span class=\"nc\">KotlinCompile</span><span class=\"p\">&gt;</span> <span class=\"p\">{</span>    <span class=\"nf\">kotlinOptions</span> <span class=\"p\">{</span>        <span class=\"n\">freeCompilerArgs</span> <span class=\"p\">=</span> <span class=\"nf\">listOf</span><span class=\"p\">(</span><span class=\"s\">\"-Xjsr305=strict\"</span><span class=\"p\">)</span>        <span class=\"n\">jvmTarget</span> <span class=\"p\">=</span> <span class=\"s\">\"17\"</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"n\">tasks</span><span class=\"p\">.</span><span class=\"n\">withType</span><span class=\"p\">&lt;</span><span class=\"nc\">Test</span><span class=\"p\">&gt;</span> <span class=\"p\">{</span>    <span class=\"nf\">useJUnitPlatform</span><span class=\"p\">()</span><span class=\"p\">}</span></code></pre></div></div><p>1️⃣ Websocket dependency, which is the most important one for this project.</p><h4 id=\"enable-websocket\">Enable WebSocket</h4><p>Now that our project has required dependency, we are ready to write code to enable <strong>WebSocket</strong>. To enable websocket we need touse <code class=\"language-plaintext highlighter-rouge\">@EnableWebSocketMessageBroker</code>. You can create a new <code class=\"language-plaintext highlighter-rouge\">@Configuration</code> class or you can add to existing one. I will add this to our <strong><code class=\"language-plaintext highlighter-rouge\">main</code></strong>class.</p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@SpringBootApplication</span><span class=\"nd\">@EnableWebSocketMessageBroker</span><span class=\"kd\">class</span> <span class=\"nc\">DemoApplication</span><span class=\"k\">fun</span> <span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">:</span> <span class=\"nc\">Array</span><span class=\"p\">&lt;</span><span class=\"nc\">String</span><span class=\"p\">&gt;)</span> <span class=\"p\">{</span>    <span class=\"n\">runApplication</span><span class=\"p\">&lt;</span><span class=\"nc\">DemoApplication</span><span class=\"p\">&gt;(*</span><span class=\"n\">args</span><span class=\"p\">)</span><span class=\"p\">}</span></code></pre></div></div><p> </p><h4 id=\"configure-websocket-connect-endpoint\">Configure WebSocket Connect Endpoint</h4><p>We need to define a <strong>URL</strong> where client can establish a WebSocket connection. To define the endpoint we need to create a <code class=\"language-plaintext highlighter-rouge\">@Configuration</code> class thatextends <code class=\"language-plaintext highlighter-rouge\">WebSocketMessageBrokerConfigurer</code></p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@Configuration</span><span class=\"kd\">class</span> <span class=\"nc\">WebSocketConfiguration</span> <span class=\"p\">:</span> <span class=\"nc\">WebSocketMessageBrokerConfigurer</span> <span class=\"p\">{</span><span class=\"p\">}</span></code></pre></div></div><p>Inside of this class, we can override <code class=\"language-plaintext highlighter-rouge\">registerStompEndpoints(registry: StompEndpointRegistry)</code> method. The method has a <code class=\"language-plaintext highlighter-rouge\">StompEndpointRegistry</code> asparameter, which we can use to add our endpoint.</p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@Configuration</span><span class=\"kd\">class</span> <span class=\"nc\">WebSocketConfiguration</span> <span class=\"p\">:</span> <span class=\"nc\">WebSocketMessageBrokerConfigurer</span> <span class=\"p\">{</span>    <span class=\"k\">companion</span> <span class=\"k\">object</span> <span class=\"p\">{</span>        <span class=\"k\">const</span> <span class=\"kd\">val</span> <span class=\"py\">WEB_SOCKET_CONNECT_URL</span> <span class=\"p\">=</span> <span class=\"s\">\"/ws/connect\"</span> <span class=\"c1\">// 2️⃣</span>    <span class=\"p\">}</span>    <span class=\"k\">override</span> <span class=\"k\">fun</span> <span class=\"nf\">registerStompEndpoints</span><span class=\"p\">(</span><span class=\"n\">registry</span><span class=\"p\">:</span> <span class=\"nc\">StompEndpointRegistry</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">super</span><span class=\"p\">.</span><span class=\"nf\">registerStompEndpoints</span><span class=\"p\">(</span><span class=\"n\">registry</span><span class=\"p\">)</span>        <span class=\"n\">registry</span><span class=\"p\">.</span><span class=\"nf\">addEndpoint</span><span class=\"p\">(</span><span class=\"nc\">WEB_SOCKET_CONNECT_URL</span><span class=\"p\">)</span> <span class=\"c1\">// 1️⃣</span>            <span class=\"p\">.</span><span class=\"nf\">setAllowedOrigins</span><span class=\"p\">(</span><span class=\"s\">\"http://localhost:3000\"</span><span class=\"p\">)</span> <span class=\"c1\">// 3️⃣</span>            <span class=\"p\">.</span><span class=\"nf\">withSockJS</span><span class=\"p\">()</span> <span class=\"c1\">// 4️⃣</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>1️⃣ We use <code class=\"language-plaintext highlighter-rouge\">addEndpoint(url: String)</code> method to define our WebSocket connection endpoint.</p><p>2️⃣ We are setting our connection url to <code class=\"language-plaintext highlighter-rouge\">/ws/connect</code>. This is a static constant on Kotlin.</p><p>3️⃣ Whitelisting request coming from <code class=\"language-plaintext highlighter-rouge\">http://localhost:3000</code>. localhost:3000 will be our frontend dev server url.</p><p>4️⃣ Enable <strong>SockJS</strong> support. If some browser doesn’t support WebSocket, SockJS can setup alternatively approach without needing to change the code.This is almost like polyfill for WebSocket.</p><p>At this point we can create a client app that can connect with our WebSocket endpoint.</p><h4 id=\"creating-reactjs-app\">Creating ReactJS App</h4><p>  We will create a ReactJS App to play with our WebSocket API. I will be using <a target=\"_blank\" href=\"https://nextjs.org/\">NextJS</a> for this project. You don’t have to know NextJS to followthis tutorial.</p><p>To create a simple ReactJS App using NextJS you can use</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Tested on Node 17</span>npx create-next-app frontend</code></pre></div></div><p>Open frontend app on or IDE of choice. Open <code class=\"language-plaintext highlighter-rouge\">pages/index.js</code> and replace with following code.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">import</span> <span class=\"nx\">Link</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">next/link</span><span class=\"dl\">'</span><span class=\"k\">import</span> <span class=\"nx\">styles</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">../styles/Home.module.css</span><span class=\"dl\">'</span><span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"kd\">function</span> <span class=\"nx\">Home</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"k\">return</span> <span class=\"p\">(</span>        <span class=\"p\">&lt;</span><span class=\"nt\">div</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">container</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;</span><span class=\"nt\">main</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">main</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>                <span class=\"p\">&lt;</span><span class=\"nt\">div</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">linkWrapper</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>                    <span class=\"p\">&lt;</span><span class=\"nc\">Link</span> <span class=\"na\">href</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"dl\">\"</span><span class=\"s2\">/simple-chat-box</span><span class=\"dl\">\"</span><span class=\"si\">}</span><span class=\"p\">&gt;</span> // 1️⃣                        <span class=\"p\">&lt;</span><span class=\"nt\">a</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">link</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>Simple Chatbox<span class=\"p\">&lt;/</span><span class=\"nt\">a</span><span class=\"p\">&gt;</span>                    <span class=\"p\">&lt;/</span><span class=\"nc\">Link</span><span class=\"p\">&gt;</span>                <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;/</span><span class=\"nt\">main</span><span class=\"p\">&gt;</span>        <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>    <span class=\"p\">)</span><span class=\"p\">}</span></code></pre></div></div><p>1️⃣ We are creating a anchor tag that can navigate us to new page i.e <code class=\"language-plaintext highlighter-rouge\">/simple-chat-box</code></p><p>🤯 Ignore <code class=\"language-plaintext highlighter-rouge\">className</code> attribute for now. <code class=\"language-plaintext highlighter-rouge\">className</code> attribute doesn’t affect any functionality and is there for purly styling purpose.</p><p>Now inside of <strong>pages</strong> directory, create a new folder with name <code class=\"language-plaintext highlighter-rouge\">simple-chat-box</code>. Note this name must match 1️⃣. This is how <strong>NextJS</strong> handlesroutes.</p><p>Inside of the new folder create a <code class=\"language-plaintext highlighter-rouge\">index.js</code> which will get rendered when <code class=\"language-plaintext highlighter-rouge\">/simple-chat-box</code> route is called.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">import</span> <span class=\"nx\">SimpleChatBox</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">./SimpleChatBox.js</span><span class=\"dl\">'</span><span class=\"p\">;</span> <span class=\"c1\">// 1️⃣</span><span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"kd\">function</span> <span class=\"nx\">SimpleChatBoxIndex</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"k\">return</span> <span class=\"p\">&lt;</span><span class=\"nc\">SimpleChatBox</span><span class=\"p\">/&gt;</span><span class=\"p\">}</span></code></pre></div></div><p>1️⃣ We have not created this component yet. So let’s create one inside of <code class=\"language-plaintext highlighter-rouge\">pages/simple-chat-box</code> directory.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">import</span> <span class=\"o\">*</span> <span class=\"k\">as</span> <span class=\"nx\">styles</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">./index.module.scss</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"kd\">function</span> <span class=\"nx\">SimpleChatBox</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"k\">return</span> <span class=\"p\">(</span>        <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;</span><span class=\"nt\">main</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">main</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>                <span class=\"p\">&lt;</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>Simple Chat Box<span class=\"p\">&lt;/</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;/</span><span class=\"nt\">main</span><span class=\"p\">&gt;</span>        <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>    <span class=\"p\">)</span><span class=\"p\">}</span></code></pre></div></div><p> </p><h4 id=\"add-stomp-and-sockjs-dependency-on-reactapp\">Add Stomp and SockJS dependency on ReactAPP</h4><p>To make our frontend code bit easier we will use some open source library. On your <code class=\"language-plaintext highlighter-rouge\">package.json</code> add these line to your <code class=\"language-plaintext highlighter-rouge\">dependencies</code> section.</p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>    \"sockjs-client\": \"^1.5.2\",    \"webstomp-client\": \"^1.2.6\"</code></pre></div></div><p> </p><h4 id=\"reactjs-app-connect-with-websocket-api\">ReactJS App connect with WebSocket API</h4><p>All of our dependency is now in place. All left for us to do is to make appropriate call to establish a handshake. On our <code class=\"language-plaintext highlighter-rouge\">SimpleChatBox.js</code> add thiscode</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">import</span> <span class=\"o\">*</span> <span class=\"k\">as</span> <span class=\"nx\">styles</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">./index.module.scss</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"nx\">Stomp</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">webstomp-client</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"nx\">SockJS</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">sockjs-client</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"nx\">useEffect</span><span class=\"p\">,</span> <span class=\"nx\">useState</span><span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">react</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"kd\">function</span> <span class=\"nx\">SimpleChatBox</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"kd\">const</span> <span class=\"nx\">relativeWsConnectUrl</span> <span class=\"o\">=</span> <span class=\"dl\">'</span><span class=\"s1\">/ws/connect</span><span class=\"dl\">'</span><span class=\"p\">;</span> <span class=\"c1\">// 1️⃣</span>    <span class=\"kd\">const</span> <span class=\"nx\">wsConnectUrl</span> <span class=\"o\">=</span> <span class=\"s2\">`</span><span class=\"p\">${</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">REACT_APP_BACKEND_PROTOCOL</span><span class=\"p\">}</span><span class=\"s2\">://</span><span class=\"p\">${</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">REACT_APP_BACKEND_WS_URL</span><span class=\"p\">}</span><span class=\"s2\">:</span><span class=\"p\">${</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">REACT_APP_BACKEND_PORT</span><span class=\"p\">}${</span><span class=\"nx\">relativeWsConnectUrl</span><span class=\"p\">}</span><span class=\"s2\">`</span><span class=\"p\">;</span>    <span class=\"kd\">const</span> <span class=\"p\">[</span><span class=\"nx\">stompClient</span><span class=\"p\">,</span> <span class=\"nx\">setStompClient</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">useState</span><span class=\"p\">(</span><span class=\"kc\">null</span><span class=\"p\">);</span>    <span class=\"nx\">useEffect</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>        <span class=\"kd\">const</span> <span class=\"nx\">stompClient</span> <span class=\"o\">=</span> <span class=\"nx\">Stomp</span><span class=\"p\">.</span><span class=\"nx\">over</span><span class=\"p\">(</span><span class=\"nx\">SockJS</span><span class=\"p\">(</span><span class=\"nx\">wsConnectUrl</span><span class=\"p\">));</span> <span class=\"c1\">// 2️⃣ </span>        <span class=\"nx\">stompClient</span><span class=\"p\">.</span><span class=\"nx\">connect</span><span class=\"p\">({},</span> <span class=\"c1\">// 3️⃣</span>            <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>                <span class=\"nx\">setStompClient</span><span class=\"p\">(</span><span class=\"nx\">stompClient</span><span class=\"p\">);</span> <span class=\"c1\">// 4️⃣</span>            <span class=\"p\">})</span>    <span class=\"p\">},</span> <span class=\"p\">[]);</span>    <span class=\"k\">return</span> <span class=\"p\">(</span>        <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;</span><span class=\"nt\">main</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">main</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>                <span class=\"p\">&lt;</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>Simple Chat Box<span class=\"p\">&lt;/</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;/</span><span class=\"nt\">main</span><span class=\"p\">&gt;</span>        <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>    <span class=\"p\">)</span><span class=\"p\">}</span></code></pre></div></div><p>Because this is not ReactJS tutorial I will not go into details about ReactJS stuff. But let’s go through some important part of this code.</p><p>1️⃣ This is the same <strong>URL</strong> we defined on <strong>backend</strong> side. <code class=\"language-plaintext highlighter-rouge\">relativeWsConnectUrl</code> is used to construct full url for <code class=\"language-plaintext highlighter-rouge\">wsConnectUrl</code>. I am setting mybackend server URL as env variable, but feel free to change this to string literal.</p><p>2️⃣ Initialize <strong>SockJS</strong> and <strong>Stomp</strong> to establish a connection. This code is inside of <code class=\"language-plaintext highlighter-rouge\">useEffect()</code> so that we do this initialize and connect whencomponent is mounted.</p><p>3️⃣ Calling <code class=\"language-plaintext highlighter-rouge\">connect(header, successHandler, errorHandler)</code> method to initiate a handshake to our <strong>backend</strong> WebSocket url.</p><p>4️⃣ Saving our reference to our <code class=\"language-plaintext highlighter-rouge\">stompClient</code> for future use. Above code is saving reference after successful connection, but we can do that rightafter initialization if you want.</p><p>As a bonus let’s update our JSX to display some helpful message</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> <span class=\"k\">return</span> <span class=\"p\">(</span>        <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;</span><span class=\"nt\">main</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">main</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>                <span class=\"p\">&lt;</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>Simple Chat Box<span class=\"p\">&lt;/</span><span class=\"nt\">h1</span><span class=\"p\">&gt;</span>                <span class=\"p\">&lt;</span><span class=\"nt\">div</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">contentWrapper</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>                    <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>                        Websocket Connection: <span class=\"p\">&lt;</span><span class=\"nt\">b</span><span class=\"p\">&gt;</span><span class=\"si\">{</span><span class=\"nx\">stompClient</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"p\">?</span> <span class=\"dl\">'</span><span class=\"s1\">No Ready</span><span class=\"dl\">'</span> <span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Ready</span><span class=\"dl\">'</span><span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">b</span><span class=\"p\">&gt;&lt;</span><span class=\"nt\">br</span><span class=\"p\">/&gt;</span>                        Client Connected: <span class=\"p\">&lt;</span><span class=\"nt\">b</span><span class=\"p\">&gt;</span><span class=\"si\">{</span><span class=\"nx\">stompClient</span><span class=\"p\">?.</span><span class=\"nx\">connected</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"p\">?</span> <span class=\"dl\">'</span><span class=\"s1\">No</span><span class=\"dl\">'</span> <span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Yes</span><span class=\"dl\">'</span><span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">b</span><span class=\"p\">&gt;&lt;</span><span class=\"nt\">br</span><span class=\"p\">/&gt;</span>                    <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>                <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;/</span><span class=\"nt\">main</span><span class=\"p\">&gt;</span>        <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>    <span class=\"p\">)</span></code></pre></div></div><p>If you run <strong>backend</strong> and <strong>frontend</strong> now, and on frontend code if you navigate to <code class=\"language-plaintext highlighter-rouge\">/simple-chat-box</code> you should see WebSocket connection wassuccessful.</p><div class=\"language-text highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Websocket Connection: ReadyClient Connected: Yes</code></pre></div></div><p> </p><h4 id=\"add-subscription-endpoint\">Add Subscription Endpoint</h4><p>To add endpoint where client can subscribe to, we need to <strong>override</strong> <code class=\"language-plaintext highlighter-rouge\">configureMessageBroker(registry: MessageBrokerRegistry)</code> methodon <code class=\"language-plaintext highlighter-rouge\">WebSocketConfiguration</code>.</p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@Configuration</span><span class=\"kd\">class</span> <span class=\"nc\">WebSocketConfiguration</span> <span class=\"p\">:</span> <span class=\"nc\">WebSocketMessageBrokerConfigurer</span> <span class=\"p\">{</span>    <span class=\"k\">companion</span> <span class=\"k\">object</span> <span class=\"p\">{</span>        <span class=\"k\">const</span> <span class=\"kd\">val</span> <span class=\"py\">WEB_SOCKET_CONNECT_URL</span> <span class=\"p\">=</span> <span class=\"s\">\"/ws/connect\"</span>        <span class=\"k\">const</span> <span class=\"kd\">val</span> <span class=\"py\">SIMPLE_CHAT_BOX_URL</span> <span class=\"p\">=</span> <span class=\"s\">\"/ws/simple-chat-box\"</span> <span class=\"c1\">//3️⃣</span>    <span class=\"p\">}</span>    <span class=\"k\">override</span> <span class=\"k\">fun</span> <span class=\"nf\">registerStompEndpoints</span><span class=\"p\">(</span><span class=\"n\">registry</span><span class=\"p\">:</span> <span class=\"nc\">StompEndpointRegistry</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"k\">super</span><span class=\"p\">.</span><span class=\"nf\">registerStompEndpoints</span><span class=\"p\">(</span><span class=\"n\">registry</span><span class=\"p\">)</span>        <span class=\"n\">registry</span><span class=\"p\">.</span><span class=\"nf\">addEndpoint</span><span class=\"p\">(</span><span class=\"nc\">WEB_SOCKET_CONNECT_URL</span><span class=\"p\">)</span>            <span class=\"p\">.</span><span class=\"nf\">setAllowedOrigins</span><span class=\"p\">(</span><span class=\"s\">\"http://localhost:3000\"</span><span class=\"p\">)</span>            <span class=\"p\">.</span><span class=\"nf\">withSockJS</span><span class=\"p\">()</span>    <span class=\"p\">}</span>    <span class=\"k\">override</span> <span class=\"k\">fun</span> <span class=\"nf\">configureMessageBroker</span><span class=\"p\">(</span><span class=\"n\">registry</span><span class=\"p\">:</span> <span class=\"nc\">MessageBrokerRegistry</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"c1\">// 1️⃣</span>        <span class=\"k\">super</span><span class=\"p\">.</span><span class=\"nf\">configureMessageBroker</span><span class=\"p\">(</span><span class=\"n\">registry</span><span class=\"p\">)</span>        <span class=\"n\">registry</span><span class=\"p\">.</span><span class=\"nf\">enableSimpleBroker</span><span class=\"p\">(</span><span class=\"nc\">SIMPLE_CHAT_BOX_URL</span><span class=\"p\">)</span> <span class=\"c1\">// 2️⃣</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>1️⃣ Implementation for method to <strong>override</strong></p><p>2️⃣ We use <code class=\"language-plaintext highlighter-rouge\">enableSimpleBroker(vararg url: String)</code>. <strong>varargs</strong> simply means this methods can accept multiple url separated by comma. This willcreate a <strong>in-memory</strong> broker.</p><p>3️⃣ URL where client can subscribe to get our messages.</p><h4 id=\"reactjs-app-add-a-code-to-subscribe\">ReactJS App Add a Code To Subscribe</h4><p>Our <strong>backend</strong> code is now configured to send message to specific urls (<code class=\"language-plaintext highlighter-rouge\">/ws/simple-chat-box</code> for us).</p><p>Note: We can somehow subscribe to any URL we want to e.g even <code class=\"language-plaintext highlighter-rouge\">/xyx/foo</code>. I don’t know why this works. If I ever find the reason I will update my finding here.Later in the post I will let you know benefit of explicitly defining our <strong>subscription endpoint</strong>.</p><p>On our <code class=\"language-plaintext highlighter-rouge\">SimpleChatBox.js</code> let’s update our UI to include the <strong>Join Chat</strong> button.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">const</span> <span class=\"nx\">onClickJoinChat</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"kd\">const</span> <span class=\"nx\">subRef</span> <span class=\"o\">=</span> <span class=\"nx\">stompClient</span><span class=\"p\">.</span><span class=\"nx\">subscribe</span><span class=\"p\">(</span><span class=\"nx\">destinationUrl</span><span class=\"p\">,</span> <span class=\"nx\">onMessageReceived</span><span class=\"p\">);</span> <span class=\"c1\">// 2️⃣</span>    <span class=\"nx\">setSubscriptionRef</span><span class=\"p\">(</span><span class=\"nx\">subRef</span><span class=\"p\">);</span><span class=\"p\">};</span><span class=\"p\">&lt;</span><span class=\"nt\">button</span> <span class=\"na\">disabled</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">stompClient</span> <span class=\"o\">===</span> <span class=\"kc\">null</span><span class=\"si\">}</span> <span class=\"c1\">// 1️⃣</span>        <span class=\"na\">onClick</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">onClickJoinChat</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>    Join Chat<span class=\"p\">&lt;/</span><span class=\"nt\">button</span><span class=\"p\">&gt;</span></code></pre></div></div><p>1️⃣ Button implementation for Join Chat</p><p>2️⃣ We use <strong>stompClient</strong> <code class=\"language-plaintext highlighter-rouge\">subscribe()</code> to subscribe to a specific URL. The first param for the method is the URL you want to subscribe to. Second parameter is a callback that gets called when you receive a update from the URL.</p><h4 id=\"reactjs-app-send-message-to-subscription-url\">ReactJS App Send Message To Subscription URL</h4><p>We subscribed to a specific destination URL, but if no one update the subscription, no one will get an update.To <strong>send</strong> a message to subscription we can use</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">const</span> <span class=\"nx\">onChangeUserText</span> <span class=\"o\">=</span> <span class=\"p\">({</span><span class=\"na\">target</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"p\">}})</span> <span class=\"o\">=&gt;</span> <span class=\"p\">(</span><span class=\"nx\">setUserText</span><span class=\"p\">(</span><span class=\"nx\">value</span><span class=\"p\">))</span><span class=\"kd\">const</span> <span class=\"nx\">onKeyDownUserText</span> <span class=\"o\">=</span> <span class=\"p\">({</span><span class=\"nx\">keyCode</span><span class=\"p\">})</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">subscriptionRef</span> <span class=\"o\">!==</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">keyCode</span> <span class=\"o\">===</span> <span class=\"mi\">13</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"c1\">// Enter</span>        <span class=\"nx\">sendMessage</span><span class=\"p\">()</span>    <span class=\"p\">}</span><span class=\"p\">}</span><span class=\"kd\">const</span> <span class=\"nx\">sendMessage</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"nx\">stompClient</span><span class=\"p\">.</span><span class=\"nx\">send</span><span class=\"p\">(</span><span class=\"nx\">destinationUrl</span><span class=\"p\">,</span> <span class=\"nx\">userText</span><span class=\"p\">)</span> <span class=\"c1\">// 2️⃣</span><span class=\"p\">}</span><span class=\"p\">&lt;</span><span class=\"nt\">input</span> <span class=\"na\">placeholder</span><span class=\"p\">=</span><span class=\"s\">\"Enter your message\"</span> <span class=\"c1\">// 1️⃣</span>        <span class=\"na\">type</span><span class=\"p\">=</span><span class=\"s\">\"text\"</span>        <span class=\"na\">value</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">userText</span><span class=\"si\">}</span>        <span class=\"na\">onChange</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">onChangeUserText</span><span class=\"si\">}</span>        <span class=\"na\">onKeyDown</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">onKeyDownUserText</span><span class=\"si\">}</span><span class=\"p\">/&gt;</span></code></pre></div></div><p>1️⃣ Input field where user can type their messages.</p><p>2️⃣ Using <strong>stompClient</strong> to send the message to destinationUrl.<code class=\"language-plaintext highlighter-rouge\">send()</code> has multiple implementation, the one I am using take two parameter.First parameter is URL where you want to send message to.Second parameter is the actual message you want to send. For us it is a <code class=\"language-plaintext highlighter-rouge\">userText</code> as user entered value gets stored on that variable.</p><p>Now we have mechanism in place to <strong>send</strong> message. But what good is sending message if you can’t see it right?Let’s add that part in.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">&lt;</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span><span class=\"si\">{</span><span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">(</span><span class=\"nx\">messageHistory</span><span class=\"p\">,</span> <span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">  </span><span class=\"dl\">'</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span> <span class=\"c1\">// 1️⃣</span></code></pre></div></div><p>1️⃣ Here’s <code class=\"language-plaintext highlighter-rouge\">messageHistory</code> will store the list of messages that client receives.</p><p>But how does <code class=\"language-plaintext highlighter-rouge\">messageHistory</code> gets updated? Remember <code class=\"language-plaintext highlighter-rouge\">onMessageReceived</code> callback we passed when we subscribed to destination URL?. Here’s a implementation for that method.</p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">const</span> <span class=\"nx\">onMessageReceived</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">newState</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"nx\">setMessageHistory</span><span class=\"p\">(</span><span class=\"nx\">previousState</span> <span class=\"o\">=&gt;</span> <span class=\"p\">[...</span><span class=\"nx\">previousState</span><span class=\"p\">,</span> <span class=\"nx\">newState</span><span class=\"p\">.</span><span class=\"nx\">body</span><span class=\"p\">])</span>    <span class=\"nx\">setUserText</span><span class=\"p\">(</span><span class=\"dl\">''</span><span class=\"p\">)</span><span class=\"p\">};</span></code></pre></div></div><p><strong>Dang!! this is getting complex. Show me the whole code</strong></p><div class=\"language-jsx highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">import</span> <span class=\"o\">*</span> <span class=\"k\">as</span> <span class=\"nx\">styles</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">./index.module.scss</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"nx\">Head</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">next/head.js</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"p\">{</span><span class=\"nx\">useEffect</span><span class=\"p\">,</span> <span class=\"nx\">useState</span><span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">react</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"nx\">SockJS</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">sockjs-client</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">import</span> <span class=\"nx\">Stomp</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">webstomp-client</span><span class=\"dl\">'</span><span class=\"p\">;</span><span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"kd\">function</span> <span class=\"nx\">SimpleChatBox</span><span class=\"p\">()</span> <span class=\"p\">{</span>  <span class=\"kd\">const</span> <span class=\"nx\">wsConnectUrl</span> <span class=\"o\">=</span> <span class=\"s2\">`</span><span class=\"p\">${</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">REACT_APP_BACKEND_PROTOCOL</span><span class=\"p\">}</span><span class=\"s2\">://</span><span class=\"p\">${</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">REACT_APP_BACKEND_WS_URL</span><span class=\"p\">}</span><span class=\"s2\">:</span><span class=\"p\">${</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">REACT_APP_BACKEND_PORT</span><span class=\"p\">}</span><span class=\"s2\">/ws/connect`</span><span class=\"p\">;</span>  <span class=\"kd\">const</span> <span class=\"nx\">destinationUrl</span> <span class=\"o\">=</span> <span class=\"dl\">'</span><span class=\"s1\">/ws/simple-chat-box</span><span class=\"dl\">'</span>  <span class=\"kd\">const</span> <span class=\"p\">[</span><span class=\"nx\">stompClient</span><span class=\"p\">,</span> <span class=\"nx\">setStompClient</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">useState</span><span class=\"p\">(</span><span class=\"kc\">null</span><span class=\"p\">);</span>  <span class=\"kd\">const</span> <span class=\"p\">[</span><span class=\"nx\">messageHistory</span><span class=\"p\">,</span> <span class=\"nx\">setMessageHistory</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">useState</span><span class=\"p\">([]);</span>  <span class=\"kd\">const</span> <span class=\"p\">[</span><span class=\"nx\">subscriptionRef</span><span class=\"p\">,</span> <span class=\"nx\">setSubscriptionRef</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">useState</span><span class=\"p\">(</span><span class=\"kc\">null</span><span class=\"p\">);</span>  <span class=\"kd\">const</span> <span class=\"p\">[</span><span class=\"nx\">userText</span><span class=\"p\">,</span> <span class=\"nx\">setUserText</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nx\">useState</span><span class=\"p\">(</span><span class=\"dl\">''</span><span class=\"p\">);</span>  <span class=\"nx\">useEffect</span><span class=\"p\">(()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"kd\">const</span> <span class=\"nx\">stompClient</span> <span class=\"o\">=</span> <span class=\"nx\">Stomp</span><span class=\"p\">.</span><span class=\"nx\">over</span><span class=\"p\">(</span><span class=\"nx\">SockJS</span><span class=\"p\">(</span><span class=\"nx\">wsConnectUrl</span><span class=\"p\">))</span>    <span class=\"nx\">stompClient</span><span class=\"p\">.</span><span class=\"nx\">connect</span><span class=\"p\">({},</span>      <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>        <span class=\"nx\">setStompClient</span><span class=\"p\">(</span><span class=\"nx\">stompClient</span><span class=\"p\">)</span>      <span class=\"p\">})</span>  <span class=\"p\">},</span> <span class=\"p\">[]);</span>  <span class=\"kd\">const</span> <span class=\"nx\">onMessageReceived</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">newState</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"nx\">setMessageHistory</span><span class=\"p\">(</span><span class=\"nx\">previousState</span> <span class=\"o\">=&gt;</span> <span class=\"p\">[...</span><span class=\"nx\">previousState</span><span class=\"p\">,</span> <span class=\"nx\">newState</span><span class=\"p\">.</span><span class=\"nx\">body</span><span class=\"p\">])</span>    <span class=\"nx\">setUserText</span><span class=\"p\">(</span><span class=\"dl\">''</span><span class=\"p\">)</span>  <span class=\"p\">};</span>  <span class=\"kd\">const</span> <span class=\"nx\">onClickJoinChat</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"kd\">const</span> <span class=\"nx\">subRef</span> <span class=\"o\">=</span> <span class=\"nx\">stompClient</span><span class=\"p\">.</span><span class=\"nx\">subscribe</span><span class=\"p\">(</span><span class=\"nx\">destinationUrl</span><span class=\"p\">,</span> <span class=\"nx\">onMessageReceived</span><span class=\"p\">)</span>    <span class=\"nx\">setSubscriptionRef</span><span class=\"p\">(</span><span class=\"nx\">subRef</span><span class=\"p\">)</span>  <span class=\"p\">};</span>  <span class=\"kd\">const</span> <span class=\"nx\">onChangeUserText</span> <span class=\"o\">=</span> <span class=\"p\">({</span><span class=\"na\">target</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"nx\">value</span><span class=\"p\">}})</span> <span class=\"o\">=&gt;</span> <span class=\"p\">(</span><span class=\"nx\">setUserText</span><span class=\"p\">(</span><span class=\"nx\">value</span><span class=\"p\">))</span>  <span class=\"kd\">const</span> <span class=\"nx\">onKeyDownUserText</span> <span class=\"o\">=</span> <span class=\"p\">({</span><span class=\"nx\">keyCode</span><span class=\"p\">})</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">subscriptionRef</span> <span class=\"o\">!==</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">keyCode</span> <span class=\"o\">===</span> <span class=\"mi\">13</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"c1\">// Enter</span>      <span class=\"nx\">sendMessage</span><span class=\"p\">()</span>    <span class=\"p\">}</span>  <span class=\"p\">}</span>  <span class=\"kd\">const</span> <span class=\"nx\">sendMessage</span> <span class=\"o\">=</span> <span class=\"p\">()</span> <span class=\"o\">=&gt;</span> <span class=\"p\">{</span>    <span class=\"nx\">stompClient</span><span class=\"p\">.</span><span class=\"nx\">send</span><span class=\"p\">(</span><span class=\"nx\">destinationUrl</span><span class=\"p\">,</span> <span class=\"nx\">userText</span><span class=\"p\">)</span>  <span class=\"p\">}</span>  <span class=\"k\">return</span> <span class=\"p\">(</span>    <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>      <span class=\"p\">&lt;</span><span class=\"nc\">Head</span><span class=\"p\">&gt;</span>        <span class=\"p\">&lt;</span><span class=\"nt\">title</span><span class=\"p\">&gt;</span>Simple Chat App<span class=\"p\">&lt;/</span><span class=\"nt\">title</span><span class=\"p\">&gt;</span>      <span class=\"p\">&lt;/</span><span class=\"nc\">Head</span><span class=\"p\">&gt;</span>      <span class=\"p\">&lt;</span><span class=\"nt\">main</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">main</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>        <span class=\"p\">&lt;</span><span class=\"nt\">div</span> <span class=\"na\">className</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">styles</span><span class=\"p\">.</span><span class=\"nx\">contentWrapper</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>          <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>            Websocket Connection: <span class=\"p\">&lt;</span><span class=\"nt\">b</span><span class=\"p\">&gt;</span><span class=\"si\">{</span><span class=\"nx\">stompClient</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"p\">?</span> <span class=\"dl\">'</span><span class=\"s1\">No Ready</span><span class=\"dl\">'</span> <span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Ready</span><span class=\"dl\">'</span><span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">b</span><span class=\"p\">&gt;&lt;</span><span class=\"nt\">br</span><span class=\"p\">/&gt;</span>            Client Connected: <span class=\"p\">&lt;</span><span class=\"nt\">b</span><span class=\"p\">&gt;</span><span class=\"si\">{</span><span class=\"nx\">stompClient</span><span class=\"p\">?.</span><span class=\"nx\">connected</span> <span class=\"o\">==</span> <span class=\"kc\">null</span> <span class=\"p\">?</span> <span class=\"dl\">'</span><span class=\"s1\">No</span><span class=\"dl\">'</span> <span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Yes</span><span class=\"dl\">'</span><span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">b</span><span class=\"p\">&gt;&lt;</span><span class=\"nt\">br</span><span class=\"p\">/&gt;</span>          <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>          <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>            <span class=\"si\">{</span><span class=\"nx\">subscriptionRef</span> <span class=\"o\">==</span> <span class=\"kc\">null</span>              <span class=\"p\">?</span> <span class=\"p\">&lt;</span><span class=\"nt\">button</span> <span class=\"na\">disabled</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">stompClient</span> <span class=\"o\">===</span> <span class=\"kc\">null</span><span class=\"si\">}</span>                        <span class=\"na\">onClick</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">onClickJoinChat</span><span class=\"si\">}</span><span class=\"p\">&gt;</span>                Join Chat              <span class=\"p\">&lt;/</span><span class=\"nt\">button</span><span class=\"p\">&gt;</span>              <span class=\"p\">:</span> <span class=\"dl\">''</span>            <span class=\"si\">}</span>          <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>          <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span><span class=\"si\">{</span><span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">(</span><span class=\"nx\">messageHistory</span><span class=\"p\">,</span> <span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">  </span><span class=\"dl\">'</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"p\">&lt;/</span><span class=\"nt\">pre</span><span class=\"p\">&gt;</span>            <span class=\"p\">&lt;</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>              <span class=\"p\">&lt;</span><span class=\"nt\">input</span> <span class=\"na\">placeholder</span><span class=\"p\">=</span><span class=\"s\">\"Enter your message\"</span>                     <span class=\"na\">type</span><span class=\"p\">=</span><span class=\"s\">\"text\"</span>                     <span class=\"na\">value</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">userText</span><span class=\"si\">}</span>                     <span class=\"na\">onChange</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">onChangeUserText</span><span class=\"si\">}</span>                     <span class=\"na\">onKeyDown</span><span class=\"p\">=</span><span class=\"si\">{</span><span class=\"nx\">onKeyDownUserText</span><span class=\"si\">}</span><span class=\"p\">/&gt;</span>            <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>          <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>        <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>      <span class=\"p\">&lt;/</span><span class=\"nt\">main</span><span class=\"p\">&gt;</span>    <span class=\"p\">&lt;/</span><span class=\"nt\">div</span><span class=\"p\">&gt;</span>  <span class=\"p\">)</span><span class=\"p\">}</span></code></pre></div></div><p>If you run both <strong>backend</strong> and <strong>frontend</strong>. You should have a working basic chat system. Make sure you open two browser and try it out.</p><p> </p><h4 id=\"sending-message-to-client-when-they-subscribe---subscribemapping\">Sending message to client when they subscribe - @SubscribeMapping</h4><p>To send message to client when they subscribe, we need to add a <code class=\"language-plaintext highlighter-rouge\">@Controller</code>.</p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@Controller</span> <span class=\"c1\">// 1️⃣</span><span class=\"kd\">class</span> <span class=\"nc\">SimpleChatBoxController</span> <span class=\"p\">{</span>    <span class=\"k\">companion</span> <span class=\"k\">object</span> <span class=\"p\">{</span>        <span class=\"k\">const</span> <span class=\"kd\">val</span> <span class=\"py\">BASE_URL</span> <span class=\"p\">=</span> <span class=\"nc\">WebSocketConfiguration</span><span class=\"p\">.</span><span class=\"nc\">SIMPLE_CHAT_BOX_URL</span>    <span class=\"p\">}</span>    <span class=\"nd\">@SubscribeMapping</span><span class=\"p\">(</span><span class=\"nc\">BASE_URL</span><span class=\"p\">)</span> <span class=\"c1\">// 2️⃣</span>    <span class=\"nd\">@SendTo</span><span class=\"p\">(</span><span class=\"nc\">BASE_URL</span><span class=\"p\">)</span> <span class=\"c1\">// 3️⃣</span>    <span class=\"k\">fun</span> <span class=\"nf\">welcomeToTheChat</span><span class=\"p\">():</span> <span class=\"nc\">String</span> <span class=\"p\">{</span>        <span class=\"k\">return</span> <span class=\"s\">\"Someone joined the chat\"</span><span class=\"p\">;</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>1️⃣ Define a @Controller to add our <strong>WebSocket</strong> mapping.</p><p>2️⃣ @SubscribeMapping - The method will get called whenever client subscribes to provided URL on @SubscribeMapping.</p><p>3️⃣ @SendTo - Whatever method returns will be published to the destination URL passed into @SendTo</p><p>Alternative way to send message with <strong>SimpMessagingTemplate</strong></p><div class=\"language-kotlin highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@Controller</span><span class=\"kd\">class</span> <span class=\"nc\">SimpleChatBoxController</span><span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"py\">client</span><span class=\"p\">:</span> <span class=\"nc\">SimpMessagingTemplate</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">companion</span> <span class=\"k\">object</span> <span class=\"p\">{</span>        <span class=\"k\">const</span> <span class=\"kd\">val</span> <span class=\"py\">BASE_URL</span> <span class=\"p\">=</span> <span class=\"nc\">WebSocketConfiguration</span><span class=\"p\">.</span><span class=\"nc\">SIMPLE_CHAT_BOX_URL</span>    <span class=\"p\">}</span>    <span class=\"nd\">@SubscribeMapping</span><span class=\"p\">(</span><span class=\"nc\">BASE_URL</span><span class=\"p\">)</span>    <span class=\"k\">fun</span> <span class=\"nf\">welcomeToTheChat</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"n\">client</span><span class=\"p\">.</span><span class=\"nf\">convertAndSend</span><span class=\"p\">(</span><span class=\"nc\">BASE_URL</span><span class=\"p\">,</span> <span class=\"s\">\"Someone joined the chat\"</span><span class=\"p\">)</span>    <span class=\"p\">}</span><span class=\"p\">}</span></code></pre></div></div><p>Note: This is the benefit of explicitly defining our endpoint. @SubscribeMapping URL only works when url is registered on our WebSocket configuration.</p><hr /><p>References:</p><ul>  <li><a target=\"_blank\" href=\"https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket\">Spring Websocket Documentation</a></li></ul>",
            "url": "https://babal.dev/2021/12/22/websocket-basics-with-spring-boot",
            
            
            
            "tags": ["java","kotlin","websocket","spring","spring-boot","reactjs"],
            
            "date_published": "2021-12-22T00:00:00-05:00",
            "date_modified": "2021-12-22T00:00:00-05:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2017/10/16/java-9-open-and-opens-keyword-with-example",
            "title": "Java open and opens keyword with example",
            "summary": "Java open and opens keyword with example",
            "content_text": "We have come a long way to exploring the Java Platform Module System.Java 9 Module System IntroJava 9 using exports and requiresExport to specific modules onlyTransitive Dependency in Java 9Java 9 Automatic ModulesIn this post we will look at open and opens keyword.To make a long story short, we use open and opens keyword on module-info.java file, if we want to providereflection API access to module packages.We will be working with following directory structure. (All files are empty right now)└── src    ├── com.exported    │   ├── com    │   │   └── exported    │   │       └── Exported.java    │   └── module-info.java    ├── com.user    │   ├── com    │   │   └── user    │   │       └── User.java    │   └── module-info.java    └── com.usertwo        ├── com        │   └── usertwo        │       └── UserTwo.java        └── module-info.javaLet’s look at our first module com.exported. module-info.java file is simplemodule com.exported {    exports com.exported;}This com.exported/module-info.java simply defines module and exportes some packages. This is nothing we haven’t seenyet.Here’s a content of com.exported.Exorted.javapackage com.exported;public class Exported {    public String callMe() {        return \"callMe\";    }}For now this class is simple, with just one public method.Notice: we haven’t used open / opens yet.In module com.user module-info.java file we have fairly simple code as well.module com.user {    requires com.exported;}If we look at com.user.User.java we have code that uses reflection.package com.user;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;public class User {    public static void main(String[] args) throws Exception {        Class&lt;?&gt; exportedClass = Class.forName(\"com.exported.Exported\");        Constructor&lt;?&gt; con = exportedClass.getDeclaredConstructor();        con.setAccessible(true);        Object exportedObj = con.newInstance();        Method m;        m = exportedObj.getClass().getMethod(\"callMe\");        m.setAccessible(true);        System.out.println(\"Public : \" + m.invoke(exportedObj));    }}If we compile and run the program we get following resultjavac -d mods --module-source-path src $(find src -name \"*.java\")java --module-path mods -m com.user/com.user.User--- OUTPUT ---Public : callMeWait!!!Earlier in the post I said that I had to use open / opens keyword if I wanted to give reflection API access tomodules code. Why am I able to use reflection now then?. Of course because this is publicly available exportedpackage.Let’s add some code to twist this example. On com.exported.Exported.java add one private method.package com.exported;public class Exported {    public String callMe() {        return \"callMe\";    }    private String callMePrivate() {        return \"callMePrivate\";    }}Now on com.user.User.java let’s add reflection code to access that method.package com.user;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;public class User {    public static void main(String[] args) throws Exception {        Class&lt;?&gt; exportedClass = Class.forName(\"com.exported.Exported\");        Constructor&lt;?&gt; con = exportedClass.getDeclaredConstructor();        con.setAccessible(true);        Object exportedObj = con.newInstance();        Method m;        m = exportedObj.getClass().getMethod(\"callMe\");        m.setAccessible(true);        System.out.println(\"Public : \" + m.invoke(exportedObj));        m = exportedObj.getClass().getDeclaredMethod(\"callMePrivate\");        m.setAccessible(true);        System.out.println(\"Private : \" + m.invoke(exportedObj));    }}Compile and run it and we will get following outputjavac -d mods --module-path ./jars/ --module-source-path src $(find src -name \"*.java\")java --module-path ./jars/:mods -m com.user/com.user.User--- OUTPUT ---Public : callMeException in thread \"main\" java.lang.reflect.InaccessibleObjectException: Unable to make private java.lang.String com.exported.Exported.callMePrivate() accessible: module com.exported does not \"opens com.exported\" to module com.user        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:337)        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:281)        at java.base/java.lang.reflect.Method.checkCanSetAccessible(Method.java:198)        at java.base/java.lang.reflect.Method.setAccessible(Method.java:192)        at com.user/com.user.User.main(User.java:22)Notice we were able to access the public method with help of reflection but not private method. And the errorclearly states that we are not adding statement opens com.exported. So let’s do thaton com.exported/module-info.java.module com.exported {    exports com.exported;    opens com.exported;}Now if we compile and run the code we will get the following resultjavac -d mods --module-path ./jars/ --module-source-path src $(find src -name \"*.java\")java --module-path ./jars/:mods -m com.user/com.user.User--- OUTPUT ---Public : callMePrivate : callMePrivateWe can take this even further. Because we are using reflection to access the public method as well we canremote exports com.exported statement from com.exported/module-info.java.We used opens keyword and there more to it, but before going further on opens I want to talk about open keyword.So we use open keyword when we want to make all of the packages on the module to be accessed by reflection API.Because this is for all of the packages we use open on module decleration level.open module com.exported {}If you compile and run the command now it will run fine. But for the moment let’s step back and foucus more on openskeyword. You know now that opens is used if we want selected package to be accessed by reflection API. But what if youwant to give open access to only certain packages. Like exports .. to, we have opens .. to which enables use togive a fine grain access control mechanism even for reflection API.Let’s see this in action shall we.For this we will update our com.exported/module-info.java so that it opens its packages only to com.user module.module com.exported {    opens com.exported to com.user;}If you run the program now of course it runs right. By the if you are thinking why I removed open keyword we can’tcombine those.So com.user module code remains same.On our third module com.usertwo let’s add some code (Basically same as com.user)Here’s com.usertwo/module-info.javamodule com.usertwo {    requires com.exported;}package com.usertwo;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;// This class cannot use reflection API for com.exporter.Exportedpublic class UserTwo {    public static void main(String[] args) throws Exception {        Class&lt;?&gt; exportedClass = Class.forName(\"com.exported.Exported\");        Constructor&lt;?&gt; con = exportedClass.getDeclaredConstructor();        con.setAccessible(true);        Object exportedObj = con.newInstance();        Method m;        m = exportedObj.getClass().getMethod(\"callMe\");        m.setAccessible(true);        System.out.println(\"Public : \" + m.invoke(exportedObj));        m = exportedObj.getClass().getDeclaredMethod(\"callMePrivate\");        m.setAccessible(true);        System.out.println(\"Private : \" + m.invoke(exportedObj));    }}If we run com.user/com/user/User.java as main class we will run our program successfully. But let’s try to run ourprogram with main class com.usertwo/com/usertwo/UserTwo.java.javac -d mods --module-path ./jars/ --module-source-path src $(find src -name \"*.java\")java --module-path ./jars/:mods -m com.usertwo/com.usertwo.UserTwo--- OUTPUT ---Exception in thread \"main\" java.lang.reflect.InaccessibleObjectException: Unable to make public com.exported.Exported() accessible: module com.exported does not \"exports com.exported\" to module com.usertwo        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:337)        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:281)        at java.base/java.lang.reflect.Constructor.checkCanSetAccessible(Constructor.java:192)        at java.base/java.lang.reflect.Constructor.setAccessible(Constructor.java:185)        at com.usertwo/com.usertwo.UserTwo.main(UserTwo.java:12)We will get this kind of error, it’s because we have delecated opens to com.user only. And for other package this isstill not accesssable.By the way, did you notice we were using requires com.exported; on both module. Even thought we are using reflectionAPI to access the code. We need to declare that we are using code from that module or else we will get a error.avac -d mods --module-path ./jars/ --module-source-path src $(find src -name \"*.java\")java --module-path ./jars/:mods -m com.user/com.user.User--- OUTPUT ---Exception in thread \"main\" java.lang.ClassNotFoundException: com.exported.Exported        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:582)        at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:185)        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:496)        at java.base/java.lang.Class.forName0(Native Method)        at java.base/java.lang.Class.forName(Class.java:292)        at com.user/com.user.User.main(User.java:10)So this is it for open and opens keyword. You can findthe Github code here",
            "content_html": "<p>We have come a long way to exploring the Java Platform Module System.</p><p><a href=\"/2017/10/03/java-9-module-intro\">Java 9 Module System Intro</a></p><p><a href=\"/2017/10/04/java-9-exports-and-requires\">Java 9 using exports and requires</a></p><p><a href=\"/2017/10/05/java-export-module-to-specific-module-only\">Export to specific modules only</a></p><p><a href=\"/2017/10/05/java-using-transitive-dependency\">Transitive Dependency in Java 9</a></p><p><a href=\"/2017/10/09/java-9-automatic-module-with-example\">Java 9 Automatic Modules</a></p><p>In this post we will look at <code class=\"language-plaintext highlighter-rouge\">open</code> and <code class=\"language-plaintext highlighter-rouge\">opens</code> keyword.</p><p>To make a long story short, we use <code class=\"language-plaintext highlighter-rouge\">open</code> and <code class=\"language-plaintext highlighter-rouge\">opens</code> keyword on <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> file, if we want to providereflection API access to module packages.</p><p>We will be working with following directory structure. (All files are empty right now)</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>└── src    ├── com.exported    │   ├── com    │   │   └── exported    │   │       └── Exported.java    │   └── module-info.java    ├── com.user    │   ├── com    │   │   └── user    │   │       └── User.java    │   └── module-info.java    └── com.usertwo        ├── com        │   └── usertwo        │       └── UserTwo.java        └── module-info.java</code></pre></div></div><p>Let’s look at our first module <code class=\"language-plaintext highlighter-rouge\">com.exported</code>. <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> file is simple</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span> <span class=\"o\">{</span>    <span class=\"n\">exports</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><p>This <code class=\"language-plaintext highlighter-rouge\">com.exported/module-info.java</code> simply defines module and exportes some packages. This is nothing we haven’t seenyet.</p><p>Here’s a content of <code class=\"language-plaintext highlighter-rouge\">com.exported.Exorted.java</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.exported</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Exported</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"nc\">String</span> <span class=\"nf\">callMe</span><span class=\"o\">()</span> <span class=\"o\">{</span>        <span class=\"k\">return</span> <span class=\"s\">\"callMe\"</span><span class=\"o\">;</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>For now this class is simple, with just one <code class=\"language-plaintext highlighter-rouge\">public</code> method.</p><p>Notice: we haven’t used <code class=\"language-plaintext highlighter-rouge\">open</code> / <code class=\"language-plaintext highlighter-rouge\">opens</code> yet.</p><p>In module <code class=\"language-plaintext highlighter-rouge\">com.user</code> <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> file we have fairly simple code as well.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">user</span> <span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><p>If we look at <code class=\"language-plaintext highlighter-rouge\">com.user.User.java</code> we have code that uses reflection.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.user</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.Constructor</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.InvocationTargetException</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.Method</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">User</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"nc\">Exception</span> <span class=\"o\">{</span>        <span class=\"nc\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">exportedClass</span> <span class=\"o\">=</span> <span class=\"nc\">Class</span><span class=\"o\">.</span><span class=\"na\">forName</span><span class=\"o\">(</span><span class=\"s\">\"com.exported.Exported\"</span><span class=\"o\">);</span>        <span class=\"nc\">Constructor</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">con</span> <span class=\"o\">=</span> <span class=\"n\">exportedClass</span><span class=\"o\">.</span><span class=\"na\">getDeclaredConstructor</span><span class=\"o\">();</span>        <span class=\"n\">con</span><span class=\"o\">.</span><span class=\"na\">setAccessible</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>        <span class=\"nc\">Object</span> <span class=\"n\">exportedObj</span> <span class=\"o\">=</span> <span class=\"n\">con</span><span class=\"o\">.</span><span class=\"na\">newInstance</span><span class=\"o\">();</span>        <span class=\"nc\">Method</span> <span class=\"n\">m</span><span class=\"o\">;</span>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">exportedObj</span><span class=\"o\">.</span><span class=\"na\">getClass</span><span class=\"o\">().</span><span class=\"na\">getMethod</span><span class=\"o\">(</span><span class=\"s\">\"callMe\"</span><span class=\"o\">);</span>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">setAccessible</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Public : \"</span> <span class=\"o\">+</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">invoke</span><span class=\"o\">(</span><span class=\"n\">exportedObj</span><span class=\"o\">));</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>If we compile and run the program we get following result</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>javac <span class=\"nt\">-d</span> mods <span class=\"nt\">--module-source-path</span> src <span class=\"si\">$(</span>find src <span class=\"nt\">-name</span> <span class=\"s2\">\"*.java\"</span><span class=\"si\">)</span>java <span class=\"nt\">--module-path</span> mods <span class=\"nt\">-m</span> com.user/com.user.User<span class=\"nt\">---</span> OUTPUT <span class=\"nt\">---</span>Public : callMe</code></pre></div></div><h3 id=\"wait\">Wait!!!</h3><p>Earlier in the post I said that I had to use <code class=\"language-plaintext highlighter-rouge\">open</code> / <code class=\"language-plaintext highlighter-rouge\">opens</code> keyword if I wanted to give reflection API access tomodules code. Why am I able to use reflection now then?. Of course because this is <strong>publicly available exportedpackage.</strong></p><p>Let’s add some code to twist this example. On <code class=\"language-plaintext highlighter-rouge\">com.exported.Exported.java</code> add one <code class=\"language-plaintext highlighter-rouge\">private</code> method.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.exported</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Exported</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"nc\">String</span> <span class=\"nf\">callMe</span><span class=\"o\">()</span> <span class=\"o\">{</span>        <span class=\"k\">return</span> <span class=\"s\">\"callMe\"</span><span class=\"o\">;</span>    <span class=\"o\">}</span>    <span class=\"kd\">private</span> <span class=\"nc\">String</span> <span class=\"nf\">callMePrivate</span><span class=\"o\">()</span> <span class=\"o\">{</span>        <span class=\"k\">return</span> <span class=\"s\">\"callMePrivate\"</span><span class=\"o\">;</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>Now on <code class=\"language-plaintext highlighter-rouge\">com.user.User.java</code> let’s add reflection code to access that method.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.user</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.Constructor</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.InvocationTargetException</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.Method</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">User</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"nc\">Exception</span> <span class=\"o\">{</span>        <span class=\"nc\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">exportedClass</span> <span class=\"o\">=</span> <span class=\"nc\">Class</span><span class=\"o\">.</span><span class=\"na\">forName</span><span class=\"o\">(</span><span class=\"s\">\"com.exported.Exported\"</span><span class=\"o\">);</span>        <span class=\"nc\">Constructor</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">con</span> <span class=\"o\">=</span> <span class=\"n\">exportedClass</span><span class=\"o\">.</span><span class=\"na\">getDeclaredConstructor</span><span class=\"o\">();</span>        <span class=\"n\">con</span><span class=\"o\">.</span><span class=\"na\">setAccessible</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>        <span class=\"nc\">Object</span> <span class=\"n\">exportedObj</span> <span class=\"o\">=</span> <span class=\"n\">con</span><span class=\"o\">.</span><span class=\"na\">newInstance</span><span class=\"o\">();</span>        <span class=\"nc\">Method</span> <span class=\"n\">m</span><span class=\"o\">;</span>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">exportedObj</span><span class=\"o\">.</span><span class=\"na\">getClass</span><span class=\"o\">().</span><span class=\"na\">getMethod</span><span class=\"o\">(</span><span class=\"s\">\"callMe\"</span><span class=\"o\">);</span>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">setAccessible</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Public : \"</span> <span class=\"o\">+</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">invoke</span><span class=\"o\">(</span><span class=\"n\">exportedObj</span><span class=\"o\">));</span>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">exportedObj</span><span class=\"o\">.</span><span class=\"na\">getClass</span><span class=\"o\">().</span><span class=\"na\">getDeclaredMethod</span><span class=\"o\">(</span><span class=\"s\">\"callMePrivate\"</span><span class=\"o\">);</span>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">setAccessible</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Private : \"</span> <span class=\"o\">+</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">invoke</span><span class=\"o\">(</span><span class=\"n\">exportedObj</span><span class=\"o\">));</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>Compile and run it and we will get following output</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>javac <span class=\"nt\">-d</span> mods <span class=\"nt\">--module-path</span> ./jars/ <span class=\"nt\">--module-source-path</span> src <span class=\"si\">$(</span>find src <span class=\"nt\">-name</span> <span class=\"s2\">\"*.java\"</span><span class=\"si\">)</span>java <span class=\"nt\">--module-path</span> ./jars/:mods <span class=\"nt\">-m</span> com.user/com.user.User<span class=\"nt\">---</span> OUTPUT <span class=\"nt\">---</span>Public : callMeException <span class=\"k\">in </span>thread <span class=\"s2\">\"main\"</span> java.lang.reflect.InaccessibleObjectException: Unable to make private java.lang.String com.exported.Exported.callMePrivate<span class=\"o\">()</span> accessible: module com.exported does not <span class=\"s2\">\"opens com.exported\"</span> to module com.user        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible<span class=\"o\">(</span>AccessibleObject.java:337<span class=\"o\">)</span>        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible<span class=\"o\">(</span>AccessibleObject.java:281<span class=\"o\">)</span>        at java.base/java.lang.reflect.Method.checkCanSetAccessible<span class=\"o\">(</span>Method.java:198<span class=\"o\">)</span>        at java.base/java.lang.reflect.Method.setAccessible<span class=\"o\">(</span>Method.java:192<span class=\"o\">)</span>        at com.user/com.user.User.main<span class=\"o\">(</span>User.java:22<span class=\"o\">)</span></code></pre></div></div><p>Notice we were able to access the <code class=\"language-plaintext highlighter-rouge\">public</code> method with help of reflection but not <code class=\"language-plaintext highlighter-rouge\">private</code> method. And the errorclearly states that we are not adding statement <code class=\"language-plaintext highlighter-rouge\">opens com.exported</code>. So let’s do thaton <code class=\"language-plaintext highlighter-rouge\">com.exported/module-info.java</code>.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span> <span class=\"o\">{</span>    <span class=\"n\">exports</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span><span class=\"o\">;</span>    <span class=\"n\">opens</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><p>Now if we compile and run the code we will get the following result</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>javac <span class=\"nt\">-d</span> mods <span class=\"nt\">--module-path</span> ./jars/ <span class=\"nt\">--module-source-path</span> src <span class=\"si\">$(</span>find src <span class=\"nt\">-name</span> <span class=\"s2\">\"*.java\"</span><span class=\"si\">)</span>java <span class=\"nt\">--module-path</span> ./jars/:mods <span class=\"nt\">-m</span> com.user/com.user.User<span class=\"nt\">---</span> OUTPUT <span class=\"nt\">---</span>Public : callMePrivate : callMePrivate</code></pre></div></div><p>We can take this even further. Because we are using reflection to access the <code class=\"language-plaintext highlighter-rouge\">public</code> method as well we canremote <code class=\"language-plaintext highlighter-rouge\">exports com.exported</code> statement from <code class=\"language-plaintext highlighter-rouge\">com.exported/module-info.java</code>.</p><p>We used <code class=\"language-plaintext highlighter-rouge\">opens</code> keyword and there more to it, but before going further on <code class=\"language-plaintext highlighter-rouge\">opens</code> I want to talk about <code class=\"language-plaintext highlighter-rouge\">open</code> keyword.So we use <code class=\"language-plaintext highlighter-rouge\">open</code> keyword when we want to make all of the packages on the module to be accessed by reflection API.Because this is for all of the packages we use <code class=\"language-plaintext highlighter-rouge\">open</code> on <code class=\"language-plaintext highlighter-rouge\">module</code> decleration level.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">open</span> <span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span> <span class=\"o\">{</span><span class=\"o\">}</span></code></pre></div></div><p>If you compile and run the command now it will run fine. But for the moment let’s step back and foucus more on <code class=\"language-plaintext highlighter-rouge\">opens</code>keyword. You know now that <code class=\"language-plaintext highlighter-rouge\">opens</code> is used if we want selected package to be accessed by reflection API. But what if youwant to give <code class=\"language-plaintext highlighter-rouge\">open</code> access to only certain packages. Like <code class=\"language-plaintext highlighter-rouge\">exports .. to</code>, we have <code class=\"language-plaintext highlighter-rouge\">opens .. to</code> which enables use togive a fine grain access control mechanism even for reflection API.</p><p>Let’s see this in action shall we.</p><p>For this we will update our <code class=\"language-plaintext highlighter-rouge\">com.exported/module-info.java</code> so that it <code class=\"language-plaintext highlighter-rouge\">opens</code> its packages only to <code class=\"language-plaintext highlighter-rouge\">com.user</code> module.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span> <span class=\"o\">{</span>    <span class=\"n\">opens</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span> <span class=\"n\">to</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">user</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><p>If you run the program now of course it runs right. By the if you are thinking why I removed <code class=\"language-plaintext highlighter-rouge\">open</code> keyword we can’tcombine those.</p><p>So <code class=\"language-plaintext highlighter-rouge\">com.user</code> module code remains same.</p><p>On our third module <code class=\"language-plaintext highlighter-rouge\">com.usertwo</code> let’s add some code (Basically same as <code class=\"language-plaintext highlighter-rouge\">com.user</code>)</p><p>Here’s <code class=\"language-plaintext highlighter-rouge\">com.usertwo/module-info.java</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">usertwo</span> <span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">exported</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.usertwo</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.Constructor</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.InvocationTargetException</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.lang.reflect.Method</span><span class=\"o\">;</span><span class=\"c1\">// This class cannot use reflection API for com.exporter.Exported</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">UserTwo</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"nc\">Exception</span> <span class=\"o\">{</span>        <span class=\"nc\">Class</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">exportedClass</span> <span class=\"o\">=</span> <span class=\"nc\">Class</span><span class=\"o\">.</span><span class=\"na\">forName</span><span class=\"o\">(</span><span class=\"s\">\"com.exported.Exported\"</span><span class=\"o\">);</span>        <span class=\"nc\">Constructor</span><span class=\"o\">&lt;?&gt;</span> <span class=\"n\">con</span> <span class=\"o\">=</span> <span class=\"n\">exportedClass</span><span class=\"o\">.</span><span class=\"na\">getDeclaredConstructor</span><span class=\"o\">();</span>        <span class=\"n\">con</span><span class=\"o\">.</span><span class=\"na\">setAccessible</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>        <span class=\"nc\">Object</span> <span class=\"n\">exportedObj</span> <span class=\"o\">=</span> <span class=\"n\">con</span><span class=\"o\">.</span><span class=\"na\">newInstance</span><span class=\"o\">();</span>        <span class=\"nc\">Method</span> <span class=\"n\">m</span><span class=\"o\">;</span>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">exportedObj</span><span class=\"o\">.</span><span class=\"na\">getClass</span><span class=\"o\">().</span><span class=\"na\">getMethod</span><span class=\"o\">(</span><span class=\"s\">\"callMe\"</span><span class=\"o\">);</span>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">setAccessible</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Public : \"</span> <span class=\"o\">+</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">invoke</span><span class=\"o\">(</span><span class=\"n\">exportedObj</span><span class=\"o\">));</span>        <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">exportedObj</span><span class=\"o\">.</span><span class=\"na\">getClass</span><span class=\"o\">().</span><span class=\"na\">getDeclaredMethod</span><span class=\"o\">(</span><span class=\"s\">\"callMePrivate\"</span><span class=\"o\">);</span>        <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">setAccessible</span><span class=\"o\">(</span><span class=\"kc\">true</span><span class=\"o\">);</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Private : \"</span> <span class=\"o\">+</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"na\">invoke</span><span class=\"o\">(</span><span class=\"n\">exportedObj</span><span class=\"o\">));</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>If we run <code class=\"language-plaintext highlighter-rouge\">com.user/com/user/User.java</code> as main class we will run our program successfully. But let’s try to run ourprogram with main class <code class=\"language-plaintext highlighter-rouge\">com.usertwo/com/usertwo/UserTwo.java</code>.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>javac <span class=\"nt\">-d</span> mods <span class=\"nt\">--module-path</span> ./jars/ <span class=\"nt\">--module-source-path</span> src <span class=\"si\">$(</span>find src <span class=\"nt\">-name</span> <span class=\"s2\">\"*.java\"</span><span class=\"si\">)</span>java <span class=\"nt\">--module-path</span> ./jars/:mods <span class=\"nt\">-m</span> com.usertwo/com.usertwo.UserTwo<span class=\"nt\">---</span> OUTPUT <span class=\"nt\">---</span>Exception <span class=\"k\">in </span>thread <span class=\"s2\">\"main\"</span> java.lang.reflect.InaccessibleObjectException: Unable to make public com.exported.Exported<span class=\"o\">()</span> accessible: module com.exported does not <span class=\"s2\">\"exports com.exported\"</span> to module com.usertwo        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible<span class=\"o\">(</span>AccessibleObject.java:337<span class=\"o\">)</span>        at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible<span class=\"o\">(</span>AccessibleObject.java:281<span class=\"o\">)</span>        at java.base/java.lang.reflect.Constructor.checkCanSetAccessible<span class=\"o\">(</span>Constructor.java:192<span class=\"o\">)</span>        at java.base/java.lang.reflect.Constructor.setAccessible<span class=\"o\">(</span>Constructor.java:185<span class=\"o\">)</span>        at com.usertwo/com.usertwo.UserTwo.main<span class=\"o\">(</span>UserTwo.java:12<span class=\"o\">)</span></code></pre></div></div><p>We will get this kind of error, it’s because we have delecated <code class=\"language-plaintext highlighter-rouge\">opens</code> to <code class=\"language-plaintext highlighter-rouge\">com.user</code> only. And for other package this isstill not accesssable.</p><p>By the way, did you notice we were using <code class=\"language-plaintext highlighter-rouge\">requires com.exported;</code> on both module. Even thought we are using reflectionAPI to access the code. We need to declare that we are using code from that module or else we will get a error.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>avac <span class=\"nt\">-d</span> mods <span class=\"nt\">--module-path</span> ./jars/ <span class=\"nt\">--module-source-path</span> src <span class=\"si\">$(</span>find src <span class=\"nt\">-name</span> <span class=\"s2\">\"*.java\"</span><span class=\"si\">)</span>java <span class=\"nt\">--module-path</span> ./jars/:mods <span class=\"nt\">-m</span> com.user/com.user.User<span class=\"nt\">---</span> OUTPUT <span class=\"nt\">---</span>Exception <span class=\"k\">in </span>thread <span class=\"s2\">\"main\"</span> java.lang.ClassNotFoundException: com.exported.Exported        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass<span class=\"o\">(</span>BuiltinClassLoader.java:582<span class=\"o\">)</span>        at java.base/jdk.internal.loader.ClassLoaders<span class=\"nv\">$AppClassLoader</span>.loadClass<span class=\"o\">(</span>ClassLoaders.java:185<span class=\"o\">)</span>        at java.base/java.lang.ClassLoader.loadClass<span class=\"o\">(</span>ClassLoader.java:496<span class=\"o\">)</span>        at java.base/java.lang.Class.forName0<span class=\"o\">(</span>Native Method<span class=\"o\">)</span>        at java.base/java.lang.Class.forName<span class=\"o\">(</span>Class.java:292<span class=\"o\">)</span>        at com.user/com.user.User.main<span class=\"o\">(</span>User.java:10<span class=\"o\">)</span></code></pre></div></div><p>So this is it for <code class=\"language-plaintext highlighter-rouge\">open</code> and <code class=\"language-plaintext highlighter-rouge\">opens</code> keyword. You can findthe <a href=\"https://github.com/amantuladhar/java9-basics/tree/master/06-reflection-java-open-keyword\">Github code here</a></p>",
            "url": "https://babal.dev/2017/10/16/java-9-open-and-opens-keyword-with-example",
            
            
            
            
            
            "date_published": "2017-10-16T00:00:00-04:00",
            "date_modified": "2017-10-16T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2017/10/09/java-9-automatic-module-with-example",
            "title": "Java 9 automatic module with example",
            "summary": "Java 9 automatic module with example",
            "content_text": "In previous posts we were exploring how new module system works.Java 9 Module System IntroJava 9 using exports and requiresExport to specific modules onlyTransitive Dependency in Java 9But in the real world we will use different jars which may or may not be modularized. In this post we will talk about what happens if you want to use jars that are not modularized yet.For this example we will be working with following directory structure├── jars│   └── guava-23.0.jar├── run.sh└── src    └── com.moduleone        ├── com        │   └── moduleone        │       └── ModuleOne.java        └── module-info.javaGitHub code hereLet’s write some code on ModuleOne that uses google-guava library.package com.moduleone;import java.util.List;import com.google.common.collect.FluentIterable;class ModuleOne {    public static void main(String[] args) {        FluentIterable.from(List.of(1, 2, 3, 4, 5, 6, 7))            .filter(input -&gt; input % 2 == 0)            .stream()            .forEach(System.out::println);    }}We could have done above code using Java Stream API but for this example we are using google-guava library.Fill in module-info.javamodule com.moduleone{}Because we are using external jar we need to make sure we load it. We can load it alongside our app using --module-pathjavac -d mods --module-path ./jars/ --module-source-path src $(find src -name \"*.java\")Notice on --module-path we are using ./jars/, that is where we are storing our external jars.If we run the command above now, we will get the following errorsrc/com.moduleone/com/moduleone/ModuleOne.java:4: error: package com.google.common.collect is not visibleimport com.google.common.collect.FluentIterable;                        ^  (package com.google.common.collect is declared in module guava, but module com.moduleone does not read it)1 errorError clearly says that the code we are trying to use is not specified as requires dependency. If you read my previous posts, you should know that we need to use requries here. But what module do we require. All we did we added a jar on the module path.So if we add a external jars that are not modularized to --module-path we will be using Java 9 automatic modules feature. Basically what that means is, that list of exported packages is simply set to be all packages in the jar file.So does that mean we add requires external.library.package? In this case NO. This is kind of odd but when we add external jar that is not modularied, and if we want to use that library we add requires filename without version numbers.In this scenario our file name is guava-23.0.jar so we add requires guava; to our module-info.javamodule com.moduleone{    requires guava;}So we know from above that external jar version numbers are trimmed off. But what if our jar name was like guava-all.23.0.jar. We we try to add requires guava-all Java compiler will yell at us. So, what Java does is it trims out the version number and if those jars have any dashes (-) it will be converted to dot (.) . So in our scenerio if our jar file was named guava-all.23.0.jar we add requires guava.all; in our module-info.java.So to run we need to add jar to --module-path like we did when we compiled our code.java --module-path ./jars/:mods -m com.moduleone/com.moduleone.ModuleOneIf we forget to add our external jar on --module-path when we run our program we will get errorError occurred during initialization of boot layerjava.lang.module.FindException: Module guava not found, required by com.moduleoneWell, this is it for Java 9 automatic module. Cheers!!",
            "content_html": "<p>In previous posts we were exploring how new module system works.</p><p><a href=\"/2017/10/03/java-9-module-intro\">Java 9 Module System Intro</a></p><p><a href=\"/2017/10/04/java-9-exports-and-requires\">Java 9 using exports and requires</a></p><p><a href=\"/2017/10/05/java-export-module-to-specific-module-only\">Export to specific modules only</a></p><p><a href=\"/2017/10/05/java-using-transitive-dependency\">Transitive Dependency in Java 9</a></p><p>But in the real world we will use different <strong>jars</strong> which may or may not be modularized. In this post we will talk about what happens if you want to use <strong>jars</strong> that are not modularized yet.</p><p>For this example we will be working with following directory structure</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>├── jars│   └── guava-23.0.jar├── run.sh└── src    └── com.moduleone        ├── com        │   └── moduleone        │       └── ModuleOne.java        └── module-info.java</code></pre></div></div><p><a href=\"https://github.com/amantuladhar/java9-basics/tree/master/05-java-9-automatic-modules-example\">GitHub code here</a></p><p>Let’s write some code on ModuleOne that uses <strong>google-guava</strong> library.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.moduleone</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">java.util.List</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">com.google.common.collect.FluentIterable</span><span class=\"o\">;</span><span class=\"kd\">class</span> <span class=\"nc\">ModuleOne</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"o\">{</span>        <span class=\"nc\">FluentIterable</span><span class=\"o\">.</span><span class=\"na\">from</span><span class=\"o\">(</span><span class=\"nc\">List</span><span class=\"o\">.</span><span class=\"na\">of</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">2</span><span class=\"o\">,</span> <span class=\"mi\">3</span><span class=\"o\">,</span> <span class=\"mi\">4</span><span class=\"o\">,</span> <span class=\"mi\">5</span><span class=\"o\">,</span> <span class=\"mi\">6</span><span class=\"o\">,</span> <span class=\"mi\">7</span><span class=\"o\">))</span>            <span class=\"o\">.</span><span class=\"na\">filter</span><span class=\"o\">(</span><span class=\"n\">input</span> <span class=\"o\">-&gt;</span> <span class=\"n\">input</span> <span class=\"o\">%</span> <span class=\"mi\">2</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"o\">)</span>            <span class=\"o\">.</span><span class=\"na\">stream</span><span class=\"o\">()</span>            <span class=\"o\">.</span><span class=\"na\">forEach</span><span class=\"o\">(</span><span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">::</span><span class=\"n\">println</span><span class=\"o\">);</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>We could have done above code using Java Stream API but for this example we are using <strong>google-guava</strong> library.</p><p>Fill in <code class=\"language-plaintext highlighter-rouge\">module-info.java</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">{</span><span class=\"o\">}</span></code></pre></div></div><p>Because we are using external jar we need to make sure we load it. We can load it alongside our app using <code class=\"language-plaintext highlighter-rouge\">--module-path</code></p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>javac <span class=\"nt\">-d</span> mods <span class=\"nt\">--module-path</span> ./jars/ <span class=\"nt\">--module-source-path</span> src <span class=\"si\">$(</span>find src <span class=\"nt\">-name</span> <span class=\"s2\">\"*.java\"</span><span class=\"si\">)</span></code></pre></div></div><p>Notice on <code class=\"language-plaintext highlighter-rouge\">--module-path</code> we are using <code class=\"language-plaintext highlighter-rouge\">./jars/</code>, that is where we are storing our external jars.</p><p>If we run the command above now, we will get the following error</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>src/com.moduleone/com/moduleone/ModuleOne.java:4: error: package com.google.common.collect is not visibleimport com.google.common.collect.FluentIterable<span class=\"p\">;</span>                        ^  <span class=\"o\">(</span>package com.google.common.collect is declared <span class=\"k\">in </span>module guava, but module com.moduleone does not <span class=\"nb\">read </span>it<span class=\"o\">)</span>1 error</code></pre></div></div><p>Error clearly says that the code we are trying to use is not specified as <code class=\"language-plaintext highlighter-rouge\">requires</code> dependency. If you read my previous posts, you should know that we need to use <code class=\"language-plaintext highlighter-rouge\">requries</code> here. But what module do we <strong>require</strong>. All we did we added a <strong>jar</strong> on the <strong>module path</strong>.</p><p>So if we add a external jars that are not modularized to <code class=\"language-plaintext highlighter-rouge\">--module-path</code> we will be using Java 9 <strong><code class=\"language-plaintext highlighter-rouge\">automatic modules</code></strong> feature. Basically what that means is, that list of exported packages is simply set to be all packages in the jar file.</p><p>So does that mean we add <code class=\"language-plaintext highlighter-rouge\">requires external.library.package</code>? In this case <strong>NO</strong>. This is kind of odd but when we add external jar that is not modularied, and if we want to use that library we add <code class=\"language-plaintext highlighter-rouge\">requires filename</code> without version numbers.</p><p>In this scenario our file name is <code class=\"language-plaintext highlighter-rouge\">guava-23.0.jar</code> so we add <code class=\"language-plaintext highlighter-rouge\">requires guava;</code> to our <code class=\"language-plaintext highlighter-rouge\">module-info.java</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">guava</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><p>So we know from above that external jar version numbers are trimmed off. But what if our jar name was like <code class=\"language-plaintext highlighter-rouge\">guava-all.23.0.jar</code>. We we try to add <code class=\"language-plaintext highlighter-rouge\">requires guava-all</code> Java compiler will yell at us. So, what Java does is it trims out the version number and if those jars have any dashes (-) it will be converted to dot (.) . So in our scenerio if our jar file was named <code class=\"language-plaintext highlighter-rouge\">guava-all.23.0.jar</code> we add <code class=\"language-plaintext highlighter-rouge\">requires guava.all;</code> in our <code class=\"language-plaintext highlighter-rouge\">module-info.java</code>.</p><p>So to run we need to add jar to <code class=\"language-plaintext highlighter-rouge\">--module-path</code> like we did when we compiled our code.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>java <span class=\"nt\">--module-path</span> ./jars/:mods <span class=\"nt\">-m</span> com.moduleone/com.moduleone.ModuleOne</code></pre></div></div><p>If we forget to add our external jar on <code class=\"language-plaintext highlighter-rouge\">--module-path</code> when we run our program we will get error</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Error occurred during initialization of boot layerjava.lang.module.FindException: Module guava not found, required by com.moduleone</code></pre></div></div><p>Well, this is it for Java 9 automatic module. Cheers!!</p>",
            "url": "https://babal.dev/2017/10/09/java-9-automatic-module-with-example",
            
            
            
            
            
            "date_published": "2017-10-09T00:00:00-04:00",
            "date_modified": "2017-10-09T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2017/10/05/java-using-transitive-dependency",
            "title": "Java 9 Transitive Dependency",
            "summary": "Java 9 Transitive Dependency",
            "content_text": "Let’s see how Java handles transitive dependencies. We will be creating three modules  com.moduleone  com.moduletwo  com.modulethreeWith these module we will see how transitive keyword works.Here’s a directory structure we will be creating└── src    ├── com.moduleone    │   ├── com    │   │   └── moduleone    │   │       └── ModuleOne.java    │   └── module-info.java    ├── com.modulethree    │   ├── com    │   │   └── modulethree    │   │       └── ModuleThree.java    │   └── module-info.java    └── com.moduletwo        ├── com        │   └── moduletwo        │       └── ModuleTwo.java        └── module-info.javaLet’s start with creating com.moduleonemodule com.moduleone{    exports com.moduleone;}package com.moduleone;public class ModuleOne{    public static void callMe(){        System.out.println(\"This is module one code\");    }}This was straight foward right!!Now let’s create com.moduletwomodule com.moduletwo{    requires com.moduleone;    exports com.moduletwo;}package com.moduletwo;public class ModuleTwo{}In com.moduletwo we declared that we required com.moduleone but we are not using it. But for this sake of this example let’s assume com.moduletwo is using com.moduleone code.Now to the fun part!!Create a third module com.modulethreemodule com.modulethree {    requires com.moduletwo;}package com.modulethree;import com.moduleone.ModuleOne;public class ModuleThree {    public static void main(String[] args){        ModuleOne.callMe();    }}If we run it now, we will get the problem because we have not declared that com.modulethree requires com.moduleone.We can fix that by adding add requires statement on src/com.modulethree/module-info.javamodule com.modulethree {    requires com.moduletwo;    requires com.moduleone;}But this is not the solution we will be using because we want know how transitive dependencies work on Java 9. So, we will remove that requires statement we added and on com.moduletwo module-info.java file we add transitive keyword after requires like// src/com.moduletwo/module-info.javamodule com.moduletwo{    requires transitive com.moduleone;    exports com.moduletwo;}Now if you compile our code compile and runs successfully. Notice we are still not declaring that com.modulethree requires com.moduleone but because of transitive dependency we are able to use it. Keyword transitive must come after keyword requires.If module B has requires transitive dependency on module A and module C simpley requires module B, then module C will have implicit dependence on module A.GitHub Code",
            "content_html": "<p>Let’s see how Java handles transitive dependencies. We will be creating three modules</p><ol>  <li><code class=\"language-plaintext highlighter-rouge\">com.moduleone</code></li>  <li><code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code></li>  <li><code class=\"language-plaintext highlighter-rouge\">com.modulethree</code></li></ol><p>With these module we will see how <code class=\"language-plaintext highlighter-rouge\">transitive</code> keyword works.</p><p>Here’s a directory structure we will be creating</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>└── src    ├── com.moduleone    │   ├── com    │   │   └── moduleone    │   │       └── ModuleOne.java    │   └── module-info.java    ├── com.modulethree    │   ├── com    │   │   └── modulethree    │   │       └── ModuleThree.java    │   └── module-info.java    └── com.moduletwo        ├── com        │   └── moduletwo        │       └── ModuleTwo.java        └── module-info.java</code></pre></div></div><p>Let’s start with creating <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">{</span>    <span class=\"n\">exports</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.moduleone</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleOne</span><span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">callMe</span><span class=\"o\">(){</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"This is module one code\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>This was straight foward right!!</p><p>Now let’s create <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span><span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">;</span>    <span class=\"n\">exports</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.moduletwo</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleTwo</span><span class=\"o\">{}</span></code></pre></div></div><p>In <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code> we declared that we required <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> but we are not using it. But for this sake of this example let’s assume <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code> is using <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> code.</p><p>Now to the fun part!!Create a third module <code class=\"language-plaintext highlighter-rouge\">com.modulethree</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">modulethree</span> <span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.modulethree</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">com.moduleone.ModuleOne</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleThree</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">){</span>        <span class=\"nc\">ModuleOne</span><span class=\"o\">.</span><span class=\"na\">callMe</span><span class=\"o\">();</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>If we run it now, we will get the problem because we have not declared that <code class=\"language-plaintext highlighter-rouge\">com.modulethree</code> <strong>requires</strong> <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code>.</p><p>We can fix that by adding add <code class=\"language-plaintext highlighter-rouge\">requires</code> statement on <code class=\"language-plaintext highlighter-rouge\">src/com.modulethree/module-info.java</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">modulethree</span> <span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span><span class=\"o\">;</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><p>But this is not the solution we will be using because we want know how transitive dependencies work on Java 9. So, we will remove that <code class=\"language-plaintext highlighter-rouge\">requires</code> statement we added and on <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code> <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> file we add <code class=\"language-plaintext highlighter-rouge\">transitive</code> keyword after <code class=\"language-plaintext highlighter-rouge\">requires</code> like</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// src/com.moduletwo/module-info.java</span><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span><span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">transitive</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">;</span>    <span class=\"n\">exports</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><p>Now if you compile our code compile and runs successfully. Notice we are still not declaring that <code class=\"language-plaintext highlighter-rouge\">com.modulethree</code> requires <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> but because of transitive dependency we are able to use it. Keyword <code class=\"language-plaintext highlighter-rouge\">transitive</code> must come after keyword <code class=\"language-plaintext highlighter-rouge\">requires</code>.</p><p>If <strong>module B</strong> has <code class=\"language-plaintext highlighter-rouge\">requires transitive</code> dependency on <strong>module A</strong> and <strong>module C</strong> simpley <code class=\"language-plaintext highlighter-rouge\">requires</code> <strong>module B</strong>, then <strong>module C</strong> will have <em>implicit dependence</em> on <strong>module A</strong>.</p><p><a href=\"https://github.com/amantuladhar/java9-basics/tree/master/04-java-transitive-dependency\">GitHub Code</a></p>",
            "url": "https://babal.dev/2017/10/05/java-using-transitive-dependency",
            
            
            
            
            
            "date_published": "2017-10-05T00:00:00-04:00",
            "date_modified": "2017-10-05T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2017/10/05/java-export-module-to-specific-module-only",
            "title": "Java 9 Using exports with to",
            "summary": "Java 9 using exports with to",
            "content_text": "In this example we will create three module  com.moduleone  com.moduletwo  com.modulethreeWe will create an example such that com.moduletwo and com.modulethree is dependent on com.moduleone but com.moduleone will only export its code to com.moduletwo. We will see error that pops up when we try to use the module where it is not exported.Here’s the directory structure├── run.sh└── src    ├── com.moduleone    │   ├── com    │   │   └── moduleone    │   │       └── ModuleOne.java    │   └── module-info.java    ├── com.modulethree    │   ├── com    │   │   └── modulethree    │   │       └── ModuleThree.java    │   └── module-info.java    └── com.moduletwo        ├── com        │   └── moduletwo        │       └── ModuleTwo.java        └── module-info.javaI will be modifying the example from previous post so, if you haven’t read it here’s a link to them  Part 1: Java Module Basics/Intro  Part 2: Java exports and requires keywordFrom previous example I just modified the com.moduleone module-info.java file to use to keyword.module com.moduleone {    exports com.moduleone to com.modulethree;}package com.moduleone;public class ModuleOne {    public static void callMe(){        System.out.println(\"Hello from module one\");    }}The difference here is com.moduleone is only exporting it’s code to com.modulethree. Others cannot access it.If we don’t change the com.moduletwo code i.emodule com.moduletwo {    requires com.moduleone;}package com.moduletwo;import com.moduleone.ModuleOne;public class ModuleTwo {    public static void main(String[] args){        ModuleOne.callMe();    }}If we compile and run: ./run.sh com.moduletwo ModuleTwo our example we get error like belowsrc/com.moduletwo/com/moduletwo/ModuleTwo.java:3: error: package com.moduleone is not visibleimport com.moduleone.ModuleOne;          ^  (package com.moduleone is declared in module com.moduleone, which does not export it to module com.moduletwo)1 errorYou can see that we get error saying com.moduleone doesn’t export its code to com.moduletwo.So let’s comment out the code on com.moduletwo to remove the reference that we are using com.moduleone.module com.moduletwo {    // requires com.moduleone;}package com.moduletwo;// import com.moduleone.ModuleOne;public class ModuleTwo {    public static void main(String[] args){        // ModuleOne.callMe();    }}Let’s create a third module com.modulethree which is the module com.moduleone exports its code to.module com.modulethree {    requires com.moduleone;}package com.modulethree;import com.moduleone.ModuleOne;public class ModuleThree {    public static void main(String[] args){        ModuleOne.callMe();    }}Compile and run the code: ./run.sh com.modulethree ModuleThree and your code will compile successfully and show the result as well.  NOTE: You can also export your modules to multiple modules by using comma (,) to separate them.ConclusionYou can see the power of using exports with to here. If you want your code to be visible to only certain modules you can do that easily.GitHub Code",
            "content_html": "<p>In this example we will create three module</p><ol>  <li><code class=\"language-plaintext highlighter-rouge\">com.moduleone</code></li>  <li><code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code></li>  <li><code class=\"language-plaintext highlighter-rouge\">com.modulethree</code></li></ol><p>We will create an example such that <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code> and <code class=\"language-plaintext highlighter-rouge\">com.modulethree</code> is dependent on <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> but <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> will only export its code to <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code>. We will see error that pops up when we try to use the module where it is not exported.</p><p>Here’s the directory structure</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>├── run.sh└── src    ├── com.moduleone    │   ├── com    │   │   └── moduleone    │   │       └── ModuleOne.java    │   └── module-info.java    ├── com.modulethree    │   ├── com    │   │   └── modulethree    │   │       └── ModuleThree.java    │   └── module-info.java    └── com.moduletwo        ├── com        │   └── moduletwo        │       └── ModuleTwo.java        └── module-info.java</code></pre></div></div><p>I will be modifying the example from previous post so, if you haven’t read it here’s a link to them</p><ol>  <li><a href=\"http://amantuladhar.github.io/java/2017/10/03/java-9-module-intro.html\">Part 1: Java Module Basics/Intro</a></li>  <li><a href=\"http://amantuladhar.github.io/java/2017/10/04/java-9-exports-and-requires.html\">Part 2: Java exports and requires keyword</a></li></ol><p>From previous example I just modified the <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> file to use <code class=\"language-plaintext highlighter-rouge\">to</code> keyword.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span> <span class=\"o\">{</span>    <span class=\"n\">exports</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span> <span class=\"n\">to</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">modulethree</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.moduleone</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleOne</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">callMe</span><span class=\"o\">(){</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Hello from module one\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>The difference here is <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> is only exporting it’s code to <code class=\"language-plaintext highlighter-rouge\">com.modulethree</code>. Others cannot access it.</p><p>If we don’t change the <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code> code i.e</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span> <span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.moduletwo</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">com.moduleone.ModuleOne</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleTwo</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">){</span>        <span class=\"nc\">ModuleOne</span><span class=\"o\">.</span><span class=\"na\">callMe</span><span class=\"o\">();</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>If we compile and run: <code class=\"language-plaintext highlighter-rouge\">./run.sh com.moduletwo ModuleTwo</code> our example we get error like below</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>src/com.moduletwo/com/moduletwo/ModuleTwo.java:3: error: package com.moduleone is not visibleimport com.moduleone.ModuleOne<span class=\"p\">;</span>          ^  <span class=\"o\">(</span>package com.moduleone is declared <span class=\"k\">in </span>module com.moduleone, which does not <span class=\"nb\">export </span>it to module com.moduletwo<span class=\"o\">)</span>1 error</code></pre></div></div><p>You can see that we get error saying <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> doesn’t export its code to <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code>.</p><p>So let’s comment out the code on <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code> to remove the reference that we are using <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code>.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span> <span class=\"o\">{</span>    <span class=\"c1\">// requires com.moduleone;</span><span class=\"o\">}</span></code></pre></div></div><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.moduletwo</span><span class=\"o\">;</span><span class=\"c1\">// import com.moduleone.ModuleOne;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleTwo</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">){</span>        <span class=\"c1\">// ModuleOne.callMe();</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>Let’s create a third module <code class=\"language-plaintext highlighter-rouge\">com.modulethree</code> which is the module <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> exports its code to.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">modulethree</span> <span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.modulethree</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">com.moduleone.ModuleOne</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleThree</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">){</span>        <span class=\"nc\">ModuleOne</span><span class=\"o\">.</span><span class=\"na\">callMe</span><span class=\"o\">();</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>Compile and run the code: <code class=\"language-plaintext highlighter-rouge\">./run.sh com.modulethree ModuleThree</code> and your code will compile successfully and show the result as well.</p><blockquote>  <p>NOTE: You can also export your modules to multiple modules by using comma (,) to separate them.</p></blockquote><h2 id=\"conclusion\"><strong>Conclusion</strong></h2><p>You can see the power of using <code class=\"language-plaintext highlighter-rouge\">exports</code> with <code class=\"language-plaintext highlighter-rouge\">to</code> here. If you want your code to be visible to only certain modules you can do that easily.</p><p><a href=\"https://github.com/amantuladhar/java9-basics/tree/master/03-export-to-specific-module-only\">GitHub Code</a></p>",
            "url": "https://babal.dev/2017/10/05/java-export-module-to-specific-module-only",
            
            
            
            
            
            "date_published": "2017-10-05T00:00:00-04:00",
            "date_modified": "2017-10-05T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2017/10/04/java-9-exports-and-requires",
            "title": "Java 9 exports and requires",
            "summary": "Using Java 9 exports and requires",
            "content_text": "When we are dealing with Java 9 modules we can create an application such that one modules depends on other. We use exports keyword to define what visible to outside world and requires keyword to define module dependency.For this example we will create two modules: com.moduleone and com.moduletwoScenariocom.moduleone will have some code that will be used my com.moduletwoCode for com.moduleoneFor now just create a simple method that will print some messagepackage com.moduleone;public class ModuleOne {    public static void callMe(){        System.out.println(\"Hello from module one\");    }}Code for com.moduletwoCreate a class that will uses code from com.moduleonepackage com.moduletwo;import com.moduleone.ModuleOne;public class ModuleTwo {    public static void main(String[] args){        ModuleOne.callMe();    }}Compile and run the codeCompile: javac -d mods --module-source-path src $(find src -name \"*.java\")Run: java --module-path mods -m com.moduleone/com.moduleone.ModuleOneORYou can use the script I created to compile and run the program.We run the code using ./run.sh com.moduletwo ModuleTwosrc/com.moduletwo/com/moduletwo/ModuleTwo.java:3: error: package com.moduleone is not visibleimport com.moduleone.ModuleOne;          ^  (package com.moduleone is declared in module com.moduleone, but module com.moduletwo does not read it)1 errorWe get this error because we have not specified that com.moduletwo depends on com.moduleone. To do this we will use requires keywordDeclare dependencies / requires module.nameSo we tell com.moduletwo require com.moduleone using requires statement. Simply add requires com.moduletwo; on module-info.java of com.moduletwo.module com.moduletwo {    requires com.moduleone;}Compile and run againBut this time you will get another errorsrc/com.moduletwo/com/moduletwo/ModuleTwo.java:3: error: package com.moduleone is not visibleimport com.moduleone.ModuleOne;          ^  (package com.moduleone is declared in module com.moduleone, which does not export it)1 errorIf you look closely it says, com.moduleone does not exports it. So let’s do that.Make code visible outside module / exports module.nameWe need to add exports statement on module declartion file.On com.moduleone module-info.java add exports com.moduleone; where com.modulenone is package you want to export.module com.moduleone {    exports com.moduleone;}Compile and run againNow you will get console output: ./run.sh com.moduletwo ModuleTwoOutputHello from module oneConclusionHope this simple application helped you understand how exports and requires keyword works.",
            "content_html": "<p>When we are dealing with Java 9 modules we can create an application such that one modules depends on other. We use <code class=\"language-plaintext highlighter-rouge\">exports</code> keyword to define what visible to outside world and <code class=\"language-plaintext highlighter-rouge\">requires</code> keyword to define module dependency.</p><p>For this example we will create two modules: <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> and <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code></p><h2 id=\"scenario\"><strong>Scenario</strong></h2><p><code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> will have some code that will be used my <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code></p><h2 id=\"code-for-commoduleone\"><strong>Code for <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code></strong></h2><p>For now just create a simple method that will print some message</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.moduleone</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleOne</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">callMe</span><span class=\"o\">(){</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Hello from module one\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><h2 id=\"code-for-commoduletwo\"><strong>Code for <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code></strong></h2><p>Create a class that will uses code from <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code></p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.moduletwo</span><span class=\"o\">;</span><span class=\"kn\">import</span> <span class=\"nn\">com.moduleone.ModuleOne</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">ModuleTwo</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">){</span>        <span class=\"nc\">ModuleOne</span><span class=\"o\">.</span><span class=\"na\">callMe</span><span class=\"o\">();</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><h2 id=\"compile-and-run-the-code\"><strong>Compile and run the code</strong></h2><p>Compile: <code class=\"language-plaintext highlighter-rouge\">javac -d mods --module-source-path src $(find src -name \"*.java\")</code></p><p>Run: <code class=\"language-plaintext highlighter-rouge\">java --module-path mods -m com.moduleone/com.moduleone.ModuleOne</code></p><p><strong>OR</strong></p><p>You can use the <a href=\"https://github.com/amantuladhar/java9-basics/blob/master/01-module-basics/run.sh\">script I created to compile and run the program.</a></p><p>We run the code using <code class=\"language-plaintext highlighter-rouge\">./run.sh com.moduletwo ModuleTwo</code></p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>src/com.moduletwo/com/moduletwo/ModuleTwo.java:3: error: package com.moduleone is not visibleimport com.moduleone.ModuleOne<span class=\"p\">;</span>          ^  <span class=\"o\">(</span>package com.moduleone is declared <span class=\"k\">in </span>module com.moduleone, but module com.moduletwo does not <span class=\"nb\">read </span>it<span class=\"o\">)</span>1 error</code></pre></div></div><p>We get this error because we have not specified that <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code> depends on <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code>. To do this we will use <code class=\"language-plaintext highlighter-rouge\">requires</code> keyword</p><h2 id=\"declare-dependencies--requires-modulename\"><strong>Declare dependencies / <code class=\"language-plaintext highlighter-rouge\">requires module.name</code></strong></h2><p>So we tell <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code> require <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> using <code class=\"language-plaintext highlighter-rouge\">requires</code> statement. Simply add <code class=\"language-plaintext highlighter-rouge\">requires com.moduletwo;</code> on <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> of <code class=\"language-plaintext highlighter-rouge\">com.moduletwo</code>.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduletwo</span> <span class=\"o\">{</span>    <span class=\"n\">requires</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><h2 id=\"compile-and-run-again\"><strong>Compile and run again</strong></h2><p>But this time you will get another error</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>src/com.moduletwo/com/moduletwo/ModuleTwo.java:3: error: package com.moduleone is not visibleimport com.moduleone.ModuleOne<span class=\"p\">;</span>          ^  <span class=\"o\">(</span>package com.moduleone is declared <span class=\"k\">in </span>module com.moduleone, which does not <span class=\"nb\">export </span>it<span class=\"o\">)</span>1 error</code></pre></div></div><p>If you look closely it says, <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> does not exports it. So let’s do that.</p><h2 id=\"make-code-visible-outside-module--exports-modulename\"><strong>Make code visible outside module / <code class=\"language-plaintext highlighter-rouge\">exports module.name</code></strong></h2><p>We need to add <code class=\"language-plaintext highlighter-rouge\">exports</code> statement on module declartion file.On <code class=\"language-plaintext highlighter-rouge\">com.moduleone</code> <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> add <code class=\"language-plaintext highlighter-rouge\">exports com.moduleone;</code> where <code class=\"language-plaintext highlighter-rouge\">com.modulenone</code> is package you want to export.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span> <span class=\"o\">{</span>    <span class=\"n\">exports</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">moduleone</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><h2 id=\"compile-and-run-again-1\"><strong>Compile and run again</strong></h2><p>Now you will get console output: <code class=\"language-plaintext highlighter-rouge\">./run.sh com.moduletwo ModuleTwo</code></p><h2 id=\"output\"><strong>Output</strong></h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Hello from module one</code></pre></div></div><h2 id=\"conclusion\"><strong>Conclusion</strong></h2><p>Hope this simple application helped you understand how <code class=\"language-plaintext highlighter-rouge\">exports</code> and <code class=\"language-plaintext highlighter-rouge\">requires</code> keyword works.</p>",
            "url": "https://babal.dev/2017/10/04/java-9-exports-and-requires",
            
            
            
            
            
            "date_published": "2017-10-04T00:00:00-04:00",
            "date_modified": "2017-10-04T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2017/10/03/java-9-module-intro",
            "title": "Introduction to Java 9 Module",
            "summary": "Hello World Java 9 Module",
            "content_text": "With Java 9 we can use module system called Jigsaw. Without talking about module a lot let’s dive into modular world of Java.Before creating any module we have to keep few things in mind  Module name and directory name must be same  Module name are kept same as package name (reverse domain name) but not mandatoryNow let’s create a moduleFor this example let’s create a module com.mymodule. To do so we need to create directory called com.mymodule. We will create all of our source files under src so our directory we create will be src/com.mymodule.Inside the directory create module-info.java file with contentmodule com.mymodule {    }We create module by using module keyword. But module is not a reserved keyword in Java 9. module keyword is only special on this module-info.java file.With this simple code we have created a module. But we still do not have any code to run so let’s write some.Write some code to runI will create a MyModule.java file that’s prints some string inside com.mymodule package.package com.mymodule;public class MyModule {    public static void main(String[] args){        System.out.println(\"Hello Module World\");    }}Here’s a directory structure└── src    └── com.mymodule        ├── com        │   └── mymodule        │       └── MyModule.java        └── module-info.javaCompile and run the programTo compile we can runjavac -d mods --module-source-path src $(find src -name \"*.java\")So above command compiles all the modules that are located on src directory and stores the bytecode at mods directory.To run it we dojava --module-path mods -m com.mymodule/com.mymodule.MyModuleOutputThat’s it and you will get the outputHello Module World  I wrote a bash script which can do compile and run the java module at one. You can find script hereWith this script you can do ./run.sh main.module.name MainClassToRun",
            "content_html": "<p>With Java 9 we can use module system called <code class=\"language-plaintext highlighter-rouge\">Jigsaw</code>. Without talking about module a lot let’s dive into modular world of Java.</p><p>Before creating any module we have to keep few things in mind</p><ol>  <li>Module name and directory name must be same</li>  <li>Module name are kept same as package name (reverse domain name) but not mandatory</li></ol><h2 id=\"now-lets-create-a-module\">Now let’s create a module</h2><p>For this example let’s create a module <code class=\"language-plaintext highlighter-rouge\">com.mymodule</code>. To do so we need to create directory called <strong>com.mymodule</strong>. We will create all of our source files under <code class=\"language-plaintext highlighter-rouge\">src</code> so our directory we create will be <code class=\"language-plaintext highlighter-rouge\">src/com.mymodule</code>.</p><p>Inside the directory create <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> file with content</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">module</span> <span class=\"n\">com</span><span class=\"o\">.</span><span class=\"na\">mymodule</span> <span class=\"o\">{</span>    <span class=\"o\">}</span></code></pre></div></div><p>We create module by using <code class=\"language-plaintext highlighter-rouge\">module</code> keyword. But module is not a reserved keyword in Java 9. <code class=\"language-plaintext highlighter-rouge\">module</code> keyword is only special on this <code class=\"language-plaintext highlighter-rouge\">module-info.java</code> file.With this simple code we have created a module. But we still do not have any code to run so let’s write some.</p><h2 id=\"write-some-code-to-run\">Write some code to run</h2><p>I will create a <code class=\"language-plaintext highlighter-rouge\">MyModule.java</code> file that’s prints some string inside <code class=\"language-plaintext highlighter-rouge\">com.mymodule</code> package.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">package</span> <span class=\"nn\">com.mymodule</span><span class=\"o\">;</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">MyModule</span> <span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">main</span><span class=\"o\">(</span><span class=\"nc\">String</span><span class=\"o\">[]</span> <span class=\"n\">args</span><span class=\"o\">){</span>        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Hello Module World\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>Here’s a directory structure</p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>└── src    └── com.mymodule        ├── com        │   └── mymodule        │       └── MyModule.java        └── module-info.java</code></pre></div></div><h2 id=\"compile-and-run-the-program\">Compile and run the program</h2><p>To compile we can run</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>javac <span class=\"nt\">-d</span> mods <span class=\"nt\">--module-source-path</span> src <span class=\"si\">$(</span>find src <span class=\"nt\">-name</span> <span class=\"s2\">\"*.java\"</span><span class=\"si\">)</span></code></pre></div></div><p>So above command compiles all the modules that are located on <code class=\"language-plaintext highlighter-rouge\">src</code> directory and stores the bytecode at <code class=\"language-plaintext highlighter-rouge\">mods</code> directory.</p><p>To run it we do</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>java <span class=\"nt\">--module-path</span> mods <span class=\"nt\">-m</span> com.mymodule/com.mymodule.MyModule</code></pre></div></div><h2 id=\"output\">Output</h2><p>That’s it and you will get the output</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Hello Module World</code></pre></div></div><blockquote>  <p>I wrote a bash script which can do compile and run the java module at one. You can find script <a href=\"https://github.com/atuladhar-aman/java9-basics/blob/master/01-module-basics/run.sh\">here</a></p></blockquote><p>With this script you can do <code class=\"language-plaintext highlighter-rouge\">./run.sh main.module.name MainClassToRun</code></p>",
            "url": "https://babal.dev/2017/10/03/java-9-module-intro",
            
            
            
            
            
            "date_published": "2017-10-03T00:00:00-04:00",
            "date_modified": "2017-10-03T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2017/07/11/angularjs-testing-in-nutshell",
            "title": "AngularJS Testing in Nutshell",
            "summary": "AngularJS testing as simple as possible",
            "content_text": "In this post I will talk about AngularJS testing. This will be quick and easy guide to get up and running with AngularJS testing.This post cover basics of :  Karma  Jasmine  Testing Controller  Testing Services (http request)  Testing DirectiveKarma  Is a command line tool that can be used to spawn a web server which loads your application’s source code and executes your tests.  Configurable : Can be configured to run against a number of browsers, which is useful for being confident that your application works on all browsers you need to support.  Executed on the command line and will display the results of your tests on the command line once they have run in the browser.  Default configuration file name: karma.conf.jsJasmine  Is behavior driven development framework for JavaScript.  AngularJS API recommends Jasmine for unit testing.  Provides functions to help with structuring your tests.  Provides API to make assertions.Jasmine provides the function to group the tests together.describe('Description for group of tests', function(){        // individual tests go here    });In Jasmine we create a spec(test) by calling it function.it('This is description for test', function(){        // Test code go here    });So basically our test looks like below.describe('some description', function(){        it('some descrption', function(){                //test code go here            });    });Testing ControllerLet us assume that we have controller like below angular        .module('appName', [])        .controller('MainCtrl', function(MainService) {            var vm = this;            vm.someText = 'Initial Text';            vm.serviceReturnedValue = MainService.callMe();            vm.changeText = function() {                vm.someText = 'Text Changed';            };        });In order to test this simple controller we need toSTEP 1. Load the module using angular.mock.module('appName'); or module('appName');STEP 2. Get the hold of $controller service using inject function.var $controller;inject(function(_$controller_) {    $controller = _$controller_;});// _ (underscore) is used if you want to cache $controller service with same name.STEP 3. Initialize the controller using $controller service.// $controller('ControllerName', dependenciesObject);var MainService = {    callMe: function() {        return 'Hello World';    }}; // notice how we are simply mocking servicesvar MainCtrl = $controller('MainCtrl', {MainService: MainService});STEP 4. Make assertionexpect(MainCtrl.someText).toBe('Initial Text');expect(MainCtrl.someText).not.toBe('Random Text');expect(MainCtrl.serviceReturnedValue).toBe('Hello World');expect(MainCtrl.serviceReturnedValue).not.toBe('Random World');MainCtrl.changeText();expect(MainCtrl.someText).not.toBe('Initial Text');expect(MainCtrl.someText).toBe('Text Changed');More on Jasmine Expectation here.Testing ServicesSuppose we have a service that makes AJAX calls, which looks like.factory('MainService', function($resource) {    return $resource('/api/:id');})To unit test this component we need to make sure we do not mock the actual service MainService we are trying to mock. We also need to make sure we do not make an actual call to external resources.So we need to somehow mock the http requests itself. Luckily, we have $httpBackend service which will help us mock http requests. Let’s see how we can achieve thisSTEP 1 . Load the module with module('appName');STEP 2 . Get hold of $httpBackend and MainService. Notice we don’t mock MainService here.var $httpBackend;var MainService;inject(function(_$httpBackend_, _MainService_) {    $httpBackend = _$httpBackend_;    MainService = _MainService_;});STEP 3 . Mock request that we will be making using $httpBackend.$httpBackend    .expectGET('/api/1')    .respond( 200, { name: 'Aman', id: 1 } );Notice we are using expectGET method here to expect the GET request to be made and when we get one we tell our mock request to respond with status 200 and return an object.Like expectGET we have expectPOST, expectDELETE … etc.STEP 4 . Make a http request and make it synchronous using $httpBackend.flush()var result;MainService.get({id: 1}, function(data) {    result = data;});$httpBackend.flush();STEP 5 . Make Expectationexpect(result.name).toBe('Aman');expect(result.name).not.toBe('Random Text');expect(result.id).toBe(1);expect(result.id).not.toBe(5);Testing Directive// simple directive.directive('myDirective', function() {    return function(scope, elem) {        elem.append('&lt;span&gt;This is appended element&lt;/span&gt;');    };});// OR.directive('myDirective', function() {    return {        template: '&lt;span&gt;This is appended element&lt;/span&gt;'    };});Let’s see how we can test this directive.STEP 1 Load the module. module('appName');STEP 2 Get hold of $compile service and $rootScopevar $compile, $rootScope;inject(function(_$compile_, _$rootScope_) {    $compile = _$compile_;    $rootScope = _$rootScope_;});STEP 3 Compile the directivevar directiveElem = getCompiledElement();function getCompiledElement() {    var element = angular.element('&lt;div my-directive/&gt;&lt;/div&gt;');    var compiledElement = $compile(element)($rootScope);    $rootScope.$digest();    return compiledElement;}For compiling the directive we are first creating the element that has our directive.Then we are using $compile servie to compile our direciveFor completing hte compile process we start the digest cycleThen at end we return the compiled element.STEP 4 Make Expectationvar spanElement = directiveElem.find('span');expect(spanElement).toBeDefined();expect(spanElement.text()).toEqual('This is appended element');expect(spanElement.text()).not.toEqual('Some random text');Testing Directive with templateUrlTesting a directive with template referred from a file is tricky, as the directive makes an $httpBackend request to the templateUrl. Adding this template to $templateCache makes the task of testing easier and the template will be easy to share. This can be done using the karma-ng-html2js-preprocessor.This preprocessor converts HTML files into JS strings and generates Angular modules. These modules, when loaded, puts these HTML files into the $templateCache and therefore Angular won’t try to fetch them from the server.preprocessors: {    'path/to/html/template': ['ng-html2js'],},ngHtml2JsPreprocessor: {    moduleName: 'Templates'}Just make sure you load Templates module when you test your directive.Bonus - To run single test on Karma using IntelliJ IdeaUpdateIf you update your IntelliJ IDEA and Karma plugin to latest version you can run individual test directly from UI (Like we do in Java test).STEP 1 Install Karma pluginSTEP 2 Open karma.conf.js and you will get the run configuration. Run it.STEP 3 All the test will run the first time. Then after completion open tab Karma Server.STEP 4 Notice server is still running. Open the terminal and run following commandkarma run path/to/conf/file/karma.conf.js -- --grep=descriptionFor example above we usekarma run path/to/karma.conf.js -- --grep=helloWorld because helloWorld is describe description.",
            "content_html": "<p>In this post I will talk about AngularJS testing. This will be quick and easy guide to get up and running with AngularJS testing.This post cover basics of :</p><ul>  <li>Karma</li>  <li>Jasmine</li>  <li>Testing Controller</li>  <li>Testing Services (<code class=\"language-plaintext highlighter-rouge\">http</code> request)</li>  <li>Testing Directive</li></ul><hr /><h1 id=\"karma\">Karma</h1><ul>  <li>Is a command line tool that can be used to spawn a web server which loads your application’s source code and executes your tests.</li>  <li>Configurable : Can be configured to run against a number of browsers, which is useful for being confident that your application works on all browsers you need to support.</li>  <li>Executed on the command line and will display the results of your tests on the command line once they have run in the browser.</li>  <li>Default configuration file name: <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code></li></ul><hr /><h1 id=\"jasmine\">Jasmine</h1><ul>  <li>Is behavior driven development framework for JavaScript.</li>  <li>AngularJS API recommends Jasmine for unit testing.</li>  <li>Provides functions to help with structuring your tests.</li>  <li>Provides API to make assertions.</li></ul><p>Jasmine provides the function to group the tests together.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Description for group of tests</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>        <span class=\"c1\">// individual tests go here</span>    <span class=\"p\">});</span></code></pre></div></div><p>In Jasmine we create a <strong>spec</strong>(test) by calling <code class=\"language-plaintext highlighter-rouge\">it</code> function.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">This is description for test</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>        <span class=\"c1\">// Test code go here</span>    <span class=\"p\">});</span></code></pre></div></div><p>So basically our test looks like below.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">some description</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">some descrption</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>                <span class=\"c1\">//test code go here</span>            <span class=\"p\">});</span>    <span class=\"p\">});</span></code></pre></div></div><hr /><h1 id=\"testing-controller\">Testing Controller</h1><p>Let us assume that we have controller like below</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> <span class=\"nx\">angular</span>        <span class=\"p\">.</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">appName</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">[])</span>        <span class=\"p\">.</span><span class=\"nx\">controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">MainCtrl</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">MainService</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"kd\">var</span> <span class=\"nx\">vm</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">;</span>            <span class=\"nx\">vm</span><span class=\"p\">.</span><span class=\"nx\">someText</span> <span class=\"o\">=</span> <span class=\"dl\">'</span><span class=\"s1\">Initial Text</span><span class=\"dl\">'</span><span class=\"p\">;</span>            <span class=\"nx\">vm</span><span class=\"p\">.</span><span class=\"nx\">serviceReturnedValue</span> <span class=\"o\">=</span> <span class=\"nx\">MainService</span><span class=\"p\">.</span><span class=\"nx\">callMe</span><span class=\"p\">();</span>            <span class=\"nx\">vm</span><span class=\"p\">.</span><span class=\"nx\">changeText</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>                <span class=\"nx\">vm</span><span class=\"p\">.</span><span class=\"nx\">someText</span> <span class=\"o\">=</span> <span class=\"dl\">'</span><span class=\"s1\">Text Changed</span><span class=\"dl\">'</span><span class=\"p\">;</span>            <span class=\"p\">};</span>        <span class=\"p\">});</span></code></pre></div></div><p>In order to test this simple controller we need to</p><p><strong>STEP 1</strong>. Load the module using <code class=\"language-plaintext highlighter-rouge\">angular.mock.module('appName');</code> or <code class=\"language-plaintext highlighter-rouge\">module('appName');</code></p><p><strong>STEP 2</strong>. Get the hold of <code class=\"language-plaintext highlighter-rouge\">$controller</code> service using <code class=\"language-plaintext highlighter-rouge\">inject</code> function.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">$controller</span><span class=\"p\">;</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$controller_</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"nx\">$controller</span> <span class=\"o\">=</span> <span class=\"nx\">_$controller_</span><span class=\"p\">;</span><span class=\"p\">});</span><span class=\"c1\">// _ (underscore) is used if you want to cache $controller service with same name.</span></code></pre></div></div><p><strong>STEP 3</strong>. Initialize the controller using <code class=\"language-plaintext highlighter-rouge\">$controller</code> service.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// $controller('ControllerName', dependenciesObject);</span><span class=\"kt\">var</span> <span class=\"nc\">MainService</span> <span class=\"o\">=</span> <span class=\"o\">{</span>    <span class=\"nl\">callMe:</span> <span class=\"n\">function</span><span class=\"o\">()</span> <span class=\"o\">{</span>        <span class=\"k\">return</span> <span class=\"err\">'</span><span class=\"nc\">Hello</span> <span class=\"nc\">World</span><span class=\"err\">'</span><span class=\"o\">;</span>    <span class=\"o\">}</span><span class=\"o\">};</span> <span class=\"c1\">// notice how we are simply mocking services</span><span class=\"kt\">var</span> <span class=\"nc\">MainCtrl</span> <span class=\"o\">=</span> <span class=\"n\">$controller</span><span class=\"o\">(</span><span class=\"err\">'</span><span class=\"nc\">MainCtrl</span><span class=\"err\">'</span><span class=\"o\">,</span> <span class=\"o\">{</span><span class=\"nl\">MainService:</span> <span class=\"nc\">MainService</span><span class=\"o\">});</span></code></pre></div></div><p><strong>STEP 4</strong>. Make assertion</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">MainCtrl</span><span class=\"p\">.</span><span class=\"nx\">someText</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Initial Text</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">MainCtrl</span><span class=\"p\">.</span><span class=\"nx\">someText</span><span class=\"p\">).</span><span class=\"nx\">not</span><span class=\"p\">.</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Random Text</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">MainCtrl</span><span class=\"p\">.</span><span class=\"nx\">serviceReturnedValue</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Hello World</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">MainCtrl</span><span class=\"p\">.</span><span class=\"nx\">serviceReturnedValue</span><span class=\"p\">).</span><span class=\"nx\">not</span><span class=\"p\">.</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Random World</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">MainCtrl</span><span class=\"p\">.</span><span class=\"nx\">changeText</span><span class=\"p\">();</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">MainCtrl</span><span class=\"p\">.</span><span class=\"nx\">someText</span><span class=\"p\">).</span><span class=\"nx\">not</span><span class=\"p\">.</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Initial Text</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">MainCtrl</span><span class=\"p\">.</span><span class=\"nx\">someText</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Text Changed</span><span class=\"dl\">'</span><span class=\"p\">);</span></code></pre></div></div><p>More on <a href=\"https://jasmine.github.io/2.4/introduction.html#section-Expectations\">Jasmine Expectation here.</a></p><hr /><h1 id=\"testing-services\">Testing Services</h1><p>Suppose we have a service that makes AJAX calls, which looks like</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">.</span><span class=\"nx\">factory</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">MainService</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">$resource</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">return</span> <span class=\"nx\">$resource</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">/api/:id</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"p\">})</span></code></pre></div></div><p>To unit test this component we need to make sure we do not mock the actual service <code class=\"language-plaintext highlighter-rouge\">MainService</code> we are trying to mock. We also need to make sure we do not make an actual call to external resources.So we need to somehow mock the http requests itself. Luckily, we have <code class=\"language-plaintext highlighter-rouge\">$httpBackend</code> service which will help us mock <code class=\"language-plaintext highlighter-rouge\">http</code> requests. Let’s see how we can achieve this</p><p><strong>STEP 1 .</strong> Load the module with <code class=\"language-plaintext highlighter-rouge\">module('appName');</code></p><p><strong>STEP 2 .</strong> Get hold of <code class=\"language-plaintext highlighter-rouge\">$httpBackend</code> and <code class=\"language-plaintext highlighter-rouge\">MainService</code>. Notice we don’t mock <code class=\"language-plaintext highlighter-rouge\">MainService</code> here.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">$httpBackend</span><span class=\"p\">;</span><span class=\"kd\">var</span> <span class=\"nx\">MainService</span><span class=\"p\">;</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$httpBackend_</span><span class=\"p\">,</span> <span class=\"nx\">_MainService_</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"nx\">$httpBackend</span> <span class=\"o\">=</span> <span class=\"nx\">_$httpBackend_</span><span class=\"p\">;</span>    <span class=\"nx\">MainService</span> <span class=\"o\">=</span> <span class=\"nx\">_MainService_</span><span class=\"p\">;</span><span class=\"p\">});</span></code></pre></div></div><p><strong>STEP 3 .</strong> Mock request that we will be making using <code class=\"language-plaintext highlighter-rouge\">$httpBackend</code>.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">$httpBackend</span>    <span class=\"p\">.</span><span class=\"nx\">expectGET</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">/api/1</span><span class=\"dl\">'</span><span class=\"p\">)</span>    <span class=\"p\">.</span><span class=\"nx\">respond</span><span class=\"p\">(</span> <span class=\"mi\">200</span><span class=\"p\">,</span> <span class=\"p\">{</span> <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Aman</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"na\">id</span><span class=\"p\">:</span> <span class=\"mi\">1</span> <span class=\"p\">}</span> <span class=\"p\">);</span></code></pre></div></div><p>Notice we are using expectGET method here to expect the GET request to be made and when we get one we tell our mock request to respond with status <code class=\"language-plaintext highlighter-rouge\">200</code> and return an object.Like expectGET we have expectPOST, expectDELETE … etc.</p><p><strong>STEP 4 .</strong> Make a <code class=\"language-plaintext highlighter-rouge\">http</code> request and make it synchronous using <code class=\"language-plaintext highlighter-rouge\">$httpBackend.flush()</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">result</span><span class=\"p\">;</span><span class=\"nx\">MainService</span><span class=\"p\">.</span><span class=\"kd\">get</span><span class=\"p\">({</span><span class=\"na\">id</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">},</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"nx\">data</span><span class=\"p\">;</span><span class=\"p\">});</span><span class=\"nx\">$httpBackend</span><span class=\"p\">.</span><span class=\"nx\">flush</span><span class=\"p\">();</span></code></pre></div></div><p><strong>STEP 5 .</strong> Make Expectation</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">result</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Aman</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">result</span><span class=\"p\">.</span><span class=\"nx\">name</span><span class=\"p\">).</span><span class=\"nx\">not</span><span class=\"p\">.</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Random Text</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">result</span><span class=\"p\">.</span><span class=\"nx\">id</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">result</span><span class=\"p\">.</span><span class=\"nx\">id</span><span class=\"p\">).</span><span class=\"nx\">not</span><span class=\"p\">.</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">);</span></code></pre></div></div><hr /><h1 id=\"testing-directive\">Testing Directive</h1><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// simple directive</span><span class=\"p\">.</span><span class=\"nx\">directive</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">myDirective</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"k\">return</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">,</span> <span class=\"nx\">elem</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">elem</span><span class=\"p\">.</span><span class=\"nx\">append</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">&lt;span&gt;This is appended element&lt;/span&gt;</span><span class=\"dl\">'</span><span class=\"p\">);</span>    <span class=\"p\">};</span><span class=\"p\">});</span><span class=\"c1\">// OR</span><span class=\"p\">.</span><span class=\"nx\">directive</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">myDirective</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"k\">return</span> <span class=\"p\">{</span>        <span class=\"na\">template</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">&lt;span&gt;This is appended element&lt;/span&gt;</span><span class=\"dl\">'</span>    <span class=\"p\">};</span><span class=\"p\">});</span></code></pre></div></div><p>Let’s see how we can test this directive.</p><p><strong>STEP 1</strong> Load the module. <code class=\"language-plaintext highlighter-rouge\">module('appName');</code></p><p><strong>STEP 2</strong> Get hold of <code class=\"language-plaintext highlighter-rouge\">$compile</code> service and <code class=\"language-plaintext highlighter-rouge\">$rootScope</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">$compile</span><span class=\"p\">,</span> <span class=\"nx\">$rootScope</span><span class=\"p\">;</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$compile_</span><span class=\"p\">,</span> <span class=\"nx\">_$rootScope_</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"nx\">$compile</span> <span class=\"o\">=</span> <span class=\"nx\">_$compile_</span><span class=\"p\">;</span>    <span class=\"nx\">$rootScope</span> <span class=\"o\">=</span> <span class=\"nx\">_$rootScope_</span><span class=\"p\">;</span><span class=\"p\">});</span></code></pre></div></div><p><strong>STEP 3</strong> Compile the directive</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">directiveElem</span> <span class=\"o\">=</span> <span class=\"nx\">getCompiledElement</span><span class=\"p\">();</span><span class=\"kd\">function</span> <span class=\"nx\">getCompiledElement</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"kd\">var</span> <span class=\"nx\">element</span> <span class=\"o\">=</span> <span class=\"nx\">angular</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">&lt;div my-directive/&gt;&lt;/div&gt;</span><span class=\"dl\">'</span><span class=\"p\">);</span>    <span class=\"kd\">var</span> <span class=\"nx\">compiledElement</span> <span class=\"o\">=</span> <span class=\"nx\">$compile</span><span class=\"p\">(</span><span class=\"nx\">element</span><span class=\"p\">)(</span><span class=\"nx\">$rootScope</span><span class=\"p\">);</span>    <span class=\"nx\">$rootScope</span><span class=\"p\">.</span><span class=\"nx\">$digest</span><span class=\"p\">();</span>    <span class=\"k\">return</span> <span class=\"nx\">compiledElement</span><span class=\"p\">;</span><span class=\"p\">}</span></code></pre></div></div><p>For compiling the directive we are first creating the element that has our directive.Then we are using <code class=\"language-plaintext highlighter-rouge\">$compile</code> servie to compile our direciveFor completing hte compile process we start the digest cycleThen at end we return the compiled element.</p><p><strong>STEP 4</strong> Make Expectation</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">spanElement</span> <span class=\"o\">=</span> <span class=\"nx\">directiveElem</span><span class=\"p\">.</span><span class=\"nx\">find</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">span</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">spanElement</span><span class=\"p\">).</span><span class=\"nx\">toBeDefined</span><span class=\"p\">();</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">spanElement</span><span class=\"p\">.</span><span class=\"nx\">text</span><span class=\"p\">()).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">This is appended element</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">spanElement</span><span class=\"p\">.</span><span class=\"nx\">text</span><span class=\"p\">()).</span><span class=\"nx\">not</span><span class=\"p\">.</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Some random text</span><span class=\"dl\">'</span><span class=\"p\">);</span></code></pre></div></div><hr /><h1 id=\"testing-directive-with-templateurl\">Testing Directive with templateUrl</h1><p>Testing a directive with template referred from a file is tricky, as the directive makes an <code class=\"language-plaintext highlighter-rouge\">$httpBackend</code> request to the templateUrl. Adding this template to <code class=\"language-plaintext highlighter-rouge\">$templateCache</code> makes the task of testing easier and the template will be easy to share. This can be done using the karma-ng-html2js-preprocessor.</p><p>This preprocessor converts HTML files into JS strings and generates Angular modules. These modules, when loaded, puts these HTML files into the <code class=\"language-plaintext highlighter-rouge\">$templateCache</code> and therefore Angular won’t try to fetch them from the server.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">preprocessors</span><span class=\"p\">:</span> <span class=\"p\">{</span>    <span class=\"dl\">'</span><span class=\"s1\">path/to/html/template</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">ng-html2js</span><span class=\"dl\">'</span><span class=\"p\">],</span><span class=\"p\">},</span><span class=\"nx\">ngHtml2JsPreprocessor</span><span class=\"p\">:</span> <span class=\"p\">{</span>    <span class=\"nl\">moduleName</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Templates</span><span class=\"dl\">'</span><span class=\"p\">}</span></code></pre></div></div><p><strong>Just make sure you load <code class=\"language-plaintext highlighter-rouge\">Templates</code> module when you test your directive.</strong></p><hr /><h1 id=\"bonus---to-run-single-test-on-karma-using-intellij-idea\">Bonus - To run single test on <code class=\"language-plaintext highlighter-rouge\">Karma</code> using IntelliJ Idea</h1><h3 id=\"update\">Update</h3><p>If you update your IntelliJ IDEA and Karma plugin to latest version you can run individual test directly from UI (Like we do in Java test).</p><p><strong>STEP 1</strong> Install <code class=\"language-plaintext highlighter-rouge\">Karma</code> plugin</p><p><strong>STEP 2</strong> Open <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code> and you will get the run configuration. Run it.<img src=\"/assets/blog/2017-07-11-angularjs-testing-in-nutshell/karma-run-intellij.png\" width=\"30%\" /></p><p><strong>STEP 3</strong> All the test will run the first time. Then after completion open tab <code class=\"language-plaintext highlighter-rouge\">Karma Server</code>.<img src=\"/assets/blog/2017-07-11-angularjs-testing-in-nutshell/karma-server-intellij.png\" width=\"30%\" /></p><p><strong>STEP 4</strong> Notice server is still running. Open the terminal and run following command<code class=\"language-plaintext highlighter-rouge\">karma run path/to/conf/file/karma.conf.js -- --grep=description</code></p><p>For example above we use<code class=\"language-plaintext highlighter-rouge\">karma run path/to/karma.conf.js -- --grep=helloWorld</code> because helloWorld is <code class=\"language-plaintext highlighter-rouge\">describe</code> description.</p><p><img src=\"/assets/blog/2017-07-11-angularjs-testing-in-nutshell/karma-single-test-run-intellij.png\" width=\"30%\" /></p>",
            "url": "https://babal.dev/2017/07/11/angularjs-testing-in-nutshell",
            
            
            
            "tags": ["javascript","angular"],
            
            "date_published": "2017-07-11T00:00:00-04:00",
            "date_modified": "2017-07-11T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/12/25/understaing-spy-on-jasmine",
            "title": "Getting familiar with spyOn for Angular Testing",
            "summary": "Let's look at power of spyOn",
            "content_text": "Now that we know how to do simple testing let’s get familiar with spy feature of jasmine.In previous post we saw different way of mocking services and/or objects.Let’s start with simple example of spyOn    it('spy', function() {        var spyObject = {            someFunction: function(args) {                return 'SomeFunction' + ' ' +  args;            }        };        spyOn(spyObject,'someFunction');        spyObject.someFunction();        expect(spyObject.someFunction).toHaveBeenCalledTimes(1);    });In above example we declared simple object (spyObject) which has one function (someFunction()).If we want to spy on some method we can use jasmine global function spyOn().spyOn(&lt;object&gt;,&lt;method_to_spy_on&gt;) accepts object as first parameter. It is a object where our target function which we want to spy on exist.Second parameter is the name of the method that we want to spy on.After we stated the statement to spy on our function we called that function and we added expectation to check if the functionwas called exactly once.A spy can stub any function and tracks calls to it and all arguments. When ever we track any function we need to remember that it will be removed after each spec.If we want to check if the method was called ignoring the number of times it was called we can use .toHaveBeenCalled()    expect(spyObject.someFunction).toHaveBeenCalled();If we want to check if the function was called with specific argument we can we .toHaveBeenCalledWith()    spyObject.someFunction('ABC');    expect(spyObject.someFunction).toHaveBeenCalledWith('ABC');One thing to remember about .toHaveBeenCalledWith() that this method checks if the function was called which specifiedargument at least one time. For example following snippet is also truespyObject.someFunction('ABC');spyObject.someFunction('ABCDEGF');expect(spyObject.someFunction).toHaveBeenCalledWith('ABC');This method works fine when we want to track calls but if we check the return value from the function you will see that it doesn’t return anything. var returnValue = spyObject.someFunction('ABC');expect(returnValue).toEqual('SomeFunction ABC'); // This will failSo whats happening here. When we spied the function the function stopped all the calles and it just tracked calls and argument.If you want function call to delegate to the actual implemantation we need to add .and.callThrouch() on spy statement.spyOn(spyObject,'someFunction').and.callThrough();var returnValue = spyObject.someFunction('ABC');expect(returnValue).toEqual('SomeFunction ABC'); // This will now passwe can also return fake value from spied functionspyOn(spyObject,'someFunction').and.returnValue('Returned');var returnValue = spyObject.someFunction('ABC');expect(returnValue).toEqual('Returned');We can also call fake function from spied function        spyOn(spyObject,'someFunction').and.callFake(function(){            return 'FakeFunction'        });        var returnValue = spyObject.someFunction('ABC');        expect(returnValue).toEqual('FakeFunction');        We have lot of other traking properties which can be view on Jasmine Introduction Page",
            "content_html": "<p>Now that we know how to do simple testing let’s get familiar with <code class=\"language-plaintext highlighter-rouge\">spy</code> feature of <code class=\"language-plaintext highlighter-rouge\">jasmine</code>.In previous post we saw different way of mocking services and/or objects.</p><p>Let’s start with simple example of <code class=\"language-plaintext highlighter-rouge\">spyOn</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>    <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">spy</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kd\">var</span> <span class=\"nx\">spyObject</span> <span class=\"o\">=</span> <span class=\"p\">{</span>            <span class=\"na\">someFunction</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">args</span><span class=\"p\">)</span> <span class=\"p\">{</span>                <span class=\"k\">return</span> <span class=\"dl\">'</span><span class=\"s1\">SomeFunction</span><span class=\"dl\">'</span> <span class=\"o\">+</span> <span class=\"dl\">'</span><span class=\"s1\"> </span><span class=\"dl\">'</span> <span class=\"o\">+</span>  <span class=\"nx\">args</span><span class=\"p\">;</span>            <span class=\"p\">}</span>        <span class=\"p\">};</span>        <span class=\"nx\">spyOn</span><span class=\"p\">(</span><span class=\"nx\">spyObject</span><span class=\"p\">,</span><span class=\"dl\">'</span><span class=\"s1\">someFunction</span><span class=\"dl\">'</span><span class=\"p\">);</span>        <span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">();</span>        <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">).</span><span class=\"nx\">toHaveBeenCalledTimes</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>    <span class=\"p\">});</span></code></pre></div></div><p>In above example we declared simple object (<code class=\"language-plaintext highlighter-rouge\">spyObject</code>) which has one function (<code class=\"language-plaintext highlighter-rouge\">someFunction()</code>).If we want to spy on some method we can use jasmine global function <code class=\"language-plaintext highlighter-rouge\">spyOn()</code>.<code class=\"language-plaintext highlighter-rouge\">spyOn(&lt;object&gt;,&lt;method_to_spy_on&gt;)</code> accepts object as first parameter. It is a object where our target function which we want to spy on exist.Second parameter is the name of the method that we want to spy on.After we stated the statement to spy on our function we called that function and we added expectation to check if the functionwas called exactly once.</p><p>A spy can stub any function and tracks calls to it and all arguments. When ever we track any function we need to remember that it will be removed after each spec.</p><p>If we want to check if the method was called ignoring the number of times it was called we can use <code class=\"language-plaintext highlighter-rouge\">.toHaveBeenCalled()</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>    <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">).</span><span class=\"nx\">toHaveBeenCalled</span><span class=\"p\">();</span></code></pre></div></div><p>If we want to check if the function was called with specific argument we can we <code class=\"language-plaintext highlighter-rouge\">.toHaveBeenCalledWith()</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>    <span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span>    <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">).</span><span class=\"nx\">toHaveBeenCalledWith</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span></code></pre></div></div><p>One thing to remember about <code class=\"language-plaintext highlighter-rouge\">.toHaveBeenCalledWith()</code> that this method checks if the function was called which specifiedargument at least one time. For example following snippet is also true</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABCDEGF</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">).</span><span class=\"nx\">toHaveBeenCalledWith</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span></code></pre></div></div><p>This method works fine when we want to track calls but if we check the return value from the function you will see that it doesn’t return anything.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> <span class=\"kd\">var</span> <span class=\"nx\">returnValue</span> <span class=\"o\">=</span> <span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">returnValue</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">SomeFunction ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span> <span class=\"c1\">// This will fail</span></code></pre></div></div><p>So whats happening here. When we spied the function the function stopped all the calles and it just tracked calls and argument.If you want function call to delegate to the actual implemantation we need to add <code class=\"language-plaintext highlighter-rouge\">.and.callThrouch()</code> on spy statement.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">spyOn</span><span class=\"p\">(</span><span class=\"nx\">spyObject</span><span class=\"p\">,</span><span class=\"dl\">'</span><span class=\"s1\">someFunction</span><span class=\"dl\">'</span><span class=\"p\">).</span><span class=\"nx\">and</span><span class=\"p\">.</span><span class=\"nx\">callThrough</span><span class=\"p\">();</span><span class=\"kd\">var</span> <span class=\"nx\">returnValue</span> <span class=\"o\">=</span> <span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">returnValue</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">SomeFunction ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span> <span class=\"c1\">// This will now pass</span></code></pre></div></div><p>we can also return fake value from spied function</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">spyOn</span><span class=\"p\">(</span><span class=\"nx\">spyObject</span><span class=\"p\">,</span><span class=\"dl\">'</span><span class=\"s1\">someFunction</span><span class=\"dl\">'</span><span class=\"p\">).</span><span class=\"nx\">and</span><span class=\"p\">.</span><span class=\"nx\">returnValue</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Returned</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"kd\">var</span> <span class=\"nx\">returnValue</span> <span class=\"o\">=</span> <span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">returnValue</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Returned</span><span class=\"dl\">'</span><span class=\"p\">);</span></code></pre></div></div><p>We can also call fake function from spied function</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>        <span class=\"nx\">spyOn</span><span class=\"p\">(</span><span class=\"nx\">spyObject</span><span class=\"p\">,</span><span class=\"dl\">'</span><span class=\"s1\">someFunction</span><span class=\"dl\">'</span><span class=\"p\">).</span><span class=\"nx\">and</span><span class=\"p\">.</span><span class=\"nx\">callFake</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(){</span>            <span class=\"k\">return</span> <span class=\"dl\">'</span><span class=\"s1\">FakeFunction</span><span class=\"dl\">'</span>        <span class=\"p\">});</span>        <span class=\"kd\">var</span> <span class=\"nx\">returnValue</span> <span class=\"o\">=</span> <span class=\"nx\">spyObject</span><span class=\"p\">.</span><span class=\"nx\">someFunction</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">ABC</span><span class=\"dl\">'</span><span class=\"p\">);</span>        <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">returnValue</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">FakeFunction</span><span class=\"dl\">'</span><span class=\"p\">);</span>        </code></pre></div></div><p>We have lot of other traking properties which can be view on <a href=\"https://jasmine.github.io/edge/introduction.html?spec=Manually%20ticking%20the%20Jasmine%20Clock%20causes%20an%20interval%20to%20be%20called%20synchronously#section-Spies\">Jasmine Introduction Page</a></p>",
            "url": "https://babal.dev/2016/12/25/understaing-spy-on-jasmine",
            
            
            
            "tags": ["javascript","angular"],
            
            "date_published": "2016-12-25T00:00:00-05:00",
            "date_modified": "2016-12-25T00:00:00-05:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/12/24/angular-testing-controller-with-dependency",
            "title": "Testing Controller (with Dependencies) in AngularJS",
            "summary": "In this article I'll show you how we can test AngularJS Controller which have any dependencies",
            "content_text": "In Part 4 of this series we looked athow we can test AngularJS Controller which doesn’t have any dependencies. But, in real world,AngularJS Controllers usually dependent on Services. In this post we will look, how we can unit test controllerswhich have dependencies.On the way, we will explore how we can use angular.mock.module(...).We will get insight on how angular.mock.inject() works.Here’s a simple todo app which has has TodoController and TodoService. TodoController is dependent on TodoService.(function(angular) {    'use strict';    angular        .module('app')        .controller('TodoController', TodoController)        .factory('TodoService', TodoService);    TodoController.$inject = ['$scope','TodoService'];    function TodoService() {        var that = this;        that.todos = [            {'title': 'First Todo', 'done': false}        ];        return {            getAll : getAll,            add: add,            clearCompleted: clearCompleted        };        function getAll(){            return that.todos;        }        function add(newTodo) {            that.todos.unshift({'title': newTodo, 'done': false});            return that.todos;        }        function clearCompleted() {            that.todos = that.todos.filter(function(todo) {                return !todo.done;            });            return that.todos;        }    }    function TodoController($scope, TodoService) {        $scope.todos = TodoService.getAll();        $scope.add = add;        $scope.clearCompleted = clearCompleted;        //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~        function add() {            $scope.todos = TodoService.add($scope.newTodo);            $scope.newTodo = \"\";        }        function clearCompleted() {            $scope.todos = TodoService.clearCompleted();        }    }})(angular);Since we will be unit testing controller we will need the mocked TodoService. We can create mocked TodoService using 3 ways  Using angular.mock.module(&lt;passing object&gt;)  Using angular.mock.module(&lt;passing function&gt;)  Creating simple object and passing it when we initialize controllerBefore we start these 3 topic let’s write some testdescribe('TodoController', function() {    var $controller;    beforeEach(module('app'));    beforeEach(inject(function(_$controller_) {        $controller = _$controller_;    }));    describe('When initialized', function() {        it('Then $scope.todos must have default todo', function() {            var scope = {};            $controller('TodoController', {$scope: scope});            expect(scope.todos.length).toBe(1);        });    });});If you run above test it will run fine. We didn’t mock the TodoService and we didn’t passed TodoServie so how is this test working.This example shows the angular injector in action. Here injector acts as Service locator.If we want to get hold of TodoService we can use angular.mock.inject(..) which acts as wrapper for angular injector        it('Directly calling Service', function() {            var TodoService;            inject(function(_TodoService_){                TodoService = _TodoService_;            });            var length = TodoService.getAll().length;            expect(length).toBe(1);        });Now that we know how angular injector helps to locate our service, let’s look at how we can mock the service classes. Note:above example calles the real service methods.Let’s mock services using angular.mock.module(...) by passing objectHere’s a updated testdescribe('TodoController', function() {    var $controller;    beforeEach(module('app'));    // Mocking TodoService    // Using angular.mock.module(object);    beforeEach(function() {        var todo = [            {'title': 'Test Todo', 'done': false},            {'title': 'Test Todo', 'done': false}        ];        var TodoService = {            todos: todo,            getAll: function() {                return todo;            },            add: function() {            },            clearCompleted: function() {            }        };        var objectToBePassed = {            'TodoService': TodoService        };        module(objectToBePassed);    });    beforeEach(inject(function(_$controller_) {        $controller = _$controller_;    }));    describe('When initialized', function() {        it('Then $scope.todos must have default todo', function() {            var scope = {};            $controller('TodoController', {$scope: scope});            expect(scope.todos.length).toBe(2);        });    });});In above example we are passing object to angular.module.module(...).Object that we passed to angular.mock.module(...) have key that matches service name that we want to mock.In our case its TodoService.To prove we are using mocked service we increased the default size of todo to 2. If you look at our expectation we areasserting length of todos to be 2 instead to 1 to match with mocked service.Using angular.mock.module(...) by passing function to mock serviceExampledescribe('TodoController', function() {    var $controller;    beforeEach(module('app'));    // Mocking TodoService    // Using angular.mock.module(function);    beforeEach(function() {        var functionToBePassed = function($provide){            var todo = [                {'title': 'Test Todo', 'done': false},                {'title': 'Test Todo', 'done': false}            ];            var TodoService = {                todos: todo,                getAll: function() {                    return todo;                },                add: function() {                },                clearCompleted: function() {                }            };            $provide.service('TodoService', function(){                return TodoService;            });        };        module(functionToBePassed);    });    beforeEach(inject(function(_$controller_) {        $controller = _$controller_;    }));    describe('When initialized', function() {        it('Then $scope.todos must have default todo', function() {            var scope = {};            $controller('TodoController', {$scope: scope});            expect(scope.todos.length).toBe(2);        });    });});In above example we are using angular.mock.module(...) and passing function. One important thing to note here is that when we passfunction in angular.mock.module(...) we need to get reference of $provide. We will use $provide to mock the services.To mock service we use $provide.service(serviceName, serviceFunction).Let’s look how we can mock with simple objectdescribe('TodoController', function() {    var $controller;    beforeEach(module('app'));    beforeEach(inject(function(_$controller_) {        $controller = _$controller_;    }));    describe('When initialized', function() {        it('Then $scope.todos must have default todo', function() {            var scope = {};            var todo = [                {'title': 'Test Todo', 'done': false},                {'title': 'Test Todo', 'done': false}            ];            // Using simple Object only            var TodoService = {                todos: todo,                getAll: function() {                    return todo;                },                add: function() {                },                clearCompleted: function() {                }            };            // Passing TodoService when initialize controller            $controller(                'TodoController',                {                    $scope: scope,                    TodoService: TodoService                }            );            expect(scope.todos.length).toBe(2);        });    });});Above example is very simple and I don’t think it needs any explanation. In next post we will se how we can spy object using spyOnand change the behaviour of spied function.",
            "content_html": "<p>In <a href=\"https://amantuladhar.github.io/blog/2016-11-30-angular-testing-controller/\">Part 4</a> of this series we looked athow we can test AngularJS Controller which doesn’t have any dependencies. But, in real world,AngularJS Controllers usually dependent on Services. In this post we will look, how we can unit test controllerswhich have dependencies.On the way, we will explore how we can use <code class=\"language-plaintext highlighter-rouge\">angular.mock.module(...)</code>.We will get insight on how <code class=\"language-plaintext highlighter-rouge\">angular.mock.inject()</code> works.</p><p>Here’s a simple todo app which has has <code class=\"language-plaintext highlighter-rouge\">TodoController</code> and <code class=\"language-plaintext highlighter-rouge\">TodoService</code>. <code class=\"language-plaintext highlighter-rouge\">TodoController</code> is dependent on <code class=\"language-plaintext highlighter-rouge\">TodoService</code>.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">angular</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"dl\">'</span><span class=\"s1\">use strict</span><span class=\"dl\">'</span><span class=\"p\">;</span>    <span class=\"nx\">angular</span>        <span class=\"p\">.</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">)</span>        <span class=\"p\">.</span><span class=\"nx\">controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"nx\">TodoController</span><span class=\"p\">)</span>        <span class=\"p\">.</span><span class=\"nx\">factory</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoService</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"nx\">TodoService</span><span class=\"p\">);</span>    <span class=\"nx\">TodoController</span><span class=\"p\">.</span><span class=\"nx\">$inject</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">$scope</span><span class=\"dl\">'</span><span class=\"p\">,</span><span class=\"dl\">'</span><span class=\"s1\">TodoService</span><span class=\"dl\">'</span><span class=\"p\">];</span>    <span class=\"kd\">function</span> <span class=\"nx\">TodoService</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kd\">var</span> <span class=\"nx\">that</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">;</span>        <span class=\"nx\">that</span><span class=\"p\">.</span><span class=\"nx\">todos</span> <span class=\"o\">=</span> <span class=\"p\">[</span>            <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">First Todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">}</span>        <span class=\"p\">];</span>        <span class=\"k\">return</span> <span class=\"p\">{</span>            <span class=\"na\">getAll</span> <span class=\"p\">:</span> <span class=\"nx\">getAll</span><span class=\"p\">,</span>            <span class=\"na\">add</span><span class=\"p\">:</span> <span class=\"nx\">add</span><span class=\"p\">,</span>            <span class=\"na\">clearCompleted</span><span class=\"p\">:</span> <span class=\"nx\">clearCompleted</span>        <span class=\"p\">};</span>        <span class=\"kd\">function</span> <span class=\"nx\">getAll</span><span class=\"p\">(){</span>            <span class=\"k\">return</span> <span class=\"nx\">that</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">;</span>        <span class=\"p\">}</span>        <span class=\"kd\">function</span> <span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"nx\">newTodo</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"nx\">that</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">unshift</span><span class=\"p\">({</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">newTodo</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">});</span>            <span class=\"k\">return</span> <span class=\"nx\">that</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">;</span>        <span class=\"p\">}</span>        <span class=\"kd\">function</span> <span class=\"nx\">clearCompleted</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">that</span><span class=\"p\">.</span><span class=\"nx\">todos</span> <span class=\"o\">=</span> <span class=\"nx\">that</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">filter</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">todo</span><span class=\"p\">)</span> <span class=\"p\">{</span>                <span class=\"k\">return</span> <span class=\"o\">!</span><span class=\"nx\">todo</span><span class=\"p\">.</span><span class=\"nx\">done</span><span class=\"p\">;</span>            <span class=\"p\">});</span>            <span class=\"k\">return</span> <span class=\"nx\">that</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">;</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span>    <span class=\"kd\">function</span> <span class=\"nx\">TodoController</span><span class=\"p\">(</span><span class=\"nx\">$scope</span><span class=\"p\">,</span> <span class=\"nx\">TodoService</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span> <span class=\"o\">=</span> <span class=\"nx\">TodoService</span><span class=\"p\">.</span><span class=\"nx\">getAll</span><span class=\"p\">();</span>        <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">add</span> <span class=\"o\">=</span> <span class=\"nx\">add</span><span class=\"p\">;</span>        <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">clearCompleted</span> <span class=\"o\">=</span> <span class=\"nx\">clearCompleted</span><span class=\"p\">;</span>        <span class=\"c1\">//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>        <span class=\"kd\">function</span> <span class=\"nx\">add</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span> <span class=\"o\">=</span> <span class=\"nx\">TodoService</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">newTodo</span><span class=\"p\">);</span>            <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">newTodo</span> <span class=\"o\">=</span> <span class=\"dl\">\"\"</span><span class=\"p\">;</span>        <span class=\"p\">}</span>        <span class=\"kd\">function</span> <span class=\"nx\">clearCompleted</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span> <span class=\"o\">=</span> <span class=\"nx\">TodoService</span><span class=\"p\">.</span><span class=\"nx\">clearCompleted</span><span class=\"p\">();</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">})(</span><span class=\"nx\">angular</span><span class=\"p\">);</span></code></pre></div></div><p>Since we will be unit testing controller we will need the <strong>mocked</strong> <code class=\"language-plaintext highlighter-rouge\">TodoService</code>. We can create mocked <code class=\"language-plaintext highlighter-rouge\">TodoService</code> using 3 ways</p><ol>  <li>Using <code class=\"language-plaintext highlighter-rouge\">angular.mock.module(&lt;passing object&gt;)</code></li>  <li>Using <code class=\"language-plaintext highlighter-rouge\">angular.mock.module(&lt;passing function&gt;)</code></li>  <li>Creating <code class=\"language-plaintext highlighter-rouge\">simple object</code> and passing it when we initialize controller</li></ol><p>Before we start these 3 topic let’s write some test</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"kd\">var</span> <span class=\"nx\">$controller</span><span class=\"p\">;</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$controller_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$controller</span> <span class=\"o\">=</span> <span class=\"nx\">_$controller_</span><span class=\"p\">;</span>    <span class=\"p\">}));</span>    <span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">When initialized</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Then $scope.todos must have default todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"kd\">var</span> <span class=\"nx\">scope</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>            <span class=\"nx\">$controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">scope</span><span class=\"p\">});</span>            <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>        <span class=\"p\">});</span>    <span class=\"p\">});</span><span class=\"p\">});</span></code></pre></div></div><p>If you run above test it will run fine. We didn’t mock the <code class=\"language-plaintext highlighter-rouge\">TodoService</code> and we didn’t passed <code class=\"language-plaintext highlighter-rouge\">TodoServie</code> so how is this test working.This example shows the <code class=\"language-plaintext highlighter-rouge\">angular injector</code> in action. Here <code class=\"language-plaintext highlighter-rouge\">injector</code> acts as <strong>Service locator</strong>.</p><p>If we want to get hold of <code class=\"language-plaintext highlighter-rouge\">TodoService</code> we can use <code class=\"language-plaintext highlighter-rouge\">angular.mock.inject(..)</code> which acts as wrapper for angular injector</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Directly calling Service</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"kd\">var</span> <span class=\"nx\">TodoService</span><span class=\"p\">;</span>            <span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_TodoService_</span><span class=\"p\">){</span>                <span class=\"nx\">TodoService</span> <span class=\"o\">=</span> <span class=\"nx\">_TodoService_</span><span class=\"p\">;</span>            <span class=\"p\">});</span>            <span class=\"kd\">var</span> <span class=\"nx\">length</span> <span class=\"o\">=</span> <span class=\"nx\">TodoService</span><span class=\"p\">.</span><span class=\"nx\">getAll</span><span class=\"p\">().</span><span class=\"nx\">length</span><span class=\"p\">;</span>            <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">length</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>        <span class=\"p\">});</span></code></pre></div></div><p>Now that we know how angular <code class=\"language-plaintext highlighter-rouge\">injector</code> helps to locate our service, let’s look at how we can mock the service classes. Note:above example calles the real service methods.</p><h3 id=\"lets-mock-services-using-angularmockmodule-by-passing-object\">Let’s mock services using <code class=\"language-plaintext highlighter-rouge\">angular.mock.module(...)</code> by passing object</h3><p>Here’s a updated test</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"kd\">var</span> <span class=\"nx\">$controller</span><span class=\"p\">;</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span>    <span class=\"c1\">// Mocking TodoService</span>    <span class=\"c1\">// Using angular.mock.module(object);</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kd\">var</span> <span class=\"nx\">todo</span> <span class=\"o\">=</span> <span class=\"p\">[</span>            <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Test Todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">},</span>            <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Test Todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">}</span>        <span class=\"p\">];</span>        <span class=\"kd\">var</span> <span class=\"nx\">TodoService</span> <span class=\"o\">=</span> <span class=\"p\">{</span>            <span class=\"na\">todos</span><span class=\"p\">:</span> <span class=\"nx\">todo</span><span class=\"p\">,</span>            <span class=\"na\">getAll</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>                <span class=\"k\">return</span> <span class=\"nx\">todo</span><span class=\"p\">;</span>            <span class=\"p\">},</span>            <span class=\"na\">add</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"p\">},</span>            <span class=\"na\">clearCompleted</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"p\">}</span>        <span class=\"p\">};</span>        <span class=\"kd\">var</span> <span class=\"nx\">objectToBePassed</span> <span class=\"o\">=</span> <span class=\"p\">{</span>            <span class=\"dl\">'</span><span class=\"s1\">TodoService</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">TodoService</span>        <span class=\"p\">};</span>        <span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"nx\">objectToBePassed</span><span class=\"p\">);</span>    <span class=\"p\">});</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$controller_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$controller</span> <span class=\"o\">=</span> <span class=\"nx\">_$controller_</span><span class=\"p\">;</span>    <span class=\"p\">}));</span>    <span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">When initialized</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Then $scope.todos must have default todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"kd\">var</span> <span class=\"nx\">scope</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>            <span class=\"nx\">$controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">scope</span><span class=\"p\">});</span>            <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span>        <span class=\"p\">});</span>    <span class=\"p\">});</span><span class=\"p\">});</span></code></pre></div></div><p>In above example we are passing <code class=\"language-plaintext highlighter-rouge\">object</code> to <code class=\"language-plaintext highlighter-rouge\">angular.module.module(...)</code>.Object that we passed to <code class=\"language-plaintext highlighter-rouge\">angular.mock.module(...)</code> have key that matches service name that we want to mock.In our case its <code class=\"language-plaintext highlighter-rouge\">TodoService</code>.To prove we are using mocked service we increased the default size of todo to 2. If you look at our <code class=\"language-plaintext highlighter-rouge\">expectation</code> we areasserting length of todos to be 2 instead to 1 to match with mocked service.</p><h3 id=\"using-angularmockmodule-by-passing-function-to-mock-service\">Using <code class=\"language-plaintext highlighter-rouge\">angular.mock.module(...) by passing function to mock service</code></h3><p>Example</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"kd\">var</span> <span class=\"nx\">$controller</span><span class=\"p\">;</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span>    <span class=\"c1\">// Mocking TodoService</span>    <span class=\"c1\">// Using angular.mock.module(function);</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kd\">var</span> <span class=\"nx\">functionToBePassed</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">$provide</span><span class=\"p\">){</span>            <span class=\"kd\">var</span> <span class=\"nx\">todo</span> <span class=\"o\">=</span> <span class=\"p\">[</span>                <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Test Todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">},</span>                <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Test Todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">}</span>            <span class=\"p\">];</span>            <span class=\"kd\">var</span> <span class=\"nx\">TodoService</span> <span class=\"o\">=</span> <span class=\"p\">{</span>                <span class=\"na\">todos</span><span class=\"p\">:</span> <span class=\"nx\">todo</span><span class=\"p\">,</span>                <span class=\"na\">getAll</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>                    <span class=\"k\">return</span> <span class=\"nx\">todo</span><span class=\"p\">;</span>                <span class=\"p\">},</span>                <span class=\"na\">add</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>                <span class=\"p\">},</span>                <span class=\"na\">clearCompleted</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>                <span class=\"p\">}</span>            <span class=\"p\">};</span>            <span class=\"nx\">$provide</span><span class=\"p\">.</span><span class=\"nx\">service</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoService</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>                <span class=\"k\">return</span> <span class=\"nx\">TodoService</span><span class=\"p\">;</span>            <span class=\"p\">});</span>        <span class=\"p\">};</span>        <span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"nx\">functionToBePassed</span><span class=\"p\">);</span>    <span class=\"p\">});</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$controller_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$controller</span> <span class=\"o\">=</span> <span class=\"nx\">_$controller_</span><span class=\"p\">;</span>    <span class=\"p\">}));</span>    <span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">When initialized</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Then $scope.todos must have default todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"kd\">var</span> <span class=\"nx\">scope</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>            <span class=\"nx\">$controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">scope</span><span class=\"p\">});</span>            <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span>        <span class=\"p\">});</span>    <span class=\"p\">});</span><span class=\"p\">});</span></code></pre></div></div><p>In above example we are using <code class=\"language-plaintext highlighter-rouge\">angular.mock.module(...)</code> and passing function. One important thing to note here is that when we passfunction in <code class=\"language-plaintext highlighter-rouge\">angular.mock.module(...)</code> we need to get reference of <code class=\"language-plaintext highlighter-rouge\">$provide</code>. We will use <code class=\"language-plaintext highlighter-rouge\">$provide</code> to mock the services.To mock service we use <code class=\"language-plaintext highlighter-rouge\">$provide.service(serviceName, serviceFunction)</code>.</p><h3 id=\"lets-look-how-we-can-mock-with-simple-object\">Let’s look how we can mock with simple object</h3><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"kd\">var</span> <span class=\"nx\">$controller</span><span class=\"p\">;</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$controller_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$controller</span> <span class=\"o\">=</span> <span class=\"nx\">_$controller_</span><span class=\"p\">;</span>    <span class=\"p\">}));</span>    <span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">When initialized</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Then $scope.todos must have default todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"kd\">var</span> <span class=\"nx\">scope</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>            <span class=\"kd\">var</span> <span class=\"nx\">todo</span> <span class=\"o\">=</span> <span class=\"p\">[</span>                <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Test Todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">},</span>                <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">Test Todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">}</span>            <span class=\"p\">];</span>            <span class=\"c1\">// Using simple Object only</span>            <span class=\"kd\">var</span> <span class=\"nx\">TodoService</span> <span class=\"o\">=</span> <span class=\"p\">{</span>                <span class=\"na\">todos</span><span class=\"p\">:</span> <span class=\"nx\">todo</span><span class=\"p\">,</span>                <span class=\"na\">getAll</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>                    <span class=\"k\">return</span> <span class=\"nx\">todo</span><span class=\"p\">;</span>                <span class=\"p\">},</span>                <span class=\"na\">add</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>                <span class=\"p\">},</span>                <span class=\"na\">clearCompleted</span><span class=\"p\">:</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>                <span class=\"p\">}</span>            <span class=\"p\">};</span>            <span class=\"c1\">// Passing TodoService when initialize controller</span>            <span class=\"nx\">$controller</span><span class=\"p\">(</span>                <span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span>                <span class=\"p\">{</span>                    <span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">scope</span><span class=\"p\">,</span>                    <span class=\"na\">TodoService</span><span class=\"p\">:</span> <span class=\"nx\">TodoService</span>                <span class=\"p\">}</span>            <span class=\"p\">);</span>            <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span>        <span class=\"p\">});</span>    <span class=\"p\">});</span><span class=\"p\">});</span></code></pre></div></div><p>Above example is very simple and I don’t think it needs any explanation. In next post we will se how we can spy object using <code class=\"language-plaintext highlighter-rouge\">spyOn</code>and change the behaviour of spied function.</p>",
            "url": "https://babal.dev/2016/12/24/angular-testing-controller-with-dependency",
            
            
            
            "tags": ["javascript","angular"],
            
            "date_published": "2016-12-24T00:00:00-05:00",
            "date_modified": "2016-12-24T00:00:00-05:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/11/30/angular-testing-controller",
            "title": "Testing Controller in AngularJS",
            "summary": "In this article I'll show you how we can test AngularJS Controller which doesn't have any dependencies",
            "content_text": "In Part 1 Part 2 and Part 3 of this article we didn’t talk a lot about testing. Those 3 parts were more focused on configuration required to do testing.In this article I’ll show you how we can test simple AngularJS Controllers.Here’s the folder structure that we are going to use.Here are content of those file if you want to follow alongWe are going to write our test on TodoControllerSpec.js. Before writing the test let’s look at todo.controller.js(function(angular) {    'use strict';    angular        .module('app')        .controller('TodoController', TodoController);    TodoController.$inject = ['$scope'];    function TodoController($scope) {        $scope.todos = [            {'title': 'First Todo', 'done': false}        ];        $scope.add = add;        $scope.clearCompleted = clearCompleted;        //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~        function add() {            $scope.todos.unshift({'title': $scope.newTodo, 'done': false});            $scope.newTodo = \"\";        }        function clearCompleted() {            $scope.todos = $scope.todos.filter(function(todo) {                return !todo.done;            });        }    }})(angular);If you look at above code snippet carefully you can see that the controller has convenience method to add() and clearCompleted() to add the Todo and Clear the completed Todo.Since we are going to write the unit test we can ignore the HTML file and focus on business logic.Open TodoControllerSpec.js and create the suite by using describe(). Here’s the full content of TodoControllerSpec.js if you want to peek at it.describe('Test for TodoController', function(){});Now we need to initialize the module we can do that by using module function.describe('Test for TodoController', function(){    beforeEach(angular.mock.module('app'));});Now that module is loaded we need to resolve reference of $controller service we can do that by using inject()describe('Test for TodoController', function(){    beforeEach(angular.mock.module('app'));    var $controller;    beforeEach(angular.mock.inject(function(_$controller_) {        $controller = _$controller_;    }));});Now we have reference of $controller service which can be used to get initialize our TodoController.First of all let’s create the inner suite to test the add() functionality of our controller.describe('Test for TodoController', function(){    beforeEach(angular.mock.module('app'));    var $controller;    beforeEach(angular.mock.inject(function(_$controller_) {        $controller = _$controller_;    }));    describe('Test add functionality of Controller',function(){    });});Inside of new suite we will write some unit test using it(). On each on every test we need our TodoController so this is a good candidate for using beforeEach(). Let’s initialize TodoController.describe('Test add functionality of Controller', function() {        var controller;        var scope;        beforeEach(function() {            scope = {};            controller = $controller('TodoController', {                $scope: scope            });        });});To initialize the TodoController we use $controller service. First argument $controller accepts is the controller name.Second arguments on the curly braces are the dependencies that the controller has. I know I told you that we will be testing the controller that doesn’t have any dependencies. But relax it is just $scope.We are ready to write some unit tests. If you looked at the code you will see that we have default todo. So when our app starts there must be atleast one todo in the list. Let’s check that with some expectation.describe('Test add functionality of Controller', function() {        var controller;        var scope;        beforeEach(function() {            scope = {};            controller = $controller('TodoController', {                $scope: scope            });        });        it('Should have 1 todo at first', function() {            expect(scope.todos.length).toEqual(1);        });    });In above test we are expecting that there must be exactly 1 todo on the scope.Let’s add some more test for add behaviour.it('Should add new Todo when click go', function() {    scope.newTodo = \"Second Todo\";    scope.add();    expect(scope.todos.length).toEqual(2);});it('Should add new todo at top of list', function() {    scope.newTodo = \"Second Todo\";    scope.add();    var addedTodo = scope.todos[0];    expect(addedTodo.title).toBe('Second Todo');    expect(addedTodo.done).toBe(false);});it('Should Clear scope.newTodo after add()', function() {    scope.newTodo = \"Second Todo\";    scope.add();    expect(scope.newTodo).toBe(\"\");});The first test adds the new todo and checks the length of todos and see if its incremented by 1 i.e 2 for us.Second one also adds the new todo but it checks to see if todo is added in top. Since we are using unshift it should add todo on top of the list.Third one simply checks if newTodo properties is cleared after todo was added.Like wise you can create the test to check the behaviour of clearCompleted. Here’s how I wrote the testdescribe('Test should clear completed todos', function() {        var controller;        var scope;        beforeEach(function() {            scope = {};            scope.todos = [                {                    'title': \"One\",                    'done': false                }, {                    'title': \"Two\",                    'done': true                }, {                    'title': \"Three\",                    'done': true                }            ];            controller = $controller('TodoController', {                $scope: scope            });        });        it('Should clear completed todos', function() {            scope.clearCompleted();            expect(scope.todos.length).toBe(1);        });        it('Should clear completed todos', function() {            scope.clearCompleted();            var remainingItem = scope.todos;            remainingItem.forEach(function(item) {                expect(item.done).toBe(false);            });        });    });To run the test you can use gulp test. You can see the result on terminal.In this post you got familier with basic unit testing capabilities for an angular controller. We will see some more advance angular testing using mock services in next part of this series. Until we meet again. GOOD BYE !!",
            "content_html": "<p>In <a href=\"https://amantuladhar.github.io/blog/2016-11-23-unit-testing-angular-1-part-1/\">Part 1</a> <a href=\"https://atuladhar-aman.github.io/blog/2016-11-24-integrate-karma-with-jasmine/\">Part 2</a> and <a href=\"https://atuladhar-aman.github.io/blog/2016-11-25-using-gulp-to-run-karma/\">Part 3</a> of this article we didn’t talk a lot about testing. Those 3 parts were more focused on <strong>configuration</strong> required to do testing.</p><p>In this article I’ll show you how we can test simple AngularJS <strong><code class=\"language-plaintext highlighter-rouge\">Controllers</code></strong>.</p><p>Here’s the folder structure that we are going to use.</p><p><img src=\"/assets/blog/2016-11-30-angular-testing-simple-controller/angular-app-structure.png\" width=\"40%\" style=\"padding-left: 20%\" /></p><p><a href=\"https://gist.github.com/atuladhar-aman/47a2ad4f53cba8977be3943ec883c3ff\">Here are content of those file if you want to follow along</a></p><p>We are going to write our test on <code class=\"language-plaintext highlighter-rouge\">TodoControllerSpec.js</code>. Before writing the test let’s look at <code class=\"language-plaintext highlighter-rouge\">todo.controller.js</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">angular</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"dl\">'</span><span class=\"s1\">use strict</span><span class=\"dl\">'</span><span class=\"p\">;</span>    <span class=\"nx\">angular</span>        <span class=\"p\">.</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">)</span>        <span class=\"p\">.</span><span class=\"nx\">controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"nx\">TodoController</span><span class=\"p\">);</span>    <span class=\"nx\">TodoController</span><span class=\"p\">.</span><span class=\"nx\">$inject</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">$scope</span><span class=\"dl\">'</span><span class=\"p\">];</span>    <span class=\"kd\">function</span> <span class=\"nx\">TodoController</span><span class=\"p\">(</span><span class=\"nx\">$scope</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span> <span class=\"o\">=</span> <span class=\"p\">[</span>            <span class=\"p\">{</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">First Todo</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">}</span>        <span class=\"p\">];</span>        <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">add</span> <span class=\"o\">=</span> <span class=\"nx\">add</span><span class=\"p\">;</span>        <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">clearCompleted</span> <span class=\"o\">=</span> <span class=\"nx\">clearCompleted</span><span class=\"p\">;</span>        <span class=\"c1\">//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>        <span class=\"kd\">function</span> <span class=\"nx\">add</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">unshift</span><span class=\"p\">({</span><span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">newTodo</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">});</span>            <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">newTodo</span> <span class=\"o\">=</span> <span class=\"dl\">\"\"</span><span class=\"p\">;</span>        <span class=\"p\">}</span>        <span class=\"kd\">function</span> <span class=\"nx\">clearCompleted</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span> <span class=\"o\">=</span> <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">filter</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">todo</span><span class=\"p\">)</span> <span class=\"p\">{</span>                <span class=\"k\">return</span> <span class=\"o\">!</span><span class=\"nx\">todo</span><span class=\"p\">.</span><span class=\"nx\">done</span><span class=\"p\">;</span>            <span class=\"p\">});</span>        <span class=\"p\">}</span>    <span class=\"p\">}</span><span class=\"p\">})(</span><span class=\"nx\">angular</span><span class=\"p\">);</span></code></pre></div></div><p>If you look at above code snippet carefully you can see that the controller has convenience method to <code class=\"language-plaintext highlighter-rouge\">add()</code> and <code class=\"language-plaintext highlighter-rouge\">clearCompleted()</code> to add the Todo and Clear the completed Todo.</p><p>Since we are going to write the <code class=\"language-plaintext highlighter-rouge\">unit test</code> we can ignore the <strong>HTML</strong> file and focus on business logic.</p><p>Open <code class=\"language-plaintext highlighter-rouge\">TodoControllerSpec.js</code> and create the suite by using <code class=\"language-plaintext highlighter-rouge\">describe()</code>. <a href=\"https://gist.github.com/atuladhar-aman/75b77a45b42666b963a654b27cc6b686\">Here’s the full content</a> of <code class=\"language-plaintext highlighter-rouge\">TodoControllerSpec.js</code> if you want to peek at it.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Test for TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span><span class=\"p\">});</span></code></pre></div></div><p>Now we need to initialize the <code class=\"language-plaintext highlighter-rouge\">module</code> we can do that by using <code class=\"language-plaintext highlighter-rouge\">module</code> function.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Test for TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">angular</span><span class=\"p\">.</span><span class=\"nx\">mock</span><span class=\"p\">.</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span><span class=\"p\">});</span></code></pre></div></div><p>Now that module is loaded we need to resolve reference of <code class=\"language-plaintext highlighter-rouge\">$controller</code> service we can do that by using <code class=\"language-plaintext highlighter-rouge\">inject()</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Test for TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">angular</span><span class=\"p\">.</span><span class=\"nx\">mock</span><span class=\"p\">.</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span>    <span class=\"kd\">var</span> <span class=\"nx\">$controller</span><span class=\"p\">;</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">angular</span><span class=\"p\">.</span><span class=\"nx\">mock</span><span class=\"p\">.</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$controller_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$controller</span> <span class=\"o\">=</span> <span class=\"nx\">_$controller_</span><span class=\"p\">;</span>    <span class=\"p\">}));</span><span class=\"p\">});</span></code></pre></div></div><p>Now we have reference of <code class=\"language-plaintext highlighter-rouge\">$controller</code> service which can be used to get initialize our <code class=\"language-plaintext highlighter-rouge\">TodoController</code>.</p><p>First of all let’s create the inner suite to test the <code class=\"language-plaintext highlighter-rouge\">add()</code> functionality of our controller.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Test for TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">angular</span><span class=\"p\">.</span><span class=\"nx\">mock</span><span class=\"p\">.</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span>    <span class=\"kd\">var</span> <span class=\"nx\">$controller</span><span class=\"p\">;</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">angular</span><span class=\"p\">.</span><span class=\"nx\">mock</span><span class=\"p\">.</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">_$controller_</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$controller</span> <span class=\"o\">=</span> <span class=\"nx\">_$controller_</span><span class=\"p\">;</span>    <span class=\"p\">}));</span>    <span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Test add functionality of Controller</span><span class=\"dl\">'</span><span class=\"p\">,</span><span class=\"kd\">function</span><span class=\"p\">(){</span>    <span class=\"p\">});</span><span class=\"p\">});</span></code></pre></div></div><p>Inside of new suite we will write some unit test using <code class=\"language-plaintext highlighter-rouge\">it()</code>. On each on every test we need our <code class=\"language-plaintext highlighter-rouge\">TodoController</code> so this is a good candidate for using <code class=\"language-plaintext highlighter-rouge\">beforeEach()</code>. Let’s initialize <code class=\"language-plaintext highlighter-rouge\">TodoController</code>.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Test add functionality of Controller</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kd\">var</span> <span class=\"nx\">controller</span><span class=\"p\">;</span>        <span class=\"kd\">var</span> <span class=\"nx\">scope</span><span class=\"p\">;</span>        <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">scope</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>            <span class=\"nx\">controller</span> <span class=\"o\">=</span> <span class=\"nx\">$controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">{</span>                <span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">scope</span>            <span class=\"p\">});</span>        <span class=\"p\">});</span><span class=\"p\">});</span></code></pre></div></div><p>To initialize the <code class=\"language-plaintext highlighter-rouge\">TodoController</code> we use <code class=\"language-plaintext highlighter-rouge\">$controller</code> service. First argument <code class=\"language-plaintext highlighter-rouge\">$controller</code> accepts is the controller name.</p><p>Second arguments on the curly braces are the dependencies that the controller has. I know I told you that we will be testing the controller that doesn’t have any dependencies. But relax it is just <code class=\"language-plaintext highlighter-rouge\">$scope</code>.</p><p>We are ready to write some unit tests. If you looked at the code you will see that we have default todo. So when our app starts there must be atleast one todo in the list. Let’s check that with some expectation.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Test add functionality of Controller</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kd\">var</span> <span class=\"nx\">controller</span><span class=\"p\">;</span>        <span class=\"kd\">var</span> <span class=\"nx\">scope</span><span class=\"p\">;</span>        <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">scope</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>            <span class=\"nx\">controller</span> <span class=\"o\">=</span> <span class=\"nx\">$controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">{</span>                <span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">scope</span>            <span class=\"p\">});</span>        <span class=\"p\">});</span>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Should have 1 todo at first</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>        <span class=\"p\">});</span>    <span class=\"p\">});</span></code></pre></div></div><p>In above test we are expecting that there must be exactly 1 todo on the <code class=\"language-plaintext highlighter-rouge\">scope</code>.</p><p>Let’s add some more test for <code class=\"language-plaintext highlighter-rouge\">add</code> behaviour.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Should add new Todo when click go</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">newTodo</span> <span class=\"o\">=</span> <span class=\"dl\">\"</span><span class=\"s2\">Second Todo</span><span class=\"dl\">\"</span><span class=\"p\">;</span>    <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">();</span>    <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span><span class=\"p\">});</span><span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Should add new todo at top of list</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">newTodo</span> <span class=\"o\">=</span> <span class=\"dl\">\"</span><span class=\"s2\">Second Todo</span><span class=\"dl\">\"</span><span class=\"p\">;</span>    <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">();</span>    <span class=\"kd\">var</span> <span class=\"nx\">addedTodo</span> <span class=\"o\">=</span> <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">];</span>    <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">addedTodo</span><span class=\"p\">.</span><span class=\"nx\">title</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Second Todo</span><span class=\"dl\">'</span><span class=\"p\">);</span>    <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">addedTodo</span><span class=\"p\">.</span><span class=\"nx\">done</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"kc\">false</span><span class=\"p\">);</span><span class=\"p\">});</span><span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Should Clear scope.newTodo after add()</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">newTodo</span> <span class=\"o\">=</span> <span class=\"dl\">\"</span><span class=\"s2\">Second Todo</span><span class=\"dl\">\"</span><span class=\"p\">;</span>    <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">();</span>    <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">newTodo</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"dl\">\"\"</span><span class=\"p\">);</span><span class=\"p\">});</span></code></pre></div></div><p>The first test adds the new todo and checks the length of todos and see if its incremented by 1 i.e 2 for us.</p><p>Second one also adds the new todo but it checks to see if todo is added in top. Since we are using <code class=\"language-plaintext highlighter-rouge\">unshift</code> it should add todo on top of the list.</p><p>Third one simply checks if <code class=\"language-plaintext highlighter-rouge\">newTodo</code> properties is cleared after todo was added.</p><p>Like wise you can create the test to check the behaviour of <code class=\"language-plaintext highlighter-rouge\">clearCompleted</code>. Here’s how I wrote the test</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Test should clear completed todos</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"kd\">var</span> <span class=\"nx\">controller</span><span class=\"p\">;</span>        <span class=\"kd\">var</span> <span class=\"nx\">scope</span><span class=\"p\">;</span>        <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">scope</span> <span class=\"o\">=</span> <span class=\"p\">{};</span>            <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span> <span class=\"o\">=</span> <span class=\"p\">[</span>                <span class=\"p\">{</span>                    <span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">One</span><span class=\"dl\">\"</span><span class=\"p\">,</span>                    <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">false</span>                <span class=\"p\">},</span> <span class=\"p\">{</span>                    <span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">Two</span><span class=\"dl\">\"</span><span class=\"p\">,</span>                    <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">true</span>                <span class=\"p\">},</span> <span class=\"p\">{</span>                    <span class=\"dl\">'</span><span class=\"s1\">title</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">Three</span><span class=\"dl\">\"</span><span class=\"p\">,</span>                    <span class=\"dl\">'</span><span class=\"s1\">done</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"kc\">true</span>                <span class=\"p\">}</span>            <span class=\"p\">];</span>            <span class=\"nx\">controller</span> <span class=\"o\">=</span> <span class=\"nx\">$controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">TodoController</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">{</span>                <span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">scope</span>            <span class=\"p\">});</span>        <span class=\"p\">});</span>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Should clear completed todos</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">clearCompleted</span><span class=\"p\">();</span>            <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>        <span class=\"p\">});</span>        <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Should clear completed todos</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>            <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">clearCompleted</span><span class=\"p\">();</span>            <span class=\"kd\">var</span> <span class=\"nx\">remainingItem</span> <span class=\"o\">=</span> <span class=\"nx\">scope</span><span class=\"p\">.</span><span class=\"nx\">todos</span><span class=\"p\">;</span>            <span class=\"nx\">remainingItem</span><span class=\"p\">.</span><span class=\"nx\">forEach</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">item</span><span class=\"p\">)</span> <span class=\"p\">{</span>                <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">item</span><span class=\"p\">.</span><span class=\"nx\">done</span><span class=\"p\">).</span><span class=\"nx\">toBe</span><span class=\"p\">(</span><span class=\"kc\">false</span><span class=\"p\">);</span>            <span class=\"p\">});</span>        <span class=\"p\">});</span>    <span class=\"p\">});</span></code></pre></div></div><p>To run the test you can use <code class=\"language-plaintext highlighter-rouge\">gulp test</code>. You can see the result on terminal.</p><p>In this post you got familier with basic unit testing capabilities for an angular controller. We will see some more advance angular testing using mock services in next part of this series. Until we meet again. GOOD BYE !!</p>",
            "url": "https://babal.dev/2016/11/30/angular-testing-controller",
            
            
            
            "tags": ["javascript","angular"],
            
            "date_published": "2016-11-30T00:00:00-05:00",
            "date_modified": "2016-11-30T00:00:00-05:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/11/25/using-gulp-to-run-karma",
            "title": "Using Gulp to Start Karma",
            "summary": "Automate the test using GulpJS in headless browser",
            "content_text": "In this article we will use Gulp to run our Specs. Gulp is a stream-based build system with a simple yet powerful API focusing on code over configuration. Gulp builds use the Node.js streams that do not need to write temporary files or folders to disk, which results in faster builds.Gulp is very easy to learn ( than Grunt - opinionated view) but I won’t be covering basics of Gulp in this article. If you want to learn about gulp you can visit Getting Started with Gulp.  First things first let’s install Gulp globallynpm install -g gulp# sudo if needed  We also need to add Gulp in our projectnpm install --save-dev gulp  Create a gulpfile.js which is default file for Gulp configuration  Since we are using Gulp and Karma we need to add require() statement in gulpfile.jsIf you are interested where this code was copied from you can vist -&gt; Gulp-karma on GitHubvar gulp = require('gulp');var karma = require('karma');  We are also interested on using Karma Server so add following line on gulpfile.jsvar Server = karma.Server;  Now we need to create the Gulp Tasks. Let’s create a task which runs all the test once and exitsgulp.task('test', function(done) {    new Server(         {             configFile: __dirname + '/karma.conf.js',             singleRun: true         },         done     ).start();});In above snippet We are creating a gulp task named test. In the task we are creating new instance of Karma Server which we declared before.To create the new instance of Karma Server we are passing some properties. We can Override properties inside of karma.conf.js from here.  First properties we are passing is configFile which is mandatory properties we need to pass. Which basically holds the path of our Karma Configuration file.  Second properties is optional. I’m passing this properties to override the properties that exist on karma.conf.js.We are also passing done as second argument to Server. If you want to know more about done here’s the stackoverflow thread.  To run the Gulp task that you created execute following commandgulp testWhen you run above command you will see the same message that you saw earlier on Part 2 of this article. Only difference is Karma runs the test and stops to watch the more changes. This is what singleRun does.If this process is not working for you visit here which tweaks some part of this code.If you want to run the test like before where you watch for changes you can create new task like belowgulp.task('test-watch', function(done) {    new Server(        {            configFile: __dirname + '/karma.conf.js'        },        done    ).start();});gulp test-watchIf you run the task you will see same kind of behaviour that you saw previously. Since we are not passing any properties to Override it loads the properties from karma.conf.js.We are running our test on Chrome which pop ups on every run of the test. If we want we can use headless broswer i.e PhantomJSTo use PhantomJS we need karma-phantomjs-launcher plugin  To install karma-phantomjs-launchernpm install --save-dev karma-phantomjs-launcher  Change the broswer on karma.conf.js to PhantomJS        browsers: ['PhantomJS']Or if you want to you can pass the properties on gulp task too.gulp.task('phantom', function(done) {    new Server(        {            configFile: __dirname + '/karma.conf.js',            browsers: ['PhantomJS']        },        done    ).start();});  To run the new task you can executegulp phantomI’ll end this article by adding the default Gulp task which can be done by adding the following line on gulpfile.jsgulp.task('default', ['test-watch'])So when you just type gulp on termial you will run test-watch by default.This is what my package.json looks like{  \"name\": \"angular-testing\",  \"version\": \"1.0.0\",  \"description\": \"Simple Application to learn the how we can unit test AngularJS application\",  \"main\": \"\",  \"directories\": {    \"test\": \"test\"  },  \"dependencies\": {    \"angular\": \"^1.5.8\",    \"angular-mocks\": \"^1.5.8\"  },  \"devDependencies\": {    \"gulp\": \"^3.9.1\",    \"jasmine-core\": \"^2.5.2\",    \"karma\": \"^1.3.0\",    \"karma-chrome-launcher\": \"^2.0.0\",    \"karma-jasmine\": \"^1.0.2\",    \"karma-phantomjs-launcher\": \"^1.0.2\"  },  \"scripts\": {},  \"author\": \"Aman Tuladhar\"}and gulpfile.jsvar gulp = require('gulp');var karma = require('karma');var Server = karma.Server;/** * Run test once and exit */gulp.task('test', function(done) {    new Server(        {            configFile: __dirname + '/karma.conf.js',            singleRun: true        },        done    ).start();});/** * Watch for file changes and re-run tests on each change */gulp.task('test-watch', function(done) {    new Server(        {            configFile: __dirname + '/karma.conf.js'        },        done    ).start();});gulp.task('chrome', function(done) {    new Server(        {            configFile: __dirname + '/karma.conf.js',            browsers: ['Chrome'],            singleRun: true        },        done    ).start();});gulp.task('default', ['test-watch']);and karma.conf.js// Karma configurationmodule.exports = function(config) {    config.set({        basePath: '',        port: 9876,        frameworks: ['jasmine'],        autoWatch: true,        browsers: ['PhantomJS'],        singleRun: false,        files: [            'node_modules/angular/angular.min.js',            'node_modules/angular-mocks/angular-mocks.js',            'src/**/*.js',            'test/**/*Spec.js'        ],        exclude: [],        logLevel: config.LOG_INFO,        preprocessors: {},        reporters: ['progress'],        colors: true,        concurrency: Infinity    })};I’ll cover some other topics related to Angular Testing so stay tuned. THANKS",
            "content_html": "<p>In this article we will use <a href=\"http://gulpjs.com/\"><code class=\"language-plaintext highlighter-rouge\">Gulp</code></a> to run our <code class=\"language-plaintext highlighter-rouge\">Specs</code>. <code class=\"language-plaintext highlighter-rouge\">Gulp</code> is a <strong>stream-based</strong> build system with a simple yet powerful API focusing on <code class=\"language-plaintext highlighter-rouge\">code</code> <strong>over</strong> <code class=\"language-plaintext highlighter-rouge\">configuration</code>. <code class=\"language-plaintext highlighter-rouge\">Gulp</code> builds use the <code class=\"language-plaintext highlighter-rouge\">Node.js</code> streams that do not need to write temporary files or folders to disk, which results in <strong>faster builds</strong>.</p><p><code class=\"language-plaintext highlighter-rouge\">Gulp</code> is very easy to learn ( than Grunt - <em>opinionated view</em>) but I won’t be covering basics of <code class=\"language-plaintext highlighter-rouge\">Gulp</code> in this article. If you want to learn about gulp you can visit <a href=\"https://css-tricks.com/gulp-for-beginners/\">Getting Started with Gulp</a>.</p><blockquote>  <p>First things first let’s install <code class=\"language-plaintext highlighter-rouge\">Gulp</code> globally</p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>npm <span class=\"nb\">install</span> <span class=\"nt\">-g</span> gulp<span class=\"c\"># sudo if needed</span></code></pre></div></div><blockquote>  <p>We also need to add <code class=\"language-plaintext highlighter-rouge\">Gulp</code> in our project</p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>npm <span class=\"nb\">install</span> <span class=\"nt\">--save-dev</span> gulp</code></pre></div></div><blockquote>  <p>Create a <code class=\"language-plaintext highlighter-rouge\">gulpfile.js</code> which is default file for <code class=\"language-plaintext highlighter-rouge\">Gulp</code> configuration</p></blockquote><blockquote>  <p>Since we are using <code class=\"language-plaintext highlighter-rouge\">Gulp</code> and <code class=\"language-plaintext highlighter-rouge\">Karma</code> we need to add <code class=\"language-plaintext highlighter-rouge\">require()</code> statement in <code class=\"language-plaintext highlighter-rouge\">gulpfile.js</code></p></blockquote><p>If you are interested where this code was copied from you can vist -&gt; <a href=\"https://github.com/karma-runner/gulp-karma\">Gulp-karma on GitHub</a></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">gulp</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">gulp</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"kd\">var</span> <span class=\"nx\">karma</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">karma</span><span class=\"dl\">'</span><span class=\"p\">);</span></code></pre></div></div><blockquote>  <p>We are also interested on using <code class=\"language-plaintext highlighter-rouge\">Karma Server</code> so add following line on <code class=\"language-plaintext highlighter-rouge\">gulpfile.js</code></p></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">Server</span> <span class=\"o\">=</span> <span class=\"nx\">karma</span><span class=\"p\">.</span><span class=\"nx\">Server</span><span class=\"p\">;</span></code></pre></div></div><blockquote>  <p>Now we need to create the <code class=\"language-plaintext highlighter-rouge\">Gulp Tasks</code>. Let’s create a <strong>task</strong> which runs all the test once and exits</p></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">gulp</span><span class=\"p\">.</span><span class=\"nx\">task</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">test</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">done</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">new</span> <span class=\"nx\">Server</span><span class=\"p\">(</span>         <span class=\"p\">{</span>             <span class=\"na\">configFile</span><span class=\"p\">:</span> <span class=\"nx\">__dirname</span> <span class=\"o\">+</span> <span class=\"dl\">'</span><span class=\"s1\">/karma.conf.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>             <span class=\"na\">singleRun</span><span class=\"p\">:</span> <span class=\"kc\">true</span>         <span class=\"p\">},</span>         <span class=\"nx\">done</span>     <span class=\"p\">).</span><span class=\"nx\">start</span><span class=\"p\">();</span><span class=\"p\">});</span></code></pre></div></div><p>In above <em>snippet</em> We are creating a <code class=\"language-plaintext highlighter-rouge\">gulp</code> task named <em>test</em>. In the task we are creating new instance of <code class=\"language-plaintext highlighter-rouge\">Karma Server</code> which we declared before.To create the new instance of <code class=\"language-plaintext highlighter-rouge\">Karma Server</code> we are passing some <strong>properties</strong>. We can <strong>Override</strong> properties inside of <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code> from here.</p><ol>  <li>First properties we are passing is <code class=\"language-plaintext highlighter-rouge\">configFile</code> which is mandatory properties we need to pass. Which basically holds the path of our <code class=\"language-plaintext highlighter-rouge\">Karma Configuration</code> file.</li>  <li>Second properties is optional. I’m passing this properties to <strong>override</strong> the properties that exist on <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code>.</li></ol><p>We are also passing <code class=\"language-plaintext highlighter-rouge\">done</code> as second argument to <code class=\"language-plaintext highlighter-rouge\">Server</code>. If you want to know more about <code class=\"language-plaintext highlighter-rouge\">done</code> here’s the <a href=\"http://stackoverflow.com/questions/29694425/what-does-gulp-done-method-do\">stackoverflow thread</a>.</p><blockquote>  <p>To run the <code class=\"language-plaintext highlighter-rouge\">Gulp</code> task that you created execute following command</p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gulp <span class=\"nb\">test</span></code></pre></div></div><p>When you run above command you will see the same message that you saw earlier on <strong>Part 2</strong> of this article. Only difference is <code class=\"language-plaintext highlighter-rouge\">Karma</code> runs the test and stops to watch the more changes. This is what <code class=\"language-plaintext highlighter-rouge\">singleRun</code> does.If this process is not working for you visit <a href=\"http://www.bendangelo.me/javascript/2015/11/14/simple-karma-task-for-gulp.html\">here</a> which tweaks some part of this code.</p><p>If you want to run the test like before where you watch for changes you can create new task like below</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">gulp</span><span class=\"p\">.</span><span class=\"nx\">task</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">test-watch</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">done</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">new</span> <span class=\"nx\">Server</span><span class=\"p\">(</span>        <span class=\"p\">{</span>            <span class=\"na\">configFile</span><span class=\"p\">:</span> <span class=\"nx\">__dirname</span> <span class=\"o\">+</span> <span class=\"dl\">'</span><span class=\"s1\">/karma.conf.js</span><span class=\"dl\">'</span>        <span class=\"p\">},</span>        <span class=\"nx\">done</span>    <span class=\"p\">).</span><span class=\"nx\">start</span><span class=\"p\">();</span><span class=\"p\">});</span></code></pre></div></div><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gulp test-watch</code></pre></div></div><p>If you run the task you will see same kind of behaviour that you saw previously. Since we are not passing any properties to <strong>Override</strong> it loads the properties from <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code>.</p><p>We are running our test on <code class=\"language-plaintext highlighter-rouge\">Chrome</code> which pop ups on every run of the test. If we want we can use <code class=\"language-plaintext highlighter-rouge\">headless</code> broswer i.e <code class=\"language-plaintext highlighter-rouge\">PhantomJS</code></p><p>To use <code class=\"language-plaintext highlighter-rouge\">PhantomJS</code> we need <code class=\"language-plaintext highlighter-rouge\">karma-phantomjs-launcher</code> plugin</p><blockquote>  <p>To install <code class=\"language-plaintext highlighter-rouge\">karma-phantomjs-launcher</code></p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>npm <span class=\"nb\">install</span> <span class=\"nt\">--save-dev</span> karma-phantomjs-launcher</code></pre></div></div><blockquote>  <p>Change the broswer on <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code> to <code class=\"language-plaintext highlighter-rouge\">PhantomJS</code></p></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>        <span class=\"nx\">browsers</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">PhantomJS</span><span class=\"dl\">'</span><span class=\"p\">]</span></code></pre></div></div><p>Or if you want to you can pass the properties on <code class=\"language-plaintext highlighter-rouge\">gulp</code> task too.</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">gulp</span><span class=\"p\">.</span><span class=\"nx\">task</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">phantom</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">done</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">new</span> <span class=\"nx\">Server</span><span class=\"p\">(</span>        <span class=\"p\">{</span>            <span class=\"na\">configFile</span><span class=\"p\">:</span> <span class=\"nx\">__dirname</span> <span class=\"o\">+</span> <span class=\"dl\">'</span><span class=\"s1\">/karma.conf.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"na\">browsers</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">PhantomJS</span><span class=\"dl\">'</span><span class=\"p\">]</span>        <span class=\"p\">},</span>        <span class=\"nx\">done</span>    <span class=\"p\">).</span><span class=\"nx\">start</span><span class=\"p\">();</span><span class=\"p\">});</span></code></pre></div></div><blockquote>  <p>To run the new task you can execute</p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>gulp phantom</code></pre></div></div><p>I’ll end this article by adding the default <code class=\"language-plaintext highlighter-rouge\">Gulp</code> task which can be done by adding the following line on <code class=\"language-plaintext highlighter-rouge\">gulpfile.js</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">gulp</span><span class=\"p\">.</span><span class=\"nx\">task</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">default</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">test-watch</span><span class=\"dl\">'</span><span class=\"p\">])</span></code></pre></div></div><p>So when you just type <code class=\"language-plaintext highlighter-rouge\">gulp</code> on termial you will run <code class=\"language-plaintext highlighter-rouge\">test-watch</code> by default.</p><p>This is what my <code class=\"language-plaintext highlighter-rouge\">package.json</code> looks like</p><div class=\"language-json highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"p\">{</span><span class=\"w\">  </span><span class=\"nl\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"angular-testing\"</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1.0.0\"</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"nl\">\"description\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Simple Application to learn the how we can unit test AngularJS application\"</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"nl\">\"main\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\">  </span><span class=\"nl\">\"directories\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">    </span><span class=\"nl\">\"test\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"test\"</span><span class=\"w\">  </span><span class=\"p\">},</span><span class=\"w\">  </span><span class=\"nl\">\"dependencies\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">    </span><span class=\"nl\">\"angular\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^1.5.8\"</span><span class=\"p\">,</span><span class=\"w\">    </span><span class=\"nl\">\"angular-mocks\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^1.5.8\"</span><span class=\"w\">  </span><span class=\"p\">},</span><span class=\"w\">  </span><span class=\"nl\">\"devDependencies\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">    </span><span class=\"nl\">\"gulp\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^3.9.1\"</span><span class=\"p\">,</span><span class=\"w\">    </span><span class=\"nl\">\"jasmine-core\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^2.5.2\"</span><span class=\"p\">,</span><span class=\"w\">    </span><span class=\"nl\">\"karma\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^1.3.0\"</span><span class=\"p\">,</span><span class=\"w\">    </span><span class=\"nl\">\"karma-chrome-launcher\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^2.0.0\"</span><span class=\"p\">,</span><span class=\"w\">    </span><span class=\"nl\">\"karma-jasmine\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^1.0.2\"</span><span class=\"p\">,</span><span class=\"w\">    </span><span class=\"nl\">\"karma-phantomjs-launcher\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"^1.0.2\"</span><span class=\"w\">  </span><span class=\"p\">},</span><span class=\"w\">  </span><span class=\"nl\">\"scripts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{},</span><span class=\"w\">  </span><span class=\"nl\">\"author\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Aman Tuladhar\"</span><span class=\"w\"></span><span class=\"p\">}</span><span class=\"w\"></span></code></pre></div></div><p>and <code class=\"language-plaintext highlighter-rouge\">gulpfile.js</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">var</span> <span class=\"nx\">gulp</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">gulp</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"kd\">var</span> <span class=\"nx\">karma</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">karma</span><span class=\"dl\">'</span><span class=\"p\">);</span><span class=\"kd\">var</span> <span class=\"nx\">Server</span> <span class=\"o\">=</span> <span class=\"nx\">karma</span><span class=\"p\">.</span><span class=\"nx\">Server</span><span class=\"p\">;</span><span class=\"cm\">/** * Run test once and exit */</span><span class=\"nx\">gulp</span><span class=\"p\">.</span><span class=\"nx\">task</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">test</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">done</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">new</span> <span class=\"nx\">Server</span><span class=\"p\">(</span>        <span class=\"p\">{</span>            <span class=\"na\">configFile</span><span class=\"p\">:</span> <span class=\"nx\">__dirname</span> <span class=\"o\">+</span> <span class=\"dl\">'</span><span class=\"s1\">/karma.conf.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"na\">singleRun</span><span class=\"p\">:</span> <span class=\"kc\">true</span>        <span class=\"p\">},</span>        <span class=\"nx\">done</span>    <span class=\"p\">).</span><span class=\"nx\">start</span><span class=\"p\">();</span><span class=\"p\">});</span><span class=\"cm\">/** * Watch for file changes and re-run tests on each change */</span><span class=\"nx\">gulp</span><span class=\"p\">.</span><span class=\"nx\">task</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">test-watch</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">done</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">new</span> <span class=\"nx\">Server</span><span class=\"p\">(</span>        <span class=\"p\">{</span>            <span class=\"na\">configFile</span><span class=\"p\">:</span> <span class=\"nx\">__dirname</span> <span class=\"o\">+</span> <span class=\"dl\">'</span><span class=\"s1\">/karma.conf.js</span><span class=\"dl\">'</span>        <span class=\"p\">},</span>        <span class=\"nx\">done</span>    <span class=\"p\">).</span><span class=\"nx\">start</span><span class=\"p\">();</span><span class=\"p\">});</span><span class=\"nx\">gulp</span><span class=\"p\">.</span><span class=\"nx\">task</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">chrome</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">done</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"k\">new</span> <span class=\"nx\">Server</span><span class=\"p\">(</span>        <span class=\"p\">{</span>            <span class=\"na\">configFile</span><span class=\"p\">:</span> <span class=\"nx\">__dirname</span> <span class=\"o\">+</span> <span class=\"dl\">'</span><span class=\"s1\">/karma.conf.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"na\">browsers</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">Chrome</span><span class=\"dl\">'</span><span class=\"p\">],</span>            <span class=\"na\">singleRun</span><span class=\"p\">:</span> <span class=\"kc\">true</span>        <span class=\"p\">},</span>        <span class=\"nx\">done</span>    <span class=\"p\">).</span><span class=\"nx\">start</span><span class=\"p\">();</span><span class=\"p\">});</span><span class=\"nx\">gulp</span><span class=\"p\">.</span><span class=\"nx\">task</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">default</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">test-watch</span><span class=\"dl\">'</span><span class=\"p\">]);</span></code></pre></div></div><p>and <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code></p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// Karma configuration</span><span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">config</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"nx\">config</span><span class=\"p\">.</span><span class=\"kd\">set</span><span class=\"p\">({</span>        <span class=\"na\">basePath</span><span class=\"p\">:</span> <span class=\"dl\">''</span><span class=\"p\">,</span>        <span class=\"na\">port</span><span class=\"p\">:</span> <span class=\"mi\">9876</span><span class=\"p\">,</span>        <span class=\"na\">frameworks</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">jasmine</span><span class=\"dl\">'</span><span class=\"p\">],</span>        <span class=\"na\">autoWatch</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>        <span class=\"na\">browsers</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">PhantomJS</span><span class=\"dl\">'</span><span class=\"p\">],</span>        <span class=\"na\">singleRun</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>        <span class=\"na\">files</span><span class=\"p\">:</span> <span class=\"p\">[</span>            <span class=\"dl\">'</span><span class=\"s1\">node_modules/angular/angular.min.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"dl\">'</span><span class=\"s1\">node_modules/angular-mocks/angular-mocks.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"dl\">'</span><span class=\"s1\">src/**/*.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"dl\">'</span><span class=\"s1\">test/**/*Spec.js</span><span class=\"dl\">'</span>        <span class=\"p\">],</span>        <span class=\"na\">exclude</span><span class=\"p\">:</span> <span class=\"p\">[],</span>        <span class=\"na\">logLevel</span><span class=\"p\">:</span> <span class=\"nx\">config</span><span class=\"p\">.</span><span class=\"nx\">LOG_INFO</span><span class=\"p\">,</span>        <span class=\"na\">preprocessors</span><span class=\"p\">:</span> <span class=\"p\">{},</span>        <span class=\"na\">reporters</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">progress</span><span class=\"dl\">'</span><span class=\"p\">],</span>        <span class=\"na\">colors</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>        <span class=\"na\">concurrency</span><span class=\"p\">:</span> <span class=\"kc\">Infinity</span>    <span class=\"p\">})</span><span class=\"p\">};</span></code></pre></div></div><p>I’ll cover some other topics related to Angular Testing so stay tuned. <strong><code class=\"language-plaintext highlighter-rouge\">THANKS</code></strong></p>",
            "url": "https://babal.dev/2016/11/25/using-gulp-to-run-karma",
            
            
            
            "tags": ["javascript","angular"],
            
            "date_published": "2016-11-25T00:00:00-05:00",
            "date_modified": "2016-11-25T00:00:00-05:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/11/24/integrate-karma-with-jasmine",
            "title": "Integrating Karma on AngularJS Testing",
            "summary": "Let's Integrate Karma into our Application to run our unit test",
            "content_text": "In this article we will use Karma to run our Jasmine unit test that we created on Part 1 of this series. I recommend you to go through Part 1 before reading this article.Karma is the test runner for test-driven development and continuous integration. I’ll walk you throught the basic proces to install Karma. Karma executes JavaScript code in browser. With help of Karma you can test against multiple browsers, locally or on continious integration server. We can enable Karma watch feature to run unit test when application code changes. Since we are using the Jasmine to write our Specs we need Jasmine-Core and Karma Jasmine plugin. In this article we will run our Specs on Chrome browser so we need Karma Chrome launcher plugin.We will use NodeJS to install Karma  Run npm init  Install angular and angular-mocksnpm install --save angular angular-mocks  Using npm install jasmine-core, karma, karma-jasmine, karma-chrome-launchernpm install jasmine-core karma karma-jasmine karma-chrome-launcher --save-dev  Install karma-cli (with or without globally)npm install -g karma-cli# ORnpm install karma-cliWe can create the Karma Configuration file and write the content of configuration from scratch but Karma provides the option to run initialization steps.karma init# if install without global option./node_modules/.bin/karma init  Use jasmine as testing framework.  Don’t use requirejs for now.  Use chrome as testing browser.  At the prompt to define source file location, press Enter to accept the default option of an empty string.  At the prompt to define file patterns to exclude, press Enter to accept the default option of an empty string.  Enable autoWatch feature.This will generate the karma.conf.js which is default Karma configuration file.Let’s modify karma.conf.js to start testing. Karma needs access to angular.js and angular-mocks.js.Add the following line to karma.conf.js -&gt; files sectionfiles: [      'node_modules/angular/angular.min.js',      'node_modules/angular-mocks/angular-mocks.js'    ]Now we need to add our JavaScript and Specs file. To do so we can use glob pattern.  Update files section as below files: [            'node_modules/angular/angular.min.js',            'node_modules/angular-mocks/angular-mocks.js',            'src/**/*.js',            'test/**/*Spec.js'        ]Your karma.conf.js should look somewhat like below// Karma configurationmodule.exports = function(config) {    config.set({        // base path that will be used to resolve all patterns (eg. files, exclude)        basePath: '',        // frameworks to use        // available frameworks: https://npmjs.org/browse/keyword/karma-adapter        frameworks: ['jasmine'],        // list of files / patterns to load in the browser        files: [            'node_modules/angular/angular.min.js',            'node_modules/angular-mocks/angular-mocks.js',            'src/**/*.js',            'test/**/*Spec.js'        ],        // list of files to exclude        exclude: [],        // preprocess matching files before serving them to the browser        // available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor        preprocessors: {},        // test results reporter to use        // possible values: 'dots', 'progress'        // available reporters: https://npmjs.org/browse/keyword/karma-reporter        reporters: ['progress'],        // web server port        port: 9876,        // enable / disable colors in the output (reporters and logs)        colors: true,        // level of logging        // possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG        logLevel: config.LOG_INFO,        // enable / disable watching file and executing tests whenever any file changes        autoWatch: true,        // start these browsers        // available browser launchers: https://npmjs.org/browse/keyword/karma-launcher        browsers: ['Chrome'],        // Continuous Integration mode        // if true, Karma captures browsers, runs the tests and exits        singleRun: false,        // Concurrency level        // how many browser should be started simultaneous        concurrency: Infinity    })};  Run the Karma to run the testskarma start &lt;file_name&gt;If you Karma configuration file name is karma.conf.js you can use karma start which will look for default file i.e karma.conf.js. If your configutaion file name is different you can issue the command and provide the file_name.Of course if you didn’t install Karma globally you can run./node_modules/.bin/karma startWell, in this article you learned about Karma and how we can use Karma to run our unit test. I’ll cover some other topics related to Angular Testing so stay tuned.",
            "content_html": "<p>In this article we will use <code class=\"language-plaintext highlighter-rouge\">Karma</code> to run our <code class=\"language-plaintext highlighter-rouge\">Jasmine</code> unit test that we created on <a href=\"https://atuladhar-aman.github.io/blog/2016-11-23-UnitTestingAngular1Part1/\">Part 1</a> of this series. I recommend you to go through <strong>Part 1</strong> before reading this article.</p><p><a href=\"http://karma-runner.github.io/,\"><code class=\"language-plaintext highlighter-rouge\">Karma</code></a> is the test runner for test-driven development and continuous integration. I’ll walk you throught the basic proces to install <code class=\"language-plaintext highlighter-rouge\">Karma</code>. <code class=\"language-plaintext highlighter-rouge\">Karma</code> executes JavaScript code in browser. With help of <code class=\"language-plaintext highlighter-rouge\">Karma</code> you can test against multiple browsers, locally or on continious integration server. We can enable <code class=\"language-plaintext highlighter-rouge\">Karma watch</code> feature to run unit test when application code changes. Since we are using the <code class=\"language-plaintext highlighter-rouge\">Jasmine</code> to write our <code class=\"language-plaintext highlighter-rouge\">Specs</code> we need <a href=\"https://www.npmjs.com/package/jasmine-core\"><code class=\"language-plaintext highlighter-rouge\">Jasmine-Core</code></a> and <a href=\"https://github.com/karma-runner/karma-jasmine.\"><code class=\"language-plaintext highlighter-rouge\">Karma Jasmine</code></a> plugin. In this article we will run our <code class=\"language-plaintext highlighter-rouge\">Specs</code> on Chrome browser so we need <a href=\"https://github.com/karma-runner/karma-chrome-launcher\"><code class=\"language-plaintext highlighter-rouge\">Karma Chrome launcher</code></a> plugin.</p><p>We will use <a href=\"https://nodejs.org/en/\"><code class=\"language-plaintext highlighter-rouge\">NodeJS</code></a> to install <code class=\"language-plaintext highlighter-rouge\">Karma</code></p><blockquote>  <p>Run <code class=\"language-plaintext highlighter-rouge\">npm init</code></p></blockquote><blockquote>  <p>Install <code class=\"language-plaintext highlighter-rouge\">angular</code> and <code class=\"language-plaintext highlighter-rouge\">angular-mocks</code></p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>npm <span class=\"nb\">install</span> <span class=\"nt\">--save</span> angular angular-mocks</code></pre></div></div><blockquote>  <p>Using <code class=\"language-plaintext highlighter-rouge\">npm</code> install <code class=\"language-plaintext highlighter-rouge\">jasmine-core</code>, <code class=\"language-plaintext highlighter-rouge\">karma</code>, <code class=\"language-plaintext highlighter-rouge\">karma-jasmine</code>, <code class=\"language-plaintext highlighter-rouge\">karma-chrome-launcher</code></p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>npm <span class=\"nb\">install </span>jasmine-core karma karma-jasmine karma-chrome-launcher <span class=\"nt\">--save-dev</span></code></pre></div></div><blockquote>  <p>Install <code class=\"language-plaintext highlighter-rouge\">karma-cli</code> (with or without globally)</p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>npm <span class=\"nb\">install</span> <span class=\"nt\">-g</span> karma-cli<span class=\"c\"># OR</span>npm <span class=\"nb\">install </span>karma-cli</code></pre></div></div><p>We can create the <code class=\"language-plaintext highlighter-rouge\">Karma Configuration</code> file and write the content of configuration from scratch but <code class=\"language-plaintext highlighter-rouge\">Karma</code> provides the option to run initialization steps.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>karma init<span class=\"c\"># if install without global option</span>./node_modules/.bin/karma init</code></pre></div></div><ol>  <li>Use <code class=\"language-plaintext highlighter-rouge\">jasmine</code> as testing framework.</li>  <li>Don’t use <code class=\"language-plaintext highlighter-rouge\">requirejs</code> for now.</li>  <li>Use <code class=\"language-plaintext highlighter-rouge\">chrome</code> as testing browser.</li>  <li>At the prompt to define source file location, press Enter to accept the default option of an empty string.</li>  <li>At the prompt to define file patterns to exclude, press Enter to accept the default option of an empty string.</li>  <li>Enable <code class=\"language-plaintext highlighter-rouge\">autoWatch</code> feature.</li></ol><p>This will generate the <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code> which is default <code class=\"language-plaintext highlighter-rouge\">Karma</code> configuration file.</p><p>Let’s modify <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code> to start testing. <code class=\"language-plaintext highlighter-rouge\">Karma</code> needs access to <code class=\"language-plaintext highlighter-rouge\">angular.js</code> and <code class=\"language-plaintext highlighter-rouge\">angular-mocks.js</code>.Add the following line to <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code> -&gt; <code class=\"language-plaintext highlighter-rouge\">files</code> section</p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>files: [      'node_modules/angular/angular.min.js',      'node_modules/angular-mocks/angular-mocks.js'    ]</code></pre></div></div><p>Now we need to add our <code class=\"language-plaintext highlighter-rouge\">JavaScript</code> and <code class=\"language-plaintext highlighter-rouge\">Specs</code> file. To do so we can use <code class=\"language-plaintext highlighter-rouge\">glob pattern</code>.</p><blockquote>  <p>Update <code class=\"language-plaintext highlighter-rouge\">files</code> section as below</p></blockquote><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code> files: [            'node_modules/angular/angular.min.js',            'node_modules/angular-mocks/angular-mocks.js',            'src/**/*.js',            'test/**/*Spec.js'        ]</code></pre></div></div><p>Your <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code> should look somewhat like below</p><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// Karma configuration</span><span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">config</span><span class=\"p\">)</span> <span class=\"p\">{</span>    <span class=\"nx\">config</span><span class=\"p\">.</span><span class=\"kd\">set</span><span class=\"p\">({</span>        <span class=\"c1\">// base path that will be used to resolve all patterns (eg. files, exclude)</span>        <span class=\"na\">basePath</span><span class=\"p\">:</span> <span class=\"dl\">''</span><span class=\"p\">,</span>        <span class=\"c1\">// frameworks to use</span>        <span class=\"c1\">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span>        <span class=\"na\">frameworks</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">jasmine</span><span class=\"dl\">'</span><span class=\"p\">],</span>        <span class=\"c1\">// list of files / patterns to load in the browser</span>        <span class=\"na\">files</span><span class=\"p\">:</span> <span class=\"p\">[</span>            <span class=\"dl\">'</span><span class=\"s1\">node_modules/angular/angular.min.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"dl\">'</span><span class=\"s1\">node_modules/angular-mocks/angular-mocks.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"dl\">'</span><span class=\"s1\">src/**/*.js</span><span class=\"dl\">'</span><span class=\"p\">,</span>            <span class=\"dl\">'</span><span class=\"s1\">test/**/*Spec.js</span><span class=\"dl\">'</span>        <span class=\"p\">],</span>        <span class=\"c1\">// list of files to exclude</span>        <span class=\"na\">exclude</span><span class=\"p\">:</span> <span class=\"p\">[],</span>        <span class=\"c1\">// preprocess matching files before serving them to the browser</span>        <span class=\"c1\">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span>        <span class=\"na\">preprocessors</span><span class=\"p\">:</span> <span class=\"p\">{},</span>        <span class=\"c1\">// test results reporter to use</span>        <span class=\"c1\">// possible values: 'dots', 'progress'</span>        <span class=\"c1\">// available reporters: https://npmjs.org/browse/keyword/karma-reporter</span>        <span class=\"na\">reporters</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">progress</span><span class=\"dl\">'</span><span class=\"p\">],</span>        <span class=\"c1\">// web server port</span>        <span class=\"na\">port</span><span class=\"p\">:</span> <span class=\"mi\">9876</span><span class=\"p\">,</span>        <span class=\"c1\">// enable / disable colors in the output (reporters and logs)</span>        <span class=\"na\">colors</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>        <span class=\"c1\">// level of logging</span>        <span class=\"c1\">// possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG</span>        <span class=\"na\">logLevel</span><span class=\"p\">:</span> <span class=\"nx\">config</span><span class=\"p\">.</span><span class=\"nx\">LOG_INFO</span><span class=\"p\">,</span>        <span class=\"c1\">// enable / disable watching file and executing tests whenever any file changes</span>        <span class=\"na\">autoWatch</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>        <span class=\"c1\">// start these browsers</span>        <span class=\"c1\">// available browser launchers: https://npmjs.org/browse/keyword/karma-launcher</span>        <span class=\"na\">browsers</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">Chrome</span><span class=\"dl\">'</span><span class=\"p\">],</span>        <span class=\"c1\">// Continuous Integration mode</span>        <span class=\"c1\">// if true, Karma captures browsers, runs the tests and exits</span>        <span class=\"na\">singleRun</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>        <span class=\"c1\">// Concurrency level</span>        <span class=\"c1\">// how many browser should be started simultaneous</span>        <span class=\"na\">concurrency</span><span class=\"p\">:</span> <span class=\"kc\">Infinity</span>    <span class=\"p\">})</span><span class=\"p\">};</span></code></pre></div></div><blockquote>  <p>Run the <code class=\"language-plaintext highlighter-rouge\">Karma</code> to run the tests</p></blockquote><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>karma start &lt;file_name&gt;</code></pre></div></div><p>If you <code class=\"language-plaintext highlighter-rouge\">Karma</code> configuration file name is <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code> you can use <code class=\"language-plaintext highlighter-rouge\">karma start</code> which will look for default file i.e <code class=\"language-plaintext highlighter-rouge\">karma.conf.js</code>. If your configutaion file name is different you can issue the command and provide the <code class=\"language-plaintext highlighter-rouge\">file_name</code>.</p><p>Of course if you didn’t install <code class=\"language-plaintext highlighter-rouge\">Karma</code> globally you can run</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>./node_modules/.bin/karma start</code></pre></div></div><p><img src=\"/assets/blog/2016-11-24-Karma-Integration-Part2/Karma-Run-Test-001.png\" width=\"70%\" style=\"padding-left: 20%\" /></p><p>Well, in this article you learned about <code class=\"language-plaintext highlighter-rouge\">Karma</code> and how we can use <code class=\"language-plaintext highlighter-rouge\">Karma</code> to run our unit test. I’ll cover some other topics related to Angular Testing so stay tuned.</p>",
            "url": "https://babal.dev/2016/11/24/integrate-karma-with-jasmine",
            
            
            
            "tags": ["javascript","angular"],
            
            "date_published": "2016-11-24T00:00:00-05:00",
            "date_modified": "2016-11-24T00:00:00-05:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/11/23/unit-testing-with-jasmine",
            "title": "AngularJS Testing with Jasmine",
            "summary": "Let's get familiar with how we test AngularJS application using Jasmine",
            "content_text": "In this article we will look at how we can test AngularJS application. Since this is the initial step and a first look this article will cover a very basic testing. We will be creating a simple application which has a controller whose sole responsibility is to initialize value to some variable on $scope.Let’s create a Simple application  Download ( or use CDN URL) AngularJS file.  Create src folder  Inside src Create a file app.js.      Inside app.js create a module name app and create one controller named MainCtrl.  angular    .module('app', []).controller('MainCtrl', ['$scope', function($scope) {  $scope.someVar = \"Some Text\"}]);  Create index.html on root directory      Inside index.html add simple html content  &lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=\"utf-8\"&gt;        &lt;title&gt;Angular Testing&lt;/title&gt;    &lt;/head&gt;    &lt;body ng-app='app'&gt;        &lt;div ng-controller=\"MainCtrl\"&gt;            &lt;span&gt;Hello World : {{someVar}} &lt;/span&gt;        &lt;/div&gt;        &lt;script type=\"text/javascript\" src=\"angular.min.js\"&gt;&lt;/script&gt;        &lt;script type=\"text/javascript\" src=\"src/app.js\"&gt;&lt;/script&gt;    &lt;/body&gt;&lt;/html&gt;  Now that we have simple application that we can test. Download Jasmine Standalone Zip  Copy Unzipped Jasmine Jar to our WorkDir  Copy SpecRunner.html from Jasmine Folder to test/SpecRunner.html  Update the path so that test/SpecRunner.html can load js and css files&lt;link rel=\"shortcut icon\" type=\"image/png\" href=\"../jasmine-standalone/lib/jasmine-2.5.2/jasmine_favicon.png\"&gt;&lt;link rel=\"stylesheet\" href=\"../jasmine-standalone/lib/jasmine-2.5.2/jasmine.css\"&gt;&lt;script src=\"../jasmine-standalone/lib/jasmine-2.5.2/jasmine.js\"&gt;&lt;/script&gt;&lt;script src=\"../jasmine-standalone/lib/jasmine-2.5.2/jasmine-html.js\"&gt;&lt;/script&gt;&lt;script src=\"../jasmine-standalone/lib/jasmine-2.5.2/boot.js\"&gt;&lt;/script&gt;  For testing AngularJS we need one more dependency. i.e Angular Mock. Download Angular-Mock  Add following lines in test/SpecRunner.html  &lt;script type=\"text/javascript\" src=\"../angular.min.js\"&gt;&lt;/script&gt;  &lt;script type=\"text/javascript\" src=\"../angular-mock.js\"&gt;&lt;/script&gt;  We also need to add the source file in test/SpecRunner.html. Add following line to test/SpecRunner.html        &lt;!-- include source files here... --&gt;        &lt;script src=\"../src/app.js\"&gt;&lt;/script&gt;  Next we need to Write some test. In AngularJS world test are called specs. So let’s create the specfile under test directory named appSpec.js  Add specfile to test/SpecRunner.html&lt;script src=\"appSpec.js\"&gt;&lt;/script&gt;  Now that All things are on the place let’s fill the appSpec.js with some test content. I highly recommend you read throught Jasmine Introduction  We start by calling the global jasmine function describe(string, function). describe simply defines the test suitedescribe('This is description for test suite', function(){});  Jasmine provides the global beforeEach and afterEach functions. beforeEach function is called once before each spec in the describe in which it is called, and the afterEach function is called once after each spec.  Since we want to load our Angular Module for each test let’s call the beforeEach global functiondescribe('This is description for test suite', function(){  beforeEach(module('app'));});  Let’s write some test. To write the test we call global function it(string, function);. A spec contains one or more expectations that test the state of the code.describe('This is description for test suite', function(){  beforeEach(module('app'));  it(    'This is use to describe the test',    function(){      expect(1).toEqual(1);    }  );});  In above example we just we have one expectations (which is not useful at all). Let’s create the spec to test if Controller was able to set someVar and see if the value is Some Text as we assigned.  Let’s create a basic test that injects the $controller service and $rootscope. We can then create a new $scope object and instantiate a new instance of our controller providing the $scope object:describe('This is description for test suite', function() {    beforeEach(module('app'));    it(        'This is use to describe the test',        inject(function($controller, $rootScope) {            // creating the new scope variable            $scope = $rootScope.$new();            // assign new $scope to Main controller            $controller('MainCtrl', {                $scope: $scope            });            expect($scope.someVar).toEqual('Some Text');        })    );});  We can still go one step further by instantiating our controller in beforeEach functiondescribe('This is description for test suite', function() {    beforeEach(module('cookbook'));    beforeEach(inject(function($controller, $rootScope) {        $scope = $rootScope.$new();        $controller('MainCtrl', {            $scope: $scope        });    }));    it('This is use to describe the test', function() {        expect($scope.someVar).toEqual('Aman Tuladhar');    });});Open test/SpecRunner.html on any browser and you can see the Test resultLet’s wrap up this article and In Part 2 i’ll show you how we can integrate Karma with Jasmine and AngularJS.",
            "content_html": "<p>In this article we will look at how we can test AngularJS application. Since this is the initial step and a first look this article will cover a very basic testing. We will be creating a simple application which has a <code class=\"language-plaintext highlighter-rouge\">controller</code> whose sole responsibility is to initialize value to some variable on <code class=\"language-plaintext highlighter-rouge\">$scope</code>.</p><p>Let’s create a Simple application</p><blockquote>  <p>Download ( or use CDN URL) AngularJS file.</p></blockquote><blockquote>  <p>Create <code class=\"language-plaintext highlighter-rouge\">src</code> folder</p></blockquote><blockquote>  <p>Inside <code class=\"language-plaintext highlighter-rouge\">src</code> Create a file <code class=\"language-plaintext highlighter-rouge\">app.js</code>.</p></blockquote><blockquote>  <blockquote>    <p>Inside <code class=\"language-plaintext highlighter-rouge\">app.js</code> create a module name <code class=\"language-plaintext highlighter-rouge\">app</code> and create one <code class=\"language-plaintext highlighter-rouge\">controller</code> named <code class=\"language-plaintext highlighter-rouge\">MainCtrl</code>.</p>  </blockquote></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">angular</span>    <span class=\"p\">.</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"p\">.</span><span class=\"nx\">controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">MainCtrl</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">$scope</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">$scope</span><span class=\"p\">)</span> <span class=\"p\">{</span>  <span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">someVar</span> <span class=\"o\">=</span> <span class=\"dl\">\"</span><span class=\"s2\">Some Text</span><span class=\"dl\">\"</span><span class=\"p\">}])</span><span class=\"p\">;</span></code></pre></div></div><blockquote>  <p>Create <code class=\"language-plaintext highlighter-rouge\">index.html</code> on root directory</p></blockquote><blockquote>  <blockquote>    <p>Inside <code class=\"language-plaintext highlighter-rouge\">index.html</code> add simple html content</p>  </blockquote></blockquote><div class=\"language-html highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"cp\">&lt;!DOCTYPE html&gt;</span><span class=\"nt\">&lt;html&gt;</span>    <span class=\"nt\">&lt;head&gt;</span>        <span class=\"nt\">&lt;meta</span> <span class=\"na\">charset=</span><span class=\"s\">\"utf-8\"</span><span class=\"nt\">&gt;</span>        <span class=\"nt\">&lt;title&gt;</span>Angular Testing<span class=\"nt\">&lt;/title&gt;</span>    <span class=\"nt\">&lt;/head&gt;</span>    <span class=\"nt\">&lt;body</span> <span class=\"na\">ng-app=</span><span class=\"s\">'app'</span><span class=\"nt\">&gt;</span>        <span class=\"nt\">&lt;div</span> <span class=\"na\">ng-controller=</span><span class=\"s\">\"MainCtrl\"</span><span class=\"nt\">&gt;</span>            <span class=\"nt\">&lt;span&gt;</span>Hello World : {{someVar}} <span class=\"nt\">&lt;/span&gt;</span>        <span class=\"nt\">&lt;/div&gt;</span>        <span class=\"nt\">&lt;script </span><span class=\"na\">type=</span><span class=\"s\">\"text/javascript\"</span> <span class=\"na\">src=</span><span class=\"s\">\"angular.min.js\"</span><span class=\"nt\">&gt;&lt;/script&gt;</span>        <span class=\"nt\">&lt;script </span><span class=\"na\">type=</span><span class=\"s\">\"text/javascript\"</span> <span class=\"na\">src=</span><span class=\"s\">\"src/app.js\"</span><span class=\"nt\">&gt;&lt;/script&gt;</span>    <span class=\"nt\">&lt;/body&gt;</span><span class=\"nt\">&lt;/html&gt;</span></code></pre></div></div><blockquote>  <p>Now that we have simple application that we can test. Download <a href=\"https://github.com/jasmine/jasmine/releases\">Jasmine Standalone Zip</a></p></blockquote><blockquote>  <p>Copy Unzipped Jasmine Jar to our WorkDir</p></blockquote><blockquote>  <p>Copy <code class=\"language-plaintext highlighter-rouge\">SpecRunner.html</code> from <code class=\"language-plaintext highlighter-rouge\">Jasmine Folder</code> to <code class=\"language-plaintext highlighter-rouge\">test/SpecRunner.html</code></p></blockquote><blockquote>  <p>Update the path so that <code class=\"language-plaintext highlighter-rouge\">test/SpecRunner.html</code> can load <code class=\"language-plaintext highlighter-rouge\">js</code> and <code class=\"language-plaintext highlighter-rouge\">css</code> files</p></blockquote><pre><code class=\"language-minesmall\">&lt;link rel=\"shortcut icon\" type=\"image/png\" href=\"../jasmine-standalone/lib/jasmine-2.5.2/jasmine_favicon.png\"&gt;&lt;link rel=\"stylesheet\" href=\"../jasmine-standalone/lib/jasmine-2.5.2/jasmine.css\"&gt;&lt;script src=\"../jasmine-standalone/lib/jasmine-2.5.2/jasmine.js\"&gt;&lt;/script&gt;&lt;script src=\"../jasmine-standalone/lib/jasmine-2.5.2/jasmine-html.js\"&gt;&lt;/script&gt;&lt;script src=\"../jasmine-standalone/lib/jasmine-2.5.2/boot.js\"&gt;&lt;/script&gt;</code></pre><blockquote>  <p>For testing <code class=\"language-plaintext highlighter-rouge\">AngularJS</code> we need one more dependency. i.e <code class=\"language-plaintext highlighter-rouge\">Angular Mock</code>. Download <a href=\"https://github.com/angular/bower-angular-mocks/blob/master/angular-mocks.js\">Angular-Mock</a></p></blockquote><blockquote>  <p>Add following lines in <code class=\"language-plaintext highlighter-rouge\">test/SpecRunner.html</code></p></blockquote><div class=\"language-html highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>  <span class=\"nt\">&lt;script </span><span class=\"na\">type=</span><span class=\"s\">\"text/javascript\"</span> <span class=\"na\">src=</span><span class=\"s\">\"../angular.min.js\"</span><span class=\"nt\">&gt;&lt;/script&gt;</span>  <span class=\"nt\">&lt;script </span><span class=\"na\">type=</span><span class=\"s\">\"text/javascript\"</span> <span class=\"na\">src=</span><span class=\"s\">\"../angular-mock.js\"</span><span class=\"nt\">&gt;&lt;/script&gt;</span></code></pre></div></div><blockquote>  <p>We also need to add the source file in <code class=\"language-plaintext highlighter-rouge\">test/SpecRunner.html</code>. Add following line to <code class=\"language-plaintext highlighter-rouge\">test/SpecRunner.html</code></p></blockquote><div class=\"language-html highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>        <span class=\"c\">&lt;!-- include source files here... --&gt;</span>        <span class=\"nt\">&lt;script </span><span class=\"na\">src=</span><span class=\"s\">\"../src/app.js\"</span><span class=\"nt\">&gt;&lt;/script&gt;</span></code></pre></div></div><blockquote>  <p>Next we need to Write some test. In <code class=\"language-plaintext highlighter-rouge\">AngularJS</code> world test are called <code class=\"language-plaintext highlighter-rouge\">specs</code>. So let’s create the <code class=\"language-plaintext highlighter-rouge\">specfile</code> under <code class=\"language-plaintext highlighter-rouge\">test</code> directory named <code class=\"language-plaintext highlighter-rouge\">appSpec.js</code></p></blockquote><blockquote>  <p>Add <code class=\"language-plaintext highlighter-rouge\">specfile</code> to <code class=\"language-plaintext highlighter-rouge\">test/SpecRunner.html</code></p></blockquote><div class=\"language-html highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;script </span><span class=\"na\">src=</span><span class=\"s\">\"appSpec.js\"</span><span class=\"nt\">&gt;&lt;/script&gt;</span></code></pre></div></div><blockquote>  <p>Now that All things are on the place let’s fill the <code class=\"language-plaintext highlighter-rouge\">appSpec.js</code> with some test content. I highly recommend you read throught <a href=\"https://jasmine.github.io/2.0/introduction.html\">Jasmine Introduction</a></p></blockquote><blockquote>  <p>We start by calling the <strong>global jasmine function</strong> <code class=\"language-plaintext highlighter-rouge\">describe(string, function)</code>. <code class=\"language-plaintext highlighter-rouge\">describe</code> simply defines the test suite</p></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">This is description for test suite</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span><span class=\"p\">});</span></code></pre></div></div><blockquote>  <p><code class=\"language-plaintext highlighter-rouge\">Jasmine</code> provides the global <code class=\"language-plaintext highlighter-rouge\">beforeEach</code> and <code class=\"language-plaintext highlighter-rouge\">afterEach</code> functions. <code class=\"language-plaintext highlighter-rouge\">beforeEach</code> function is called once before each <code class=\"language-plaintext highlighter-rouge\">spec</code> in the <code class=\"language-plaintext highlighter-rouge\">describe</code> in which it is called, and the <code class=\"language-plaintext highlighter-rouge\">afterEach</code> function is called once after each <code class=\"language-plaintext highlighter-rouge\">spec</code>.</p></blockquote><blockquote>  <p>Since we want to load our <code class=\"language-plaintext highlighter-rouge\">Angular Module</code> for each test let’s call the <code class=\"language-plaintext highlighter-rouge\">beforeEach</code> <strong>global function</strong></p></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">This is description for test suite</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>  <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span><span class=\"p\">});</span></code></pre></div></div><blockquote>  <p>Let’s write some test. To write the test we call global function <code class=\"language-plaintext highlighter-rouge\">it(string, function);</code>. A spec contains one or more expectations that test the state of the code.</p></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">This is description for test suite</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(){</span>  <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span>  <span class=\"nx\">it</span><span class=\"p\">(</span>    <span class=\"dl\">'</span><span class=\"s1\">This is use to describe the test</span><span class=\"dl\">'</span><span class=\"p\">,</span>    <span class=\"kd\">function</span><span class=\"p\">(){</span>      <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">);</span>    <span class=\"p\">}</span>  <span class=\"p\">);</span><span class=\"p\">});</span></code></pre></div></div><blockquote>  <p>In above example we just we have one expectations (which is not useful at all). Let’s create the <code class=\"language-plaintext highlighter-rouge\">spec</code> to test if Controller was able to set <code class=\"language-plaintext highlighter-rouge\">someVar</code> and see if the value is <code class=\"language-plaintext highlighter-rouge\">Some Text</code> as we assigned.</p></blockquote><blockquote>  <p>Let’s create a basic test that <code class=\"language-plaintext highlighter-rouge\">injects</code> the <code class=\"language-plaintext highlighter-rouge\">$controller</code> service and <code class=\"language-plaintext highlighter-rouge\">$rootscope</code>. We can then create a <code class=\"language-plaintext highlighter-rouge\">new $scope</code> object and instantiate a <code class=\"language-plaintext highlighter-rouge\">new instance of our controller providing the $scope object</code>:</p></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">This is description for test suite</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">app</span><span class=\"dl\">'</span><span class=\"p\">));</span>    <span class=\"nx\">it</span><span class=\"p\">(</span>        <span class=\"dl\">'</span><span class=\"s1\">This is use to describe the test</span><span class=\"dl\">'</span><span class=\"p\">,</span>        <span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">$controller</span><span class=\"p\">,</span> <span class=\"nx\">$rootScope</span><span class=\"p\">)</span> <span class=\"p\">{</span>            <span class=\"c1\">// creating the new scope variable</span>            <span class=\"nx\">$scope</span> <span class=\"o\">=</span> <span class=\"nx\">$rootScope</span><span class=\"p\">.</span><span class=\"nx\">$new</span><span class=\"p\">();</span>            <span class=\"c1\">// assign new $scope to Main controller</span>            <span class=\"nx\">$controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">MainCtrl</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">{</span>                <span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">$scope</span>            <span class=\"p\">});</span>            <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">someVar</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Some Text</span><span class=\"dl\">'</span><span class=\"p\">);</span>        <span class=\"p\">})</span>    <span class=\"p\">);</span><span class=\"p\">});</span></code></pre></div></div><blockquote>  <p>We can still go one step further by instantiating our controller in <code class=\"language-plaintext highlighter-rouge\">beforeEach</code> function</p></blockquote><div class=\"language-javascript highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nx\">describe</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">This is description for test suite</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">module</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">cookbook</span><span class=\"dl\">'</span><span class=\"p\">));</span>    <span class=\"nx\">beforeEach</span><span class=\"p\">(</span><span class=\"nx\">inject</span><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">$controller</span><span class=\"p\">,</span> <span class=\"nx\">$rootScope</span><span class=\"p\">)</span> <span class=\"p\">{</span>        <span class=\"nx\">$scope</span> <span class=\"o\">=</span> <span class=\"nx\">$rootScope</span><span class=\"p\">.</span><span class=\"nx\">$new</span><span class=\"p\">();</span>        <span class=\"nx\">$controller</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">MainCtrl</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"p\">{</span>            <span class=\"na\">$scope</span><span class=\"p\">:</span> <span class=\"nx\">$scope</span>        <span class=\"p\">});</span>    <span class=\"p\">}));</span>    <span class=\"nx\">it</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">This is use to describe the test</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">()</span> <span class=\"p\">{</span>        <span class=\"nx\">expect</span><span class=\"p\">(</span><span class=\"nx\">$scope</span><span class=\"p\">.</span><span class=\"nx\">someVar</span><span class=\"p\">).</span><span class=\"nx\">toEqual</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">Aman Tuladhar</span><span class=\"dl\">'</span><span class=\"p\">);</span>    <span class=\"p\">});</span><span class=\"p\">});</span></code></pre></div></div><p>Open <code class=\"language-plaintext highlighter-rouge\">test/SpecRunner.html</code> on any browser and you can see the Test result</p><p><img src=\"/assets/blog/2016-11-20-AngularJsTestingJasminePart1/jasmine-test-001.png\" width=\"70%\" style=\"padding-left: 20%\" /></p><p>Let’s wrap up this article and In Part 2 i’ll show you how we can integrate <code class=\"language-plaintext highlighter-rouge\">Karma</code> with <code class=\"language-plaintext highlighter-rouge\">Jasmine</code> and <code class=\"language-plaintext highlighter-rouge\">AngularJS</code>.</p>",
            "url": "https://babal.dev/2016/11/23/unit-testing-with-jasmine",
            
            
            
            "tags": ["javascript","angular"],
            
            "date_published": "2016-11-23T00:00:00-05:00",
            "date_modified": "2016-11-23T00:00:00-05:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/10/19/splitting-vs-parsing",
            "title": "Splitting with REGex vs Parsing",
            "summary": "Let's see how we can split the Strings with its performance",
            "content_text": "In this post I’ll walk you through a simple scenario where you have to split the CSV file. It’s pretty simple with JAVA you just need to call the split(String) method of String class. If you want to split your string with comma (,) you can pass comma as argument of split(,).You need to split the CSV provided below (from now on refer this String as row).// 6 Fields\"1,Jesse,Arnold,jarnold0@cyberchimps.com,Fully-configurable even-keeled portal,65001 Jenna Alley\";You can split() method of String classfinal String row = \"1,Jesse,Arnold,jarnold0@cyberchimps.com,Fully-configurable even-keeled portal,65001 Jenna Alley\";final int length = row.split(\",\").length;System.out.println(length);#OUTPUT6You can see in above example split() method is called with comma as argument. Notice we will print out size/length of splitted String to see if we are getting expected result.CSV row provided above was simple but, let’s add a little twist to our row.final String row = \"1,Jesse,Arnold,jarnold0@cyberchimps.com,\\\"Fully-configurable, even-keeled, portal\\\",\\\"65001, Jenna Alley\\\"\";final int length = row.split(\",\").length;System.out.println(length);#OUTPUT9In above example you have same row but now some field have a comma as there value (value comma). Value comma are wrapped inside quotes. When you run above program you will have output as 9. split() cannot distinguish between value comma and separator comma in above example. But with simple Regex magic we can make our split() method more SMART.We can pass a Regex as split() argument which can target complex scenario as above. ( We will be using Google Guava Splitter from now on to split the String)Here’s a method that takes a String as argument and splits it. When you call method below it will ignore the comma that is inside quotes.public static List&lt;String&gt; splitRegexBackReference(String field) {    final String otherThanQuote = \" [^\\\"] \";    final String quotedString = String.format(\" \\\" %s* \\\" \", otherThanQuote);    // regex for ignoring comma (,) that is inside quote (\"\")    // looking for even number of quotes after the comma    final String regex = String.format(\"(?x) \" + // enable comments, ignore white spaces            \"%s                         \" + // match a delimiter            \"(?=                       \" + // start positive look ahead            \"  (                       \" + //   start group 1            \"    %s*                   \" + //     match 'otherThanQuote' zero or more times            \"    %s                    \" + //     match 'quotedString'            \"  )*                      \" + //   end group 1 and repeat it zero or more times            \"  %s*                     \" + //   match 'otherThanQuote'            \"  $                       \" + // match the end of the string            \")                         \", // stop positive look ahead        \",\", otherThanQuote, quotedString, otherThanQuote    );    return Splitter        .on(Pattern.compile(regex))        .splitToList(field);}Let’s see this method in actionl String row = \"1,Jesse,Arnold,jarnold0@cyberchimps.com,\\\"Fully-configurable, even-keeled, portal\\\",\\\"65001, Jenna Alley\\\"\";final int size = splitRegexBackReference(row).size();System.out.println(size);# OUTPUT6When you split the String with the method splitRegexBackReference() you will get the expected result and which is shown by printing out the size of List. Even thought this form of splitting works its not the fastest. Splitting with Regex can be slow.Another way to split the row is by parsing each character one by one. Let’s see what method looks likeprivate static List&lt;String&gt; parseAndSplit(String field) {    final List&lt;String&gt; tokensList = new ArrayList&lt;&gt;();    boolean inQuotes = false;    StringBuilder b = new StringBuilder();    for (char c : field.toCharArray()) {        switch (c) {        case ',': // this is seperator symbol            if (inQuotes) {                b.append(c);            } else {                tokensList.add(b.toString());                b = new StringBuilder();            }            break;        case '\\\"':            inQuotes = !inQuotes;        default:            b.append(c);            break;        }    }    tokensList.add(b.toString());    return tokensList;}Let’s see parseAndSplit() in actionfinal String row = \"1,Jesse,Arnold,jarnold0@cyberchimps.com,\\\"Fully-configurable, even-keeled, portal\\\",\\\"65001, Jenna Alley\\\"\";final int size = parseAndSplit(row).size();System.out.println(size);# OUTPUT6If you run the above snippet you will get the expected result i.e row is split in 6 parts. I introduced this method telling you that splitRegexBackReference() is not the fastest. Let’s prove this with little speed calculation.Here’s the example that called both mothod 1000 times and when print average execution nano time.final String row = \"1,Jesse,Arnold,jarnold0@cyberchimps.com,\\\"Fully-configurable, even-keeled, portal\\\",\\\"65001, Jenna Alley\\\"\";long start = System.nanoTime();for (int i = 0; i &lt; 1000; i++) {    splitRegexBackReference(row);}final long timeWithSplitting = System.nanoTime() - start;start = System.nanoTime();for (int i = 0; i &lt; 1000; i++) {    parseAndSplit(row);}final long timeWithParsing = System.nanoTime() - start;System.out.printf(\"Time with splitting:\\t%10d\\n\", timeWithSplitting / 1000);System.out.printf(\"Time with parsing:\\t%10d\\n\", timeWithParsing / 1000);#OUTPUT 1Time with splitting:\t    266928Time with parsing:\t      9680#OUTPUT 2Time with splitting:\t    296860Time with parsing:\t      5904#OUTPUT 3Time with splitting:\t    186909Time with parsing:\t      8605#OUTPUT 4Time with splitting:\t    225039Time with parsing:\t      6765#OUTPUT 5Time with splitting:\t    266563Time with parsing:\t      5820If you look at output the time taken by parsing is drastically faster than splitting with Regex.Here’s a Stackoverflow thread from where I’ve gathered code examplesJava: splitting a comma-separated string but ignoring commas in quotesWhy I called 1000 time instead of just onceIs nano time useless",
            "content_html": "<p>In this post I’ll walk you through a simple scenario where you have to split the CSV file. It’s pretty simple with <code class=\"language-plaintext highlighter-rouge\">JAVA</code> you just need to call the <code class=\"language-plaintext highlighter-rouge\">split(String)</code> method of String class. If you want to split your string with comma (,) you can pass comma as argument of <code class=\"language-plaintext highlighter-rouge\">split(,)</code>.</p><p>You need to split the CSV provided below (from now on refer this String as <code class=\"language-plaintext highlighter-rouge\">row</code>).</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">// 6 Fields</span><span class=\"s\">\"1,Jesse,Arnold,jarnold0@cyberchimps.com,Fully-configurable even-keeled portal,65001 Jenna Alley\"</span><span class=\"o\">;</span></code></pre></div></div><p>You can <code class=\"language-plaintext highlighter-rouge\">split()</code> method of <code class=\"language-plaintext highlighter-rouge\">String</code> class</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">final</span> <span class=\"nc\">String</span> <span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"s\">\"1,Jesse,Arnold,jarnold0@cyberchimps.com,Fully-configurable even-keeled portal,65001 Jenna Alley\"</span><span class=\"o\">;</span><span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">length</span> <span class=\"o\">=</span> <span class=\"n\">row</span><span class=\"o\">.</span><span class=\"na\">split</span><span class=\"o\">(</span><span class=\"s\">\",\"</span><span class=\"o\">).</span><span class=\"na\">length</span><span class=\"o\">;</span><span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">length</span><span class=\"o\">);</span></code></pre></div></div><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>#OUTPUT6</code></pre></div></div><p>You can see in above example <code class=\"language-plaintext highlighter-rouge\">split()</code> method is called with comma as argument. Notice we will print out size/length of splitted String to see if we are getting expected result.</p><p>CSV row provided above was simple but, let’s add a little twist to our row.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">final</span> <span class=\"nc\">String</span> <span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"s\">\"1,Jesse,Arnold,jarnold0@cyberchimps.com,\\\"Fully-configurable, even-keeled, portal\\\",\\\"65001, Jenna Alley\\\"\"</span><span class=\"o\">;</span><span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">length</span> <span class=\"o\">=</span> <span class=\"n\">row</span><span class=\"o\">.</span><span class=\"na\">split</span><span class=\"o\">(</span><span class=\"s\">\",\"</span><span class=\"o\">).</span><span class=\"na\">length</span><span class=\"o\">;</span><span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">length</span><span class=\"o\">);</span></code></pre></div></div><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>#OUTPUT9</code></pre></div></div><p>In above example you have same row but now some field have a comma as there value (<strong>value comma</strong>). <strong>Value comma</strong> are wrapped inside quotes. When you run above program you will have output as <code class=\"language-plaintext highlighter-rouge\">9</code>. <code class=\"language-plaintext highlighter-rouge\">split()</code> cannot distinguish between <strong>value comma</strong> and <strong>separator comma</strong> in above example. But with simple Regex magic we can make our <code class=\"language-plaintext highlighter-rouge\">split()</code> method more <strong>SMART</strong>.</p><p>We can pass a Regex as <code class=\"language-plaintext highlighter-rouge\">split()</code> argument which can target complex scenario as above. ( We will be using <em>Google Guava Splitter</em> from now on to split the String)</p><p>Here’s a method that takes a String as argument and splits it. When you call method below it will ignore the comma that is inside quotes.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"nc\">List</span><span class=\"o\">&lt;</span><span class=\"nc\">String</span><span class=\"o\">&gt;</span> <span class=\"nf\">splitRegexBackReference</span><span class=\"o\">(</span><span class=\"nc\">String</span> <span class=\"n\">field</span><span class=\"o\">)</span> <span class=\"o\">{</span>    <span class=\"kd\">final</span> <span class=\"nc\">String</span> <span class=\"n\">otherThanQuote</span> <span class=\"o\">=</span> <span class=\"s\">\" [^\\\"] \"</span><span class=\"o\">;</span>    <span class=\"kd\">final</span> <span class=\"nc\">String</span> <span class=\"n\">quotedString</span> <span class=\"o\">=</span> <span class=\"nc\">String</span><span class=\"o\">.</span><span class=\"na\">format</span><span class=\"o\">(</span><span class=\"s\">\" \\\" %s* \\\" \"</span><span class=\"o\">,</span> <span class=\"n\">otherThanQuote</span><span class=\"o\">);</span>    <span class=\"c1\">// regex for ignoring comma (,) that is inside quote (\"\")</span>    <span class=\"c1\">// looking for even number of quotes after the comma</span>    <span class=\"kd\">final</span> <span class=\"nc\">String</span> <span class=\"n\">regex</span> <span class=\"o\">=</span> <span class=\"nc\">String</span><span class=\"o\">.</span><span class=\"na\">format</span><span class=\"o\">(</span><span class=\"s\">\"(?x) \"</span> <span class=\"o\">+</span> <span class=\"c1\">// enable comments, ignore white spaces</span>            <span class=\"s\">\"%s                         \"</span> <span class=\"o\">+</span> <span class=\"c1\">// match a delimiter</span>            <span class=\"s\">\"(?=                       \"</span> <span class=\"o\">+</span> <span class=\"c1\">// start positive look ahead</span>            <span class=\"s\">\"  (                       \"</span> <span class=\"o\">+</span> <span class=\"c1\">//   start group 1</span>            <span class=\"s\">\"    %s*                   \"</span> <span class=\"o\">+</span> <span class=\"c1\">//     match 'otherThanQuote' zero or more times</span>            <span class=\"s\">\"    %s                    \"</span> <span class=\"o\">+</span> <span class=\"c1\">//     match 'quotedString'</span>            <span class=\"s\">\"  )*                      \"</span> <span class=\"o\">+</span> <span class=\"c1\">//   end group 1 and repeat it zero or more times</span>            <span class=\"s\">\"  %s*                     \"</span> <span class=\"o\">+</span> <span class=\"c1\">//   match 'otherThanQuote'</span>            <span class=\"s\">\"  $                       \"</span> <span class=\"o\">+</span> <span class=\"c1\">// match the end of the string</span>            <span class=\"s\">\")                         \"</span><span class=\"o\">,</span> <span class=\"c1\">// stop positive look ahead</span>        <span class=\"s\">\",\"</span><span class=\"o\">,</span> <span class=\"n\">otherThanQuote</span><span class=\"o\">,</span> <span class=\"n\">quotedString</span><span class=\"o\">,</span> <span class=\"n\">otherThanQuote</span>    <span class=\"o\">);</span>    <span class=\"k\">return</span> <span class=\"nc\">Splitter</span>        <span class=\"o\">.</span><span class=\"na\">on</span><span class=\"o\">(</span><span class=\"nc\">Pattern</span><span class=\"o\">.</span><span class=\"na\">compile</span><span class=\"o\">(</span><span class=\"n\">regex</span><span class=\"o\">))</span>        <span class=\"o\">.</span><span class=\"na\">splitToList</span><span class=\"o\">(</span><span class=\"n\">field</span><span class=\"o\">);</span><span class=\"o\">}</span></code></pre></div></div><p>Let’s see this method in action</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">l</span> <span class=\"nc\">String</span> <span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"s\">\"1,Jesse,Arnold,jarnold0@cyberchimps.com,\\\"Fully-configurable, even-keeled, portal\\\",\\\"65001, Jenna Alley\\\"\"</span><span class=\"o\">;</span><span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">size</span> <span class=\"o\">=</span> <span class=\"n\">splitRegexBackReference</span><span class=\"o\">(</span><span class=\"n\">row</span><span class=\"o\">).</span><span class=\"na\">size</span><span class=\"o\">();</span><span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">size</span><span class=\"o\">);</span></code></pre></div></div><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code># OUTPUT6</code></pre></div></div><p>When you split the String with the method <code class=\"language-plaintext highlighter-rouge\">splitRegexBackReference()</code> you will get the expected result and which is shown by printing out the <strong>size</strong> of <code class=\"language-plaintext highlighter-rouge\">List</code>. Even thought this form of splitting works its not the fastest. Splitting with Regex can be slow.</p><p>Another way to split the row is by parsing each character one by one. Let’s see what method looks like</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">private</span> <span class=\"kd\">static</span> <span class=\"nc\">List</span><span class=\"o\">&lt;</span><span class=\"nc\">String</span><span class=\"o\">&gt;</span> <span class=\"nf\">parseAndSplit</span><span class=\"o\">(</span><span class=\"nc\">String</span> <span class=\"n\">field</span><span class=\"o\">)</span> <span class=\"o\">{</span>    <span class=\"kd\">final</span> <span class=\"nc\">List</span><span class=\"o\">&lt;</span><span class=\"nc\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">tokensList</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">ArrayList</span><span class=\"o\">&lt;&gt;();</span>    <span class=\"kt\">boolean</span> <span class=\"n\">inQuotes</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"o\">;</span>    <span class=\"nc\">StringBuilder</span> <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">StringBuilder</span><span class=\"o\">();</span>    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">char</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">field</span><span class=\"o\">.</span><span class=\"na\">toCharArray</span><span class=\"o\">())</span> <span class=\"o\">{</span>        <span class=\"k\">switch</span> <span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">{</span>        <span class=\"k\">case</span> <span class=\"sc\">','</span><span class=\"o\">:</span> <span class=\"c1\">// this is seperator symbol</span>            <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">inQuotes</span><span class=\"o\">)</span> <span class=\"o\">{</span>                <span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">append</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">);</span>            <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>                <span class=\"n\">tokensList</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">());</span>                <span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">StringBuilder</span><span class=\"o\">();</span>            <span class=\"o\">}</span>            <span class=\"k\">break</span><span class=\"o\">;</span>        <span class=\"k\">case</span> <span class=\"sc\">'\\\"'</span><span class=\"o\">:</span>            <span class=\"n\">inQuotes</span> <span class=\"o\">=</span> <span class=\"o\">!</span><span class=\"n\">inQuotes</span><span class=\"o\">;</span>        <span class=\"k\">default</span><span class=\"o\">:</span>            <span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">append</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">);</span>            <span class=\"k\">break</span><span class=\"o\">;</span>        <span class=\"o\">}</span>    <span class=\"o\">}</span>    <span class=\"n\">tokensList</span><span class=\"o\">.</span><span class=\"na\">add</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">.</span><span class=\"na\">toString</span><span class=\"o\">());</span>    <span class=\"k\">return</span> <span class=\"n\">tokensList</span><span class=\"o\">;</span><span class=\"o\">}</span></code></pre></div></div><p>Let’s see <code class=\"language-plaintext highlighter-rouge\">parseAndSplit()</code> in action</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">final</span> <span class=\"nc\">String</span> <span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"s\">\"1,Jesse,Arnold,jarnold0@cyberchimps.com,\\\"Fully-configurable, even-keeled, portal\\\",\\\"65001, Jenna Alley\\\"\"</span><span class=\"o\">;</span><span class=\"kd\">final</span> <span class=\"kt\">int</span> <span class=\"n\">size</span> <span class=\"o\">=</span> <span class=\"n\">parseAndSplit</span><span class=\"o\">(</span><span class=\"n\">row</span><span class=\"o\">).</span><span class=\"na\">size</span><span class=\"o\">();</span><span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">size</span><span class=\"o\">);</span></code></pre></div></div><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code># OUTPUT6</code></pre></div></div><p>If you run the above snippet you will get the expected result i.e row is split in 6 parts. I introduced this method telling you that <em>splitRegexBackReference()</em> is not the fastest. Let’s prove this with little speed calculation.</p><p>Here’s the example that called both mothod 1000 times and when print average execution nano time.</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kd\">final</span> <span class=\"nc\">String</span> <span class=\"n\">row</span> <span class=\"o\">=</span> <span class=\"s\">\"1,Jesse,Arnold,jarnold0@cyberchimps.com,\\\"Fully-configurable, even-keeled, portal\\\",\\\"65001, Jenna Alley\\\"\"</span><span class=\"o\">;</span><span class=\"kt\">long</span> <span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">nanoTime</span><span class=\"o\">();</span><span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">1000</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>    <span class=\"n\">splitRegexBackReference</span><span class=\"o\">(</span><span class=\"n\">row</span><span class=\"o\">);</span><span class=\"o\">}</span><span class=\"kd\">final</span> <span class=\"kt\">long</span> <span class=\"n\">timeWithSplitting</span> <span class=\"o\">=</span> <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">nanoTime</span><span class=\"o\">()</span> <span class=\"o\">-</span> <span class=\"n\">start</span><span class=\"o\">;</span><span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">nanoTime</span><span class=\"o\">();</span><span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">1000</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>    <span class=\"n\">parseAndSplit</span><span class=\"o\">(</span><span class=\"n\">row</span><span class=\"o\">);</span><span class=\"o\">}</span><span class=\"kd\">final</span> <span class=\"kt\">long</span> <span class=\"n\">timeWithParsing</span> <span class=\"o\">=</span> <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">nanoTime</span><span class=\"o\">()</span> <span class=\"o\">-</span> <span class=\"n\">start</span><span class=\"o\">;</span><span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">printf</span><span class=\"o\">(</span><span class=\"s\">\"Time with splitting:\\t%10d\\n\"</span><span class=\"o\">,</span> <span class=\"n\">timeWithSplitting</span> <span class=\"o\">/</span> <span class=\"mi\">1000</span><span class=\"o\">);</span><span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">printf</span><span class=\"o\">(</span><span class=\"s\">\"Time with parsing:\\t%10d\\n\"</span><span class=\"o\">,</span> <span class=\"n\">timeWithParsing</span> <span class=\"o\">/</span> <span class=\"mi\">1000</span><span class=\"o\">);</span></code></pre></div></div><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>#OUTPUT 1Time with splitting:\t    266928Time with parsing:\t      9680#OUTPUT 2Time with splitting:\t    296860Time with parsing:\t      5904#OUTPUT 3Time with splitting:\t    186909Time with parsing:\t      8605#OUTPUT 4Time with splitting:\t    225039Time with parsing:\t      6765#OUTPUT 5Time with splitting:\t    266563Time with parsing:\t      5820</code></pre></div></div><p>If you look at output the time taken by parsing is drastically faster than splitting with Regex.</p><p>Here’s a Stackoverflow thread from where I’ve gathered code examples<a href=\"http://stackoverflow.com/questions/1757065/java-splitting-a-comma-separated-string-but-ignoring-commas-in-quotes\" target=\"_blank\">Java: splitting a comma-separated string but ignoring commas in quotes</a></p><p>Why I called 1000 time instead of just once<a href=\"http://stackoverflow.com/a/518438\" target=\"_blank\">Is nano time useless</a></p>",
            "url": "https://babal.dev/2016/10/19/splitting-vs-parsing",
            
            
            
            
            
            "date_published": "2016-10-19T00:00:00-04:00",
            "date_modified": "2016-10-19T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/10/09/caps-to-esc-and-control",
            "title": "Mapping CapsLock to Esc or Control",
            "summary": "Changing the behaviour of Caps such that when Caps is clicked it acts as Esc but when click with supporting Letter",
            "content_text": "If you use VIM you know pain of pressing ESC button. Your pinky finger needs to stretch a lot. In this post I’ll try to remove the burden of your pinky finger.I’ll show you ways to map your Caps as ESC when pressed alone but, when pressed with other keys like a will it will be registered as Control. To make long story short when you press Caps you will register ESC key and when you press Caps + a you will register Ctrl + a.For this to work we are going to use xcapeYou can install the xcape with the instruction provided. After following the instruction typewhich xcape# OUTPUT/usr/bin/xcapeIf it shows you the path then you are all good to go.Follow the instruction below      Copy your xcape executable to your $PATH        Add the following snippet to you ~/.profile  setxkbmap -option `ctrl:nocaps`xcape -e 'Caps_Lock=Escape;Control_L=Escape;Control_R=Escape'  Restart your machine and you should be good to go.Sometime above instructions doesn’t work if above instruction doesn’t work for you, Here’s another way to configure keys      Edit /etc/default/keyboard( sudo vim /etc/default/keyboard)        On XKBOPTIONS add ctrl:nocaps. If your XKBOPTIONS are not empty you can append options with ;.        Add  xcape -e 'Caps_Lock=Escape;Control_L=Escape;Control_R=Escape'  Runsudo dkpg-reconfigure keyboard-configurationNow you should be good to go. Let me know if this worked for you.",
            "content_html": "<p>If you use <code class=\"language-plaintext highlighter-rouge\">VIM</code> you know pain of pressing <code class=\"language-plaintext highlighter-rouge\">ESC</code> button. Your pinky finger needs to stretch a lot. In this post I’ll try to remove the burden of your pinky finger.I’ll show you ways to map your <code class=\"language-plaintext highlighter-rouge\">Caps</code> as <code class=\"language-plaintext highlighter-rouge\">ESC</code> when pressed alone but, when pressed with other keys like <code class=\"language-plaintext highlighter-rouge\">a</code> will it will be registered as <code class=\"language-plaintext highlighter-rouge\">Control</code>. To make long story short when you press <code class=\"language-plaintext highlighter-rouge\">Caps</code> you will register <code class=\"language-plaintext highlighter-rouge\">ESC</code> key and when you press <code class=\"language-plaintext highlighter-rouge\">Caps + a</code> you will register <code class=\"language-plaintext highlighter-rouge\">Ctrl + a</code>.</p><p>For this to work we are going to use <a href=\"https://github.com/alols/xcape\">xcape</a></p><p>You can install the <code class=\"language-plaintext highlighter-rouge\">xcape</code> with the instruction provided. After following the instruction type</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>which xcape<span class=\"c\"># OUTPUT</span>/usr/bin/xcape</code></pre></div></div><p>If it shows you the path then you are all good to go.</p><hr /><p>Follow the instruction below</p><ul>  <li>    <p>Copy your <code class=\"language-plaintext highlighter-rouge\">xcape</code> executable to your <code class=\"language-plaintext highlighter-rouge\">$PATH</code></p>  </li>  <li>    <p>Add the following snippet to you <code class=\"language-plaintext highlighter-rouge\">~/.profile</code></p>  </li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>setxkbmap <span class=\"nt\">-option</span> <span class=\"sb\">`</span>ctrl:nocaps<span class=\"sb\">`</span>xcape <span class=\"nt\">-e</span> <span class=\"s1\">'Caps_Lock=Escape;Control_L=Escape;Control_R=Escape'</span></code></pre></div></div><ul>  <li>Restart your machine and you should be good to go.</li></ul><hr /><p>Sometime above instructions doesn’t work if above instruction doesn’t work for you, Here’s another way to configure keys</p><ul>  <li>    <p>Edit <code class=\"language-plaintext highlighter-rouge\">/etc/default/keyboard</code>( <code class=\"language-plaintext highlighter-rouge\">sudo vim /etc/default/keyboard</code>)</p>  </li>  <li>    <p>On <code class=\"language-plaintext highlighter-rouge\">XKBOPTIONS</code> add <code class=\"language-plaintext highlighter-rouge\">ctrl:nocaps</code>. If your <code class=\"language-plaintext highlighter-rouge\">XKBOPTIONS</code> are not empty you can append options with <code class=\"language-plaintext highlighter-rouge\">;</code>.</p>  </li>  <li>    <p>Add</p>  </li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>xcape <span class=\"nt\">-e</span> <span class=\"s1\">'Caps_Lock=Escape;Control_L=Escape;Control_R=Escape'</span></code></pre></div></div><ul>  <li>Run</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">sudo </span>dkpg-reconfigure keyboard-configuration</code></pre></div></div><p>Now you should be good to go. Let me know if this worked for you.</p>",
            "url": "https://babal.dev/2016/10/09/caps-to-esc-and-control",
            
            
            
            
            
            "date_published": "2016-10-09T00:00:00-04:00",
            "date_modified": "2016-10-09T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/10/08/docker-network-between-container",
            "title": "Docker Network Between Container",
            "summary": "Creating a network such that two container can communicate",
            "content_text": "We can run multiple container on our host machine using Docker. By default when we run multiple container, one cannot communicate with other. If we want our multiple container to communicate between each other we can use Docker Network.Docker Network lets you create a isolated network where we can connect our container. Container cannot access external network but if other container are connected to same network they can orchestrate between each other. To create a network is simple as# docker network create &lt;network_name&gt;  docker network create anetworkBy default Docker creates network with bridge driver. If you want to create a network with other driver you can use -d option. Default option Docker accepts are bridge and overlay. Bridge networks are isolated networks on a single Engine installation.We can now add the container in the network we just created.1. Use --net when we run our dockerIf we want to add our container to network when we execute docker run we can use --net option which accepts the network name. In order for container to orchestrate Docker uses container name so we can use --name option to give name to container.docker run -d --net=anetwork --name=mysql -e MYSQL_USER=ROOT -e MYSQL_ALLOW_EMPTY_PASSWORD=yes mysqlIn above command we are running the mysql container in network anetwork with the name mysql. If other container wants to communicate with mysql they can use container name i.e mysql. Notice we are running our mysql container in deamon mode with -d flag.Let’s add another container to networkdocker run --net=anetwork --name=pythonapp -it python:2.7-wheezy bashAbove command adds pythonapp into the network anetwork. Notice we are starting our pythonapp with -it flag and we are passing bash as argument. When we execute above command we will be interacting pythonapp bash shell.To check if we can communicate with mysql we can use ping commandping mysql2. Use docker network connectAbove process works perfect if you are running a new container. What if you want to create a network and add already running container to newly created network. That’s where docker network connect comes handy.Here’s a syntaxdocker network connect &lt;network_name&gt; &lt;container_name&gt;You can see that to add existing container to network we first need a network name and container name.Assume we have two container with name mysql and pythonapp. Let’s create a networkdocker network create anetworkTo add container to network use docker network connectdocker network connect anetwork mysqldocker network connect anetwork pythonappThat’s it, now two container can communicate with each other.",
            "content_html": "<p>We can run multiple container on our host machine using <code class=\"language-plaintext highlighter-rouge\">Docker</code>. By default when we run multiple container, one cannot communicate with other. If we want our multiple container to communicate between each other we can use <code class=\"language-plaintext highlighter-rouge\">Docker Network</code>.</p><p><code class=\"language-plaintext highlighter-rouge\">Docker Network</code> lets you create a <em>isolated network</em> where we can connect our container. Container cannot access external network but if other container are connected to same network they can orchestrate between each other. To create a network is simple as</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># docker network create &lt;network_name&gt;</span>  docker network create anetwork</code></pre></div></div><p>By default <code class=\"language-plaintext highlighter-rouge\">Docker</code> creates network with <code class=\"language-plaintext highlighter-rouge\">bridge</code> driver. If you want to create a network with other driver you can use <code class=\"language-plaintext highlighter-rouge\">-d</code> option. Default option <code class=\"language-plaintext highlighter-rouge\">Docker</code> accepts are <code class=\"language-plaintext highlighter-rouge\">bridge</code> and <code class=\"language-plaintext highlighter-rouge\">overlay</code>. <code class=\"language-plaintext highlighter-rouge\">Bridge</code> networks are isolated networks on a single Engine installation.</p><p>We can now add the container in the network we just created.</p><hr /><h3 id=\"1-use---net-when-we-run-our-docker\">1. Use <code class=\"language-plaintext highlighter-rouge\">--net</code> when we run our docker</h3><p>If we want to add our container to network when we execute <code class=\"language-plaintext highlighter-rouge\">docker run</code> we can use <code class=\"language-plaintext highlighter-rouge\">--net</code> option which accepts the network name. In order for container to orchestrate <code class=\"language-plaintext highlighter-rouge\">Docker</code> uses container name so we can use <code class=\"language-plaintext highlighter-rouge\">--name</code> option to give name to container.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>docker run <span class=\"nt\">-d</span> <span class=\"nt\">--net</span><span class=\"o\">=</span>anetwork <span class=\"nt\">--name</span><span class=\"o\">=</span>mysql <span class=\"nt\">-e</span> <span class=\"nv\">MYSQL_USER</span><span class=\"o\">=</span>ROOT <span class=\"nt\">-e</span> <span class=\"nv\">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=\"o\">=</span><span class=\"nb\">yes </span>mysql</code></pre></div></div><p>In above command we are running the <strong>mysql</strong> container in network <code class=\"language-plaintext highlighter-rouge\">anetwork</code> with the name <code class=\"language-plaintext highlighter-rouge\">mysql</code>. If other container wants to communicate with <strong>mysql</strong> they can use container name i.e <code class=\"language-plaintext highlighter-rouge\">mysql</code>. Notice we are running our <strong>mysql</strong> container in <code class=\"language-plaintext highlighter-rouge\">deamon</code> mode with <code class=\"language-plaintext highlighter-rouge\">-d</code> flag.</p><p>Let’s add another container to network</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>docker run <span class=\"nt\">--net</span><span class=\"o\">=</span>anetwork <span class=\"nt\">--name</span><span class=\"o\">=</span>pythonapp <span class=\"nt\">-it</span> python:2.7-wheezy bash</code></pre></div></div><p>Above command adds <code class=\"language-plaintext highlighter-rouge\">pythonapp</code> into the network <code class=\"language-plaintext highlighter-rouge\">anetwork</code>. Notice we are starting our <code class=\"language-plaintext highlighter-rouge\">pythonapp</code> with <code class=\"language-plaintext highlighter-rouge\">-it</code> flag and we are passing <code class=\"language-plaintext highlighter-rouge\">bash</code> as argument. When we execute above command we will be interacting <code class=\"language-plaintext highlighter-rouge\">pythonapp</code> bash shell.</p><p>To check if we can communicate with <code class=\"language-plaintext highlighter-rouge\">mysql</code> we can use <code class=\"language-plaintext highlighter-rouge\">ping</code> command</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>ping mysql</code></pre></div></div><p><img src=\"/assets/blog/2016-10-08-DockerNetworkBetweenContainer/docker-network.gif\" width=\"80%\" /></p><hr /><h3 id=\"2-use-docker-network-connect\">2. Use <code class=\"language-plaintext highlighter-rouge\">docker network connect</code></h3><p>Above process works perfect if you are running a new container. What if you want to create a network and add already running container to newly created network. That’s where <code class=\"language-plaintext highlighter-rouge\">docker network connect</code> comes handy.</p><p>Here’s a syntax</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>docker network connect &lt;network_name&gt; &lt;container_name&gt;</code></pre></div></div><p>You can see that to add existing container to network we first need a <strong>network name</strong> and <strong>container name</strong>.</p><p>Assume we have two container with name <code class=\"language-plaintext highlighter-rouge\">mysql</code> and <code class=\"language-plaintext highlighter-rouge\">pythonapp</code>. Let’s create a network</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>docker network create anetwork</code></pre></div></div><p>To add container to network use <code class=\"language-plaintext highlighter-rouge\">docker network connect</code></p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>docker network connect anetwork mysqldocker network connect anetwork pythonapp</code></pre></div></div><p><img src=\"/assets/blog/2016-10-08-DockerNetworkBetweenContainer/docker-network-connect.gif\" width=\"80%\" /></p><p>That’s it, now two container can communicate with each other.</p>",
            "url": "https://babal.dev/2016/10/08/docker-network-between-container",
            
            
            
            
            
            "date_published": "2016-10-08T00:00:00-04:00",
            "date_modified": "2016-10-08T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/10/07/getting-familier-with-find",
            "title": "Getting familiar with Linux find command",
            "summary": "Search and locate files/directories using find command",
            "content_text": "The find command is one of the most important and much used command in Linux systems. find command is used to search and locate list of files and directories based on conditions you specify for files that match the arguments. In this article we will get familier with linux find command.First things first, to get more knowledge on any linux command we can use linux manual page using man &lt;command_name&gt;. For more information about find you can use man find and you’ll get in depth description on how we can use linux command.Basic use of find looks somewhat like belowfind .Let’s get familier which the syntax of find. In above example we have two parts  find : find is the command itself  . : . (dot) represents the path from where we want to search. We can pass any path here and find will start to look from the path what was provided.If you run the command, you will get list of all the files and directories that is inside the path that was given as argument.But I assume you don’t want to search for all files. You may want to search for file from / directories that has specific name. To seach for specific file / directories we can use -name option. Here’s an example of find which search for the file / directories with the name .gitignorefind . -name '.gitignore'# OUTPUT./.gitignoreYou can see that we are using . here. If you wanted to start search from root you are free to pass / as you seach directory.Did you notice that I kept on saying search for file or directories. By default find will try to match the option of -name on both directories and files. If you want to limit your search for file or directories you can use -type option.find . -type d -name 'img'# OUTPUT./_site/img./imgIf you pass d argument on -type option your search will limit to directories only.find . -type f -name '.gitignore'# OUTPUT./.gitignoreIf you pass f argument on -type option your search will limit to files.Linux system are case sensitive. What if you want to seach file ignoring the case. -iname can be use to do just that.find . -iname '.gitignore'You can also search file with certain extention. Let’s search file with .css extentionfind . -type f -name '*.css'# OUTPUT./css/bootstrap-theme.css./css/pygment_highlights.css./css/main-minimal.css./css/bootstrap.css./css/bootstrap.min.css./css/normalize.css./css/bootstrap-theme.min.css./css/main.cssWe can use * to indicate any character. We can also search files with multiple extention. Suppose you want to search file with .css and .html. You can do that withfind . -name '*.css' -or -name '*.html'# OUTPUT./_layouts/post.html./_layouts/default.html./_layouts/page.html./_layouts/base.html./index.html./css/bootstrap-theme.css./css/pygment_highlights.css./css/main-minimal.css./css/bootstrap.css./css/bootstrap.min.css./css/normalize.css./css/bootstrap-theme.min.css./css/main.cssNotice how we are joining the option -name in above syntax using -or. -or can be used with its alias -o You may have guessed that we can use -and too. Here’s an example of find using -and.# find . -name 'm*' -name '*.css'find . -name 'm*' -and -name '*.css'# OUTPUT./_site/css/main-minimal.css./_site/css/main.css./css/main-minimal.css./css/main.cssNow that you know about -or and -and, you may have imagined endless possibilities of search patterns. Just a quick note, if you use two -name without -and on above example it would act as -and. Quick hint !! you have -not option too. -not can be used with its alias !. -or , -and and -not can be used with other option too.You can also control how deep you want to search usign -maxdepthfind . -maxdepth 1 -name '*.html'# OUTPUT./index.htmlYou can use find to search the files / directories based on modified, changed or accessed days and minutes.For days you have -mtime, -atime, -ctime and for minutes you have -mmin, -amin, -cmin. Option prefixed with m denotes modified, a denotes accessed and c denotes changed.find . -mtime 20find . -atime 20find . -ctime 20find . -mmin 20find . -amin 20find . -cmin 20We can also use + and - symbol number provied. For examplefind . -mtime +5Above command  find the file which was not modified in last 5 days.find . -mtime -5Above command  find the file which was modified within last 5 days.You can also go for range of days and minutes. Here’s an examplefind . -mtime +5 -mtime -10Above command finds the files / directories that are modifined between 5 to 10 daysfind . -mmin +5 -mtime -10Above command finds the files / directories that are modifined between 5 to 10 minutes.To search the file that has specific size you can use -size optionfind . -type f -size 2MAbove command search file that has exactly 50M. We can also use + and - symbol on the number here. For examplefind . -type f -size -2MThis command will find the files that has size of 2MB and lessFor range you can dofind . -type f -size +2M -size -10MTo find empty file or directory you can use -empty optionfind . -emptyfind also has option -user, -group and -perm which lets you search the file that is associated with specific user, group or if the file has certain permission.You can also perform certain operation on the files / directories that are searched and found using -exec option.For this example here is the list of files and dir that I have-rw-rw-r--  1 aman aman    0 Oct  7 10:30 four.html-rw-rw-r--  1 aman aman    0 Oct  7 10:30 one.txtdrwxrwxr-x  2 aman aman 4096 Oct  7 10:31 somedir-rw-rw-r--  1 aman aman    0 Oct  7 10:30 three.txt-rw-rw-r--  1 aman aman    0 Oct  7 10:30 two.phpTo rename the two.php to two.html you can issue following commandfind . -type f -name 'two.php' -exec mv -f {} two.html \\;# ls -l-rw-rw-r--  1 aman aman    0 Oct  7 10:30 four.html-rw-rw-r--  1 aman aman    0 Oct  7 10:30 one.txtdrwxrwxr-x  2 aman aman 4096 Oct  7 10:31 somedir-rw-rw-r--  1 aman aman    0 Oct  7 10:30 three.txt-rw-rw-r--  1 aman aman    0 Oct  7 10:30 two.htmlLet’s explain what -exec is performing. After -exec we are writing the command that we want to execute. In our example we wanted to change two.php to two.html. Notice we are using {} placeholder in source section. To end the -exec command we are using \\;.I know on destination we used static text. What if we want to use change all html files to php now. Here’s the commandfind . -type f -name '*.html' -exec bash -c 'mv \"$1\" \"${1%.html}\".php' - {} \\;Now that’s a complex command. Let’s me explain what’s happening.First we are passing bash -c '&lt;command_to_execute_inside_bash&gt;' - &lt;param_to_send&gt; on -exec. The command will execute for each entry that is found by find command. If find finds 5 files with *.html it will run the command 5 times.Lets look at the command that we passed for execution i.e mv \"$1\" \"${1%.html}\".php.$1 is the first argument that was passed to command. For example if we have 2 file with html extention. It will send 1st file found to command as its 1st argument and command execution will take place. Then, it goes for 2nd find found and will again pass the file name as its 1st argument.So if we have two file one.html and two.html our find command will find the one.html first and it will execute our command which argument one.html. So on first execution $1 value will be one.html and on second execution $1 will be two.htmlNext we have \"${1%.html}\".php. In a simple term if $1 represents one.html then \"${1%.html}\" will represent one. So \"${1%.html}\".php will represent one.php. Visit Bash Referrence Manural for more detail.If we have two file one.html and two.html. When our command execute the first time ti will look like bash -c 'mv one.html one.php' and second time bash -c 'mv two.html two.php'.Here’s the output-rw-rw-r-- 1 aman aman    0 Oct  7 10:30 four.php-rw-rw-r-- 1 aman aman    0 Oct  7 10:30 one.txtdrwxrwxr-x 2 aman aman 4.0K Oct  7 10:31 somedir-rw-rw-r-- 1 aman aman    0 Oct  7 10:30 three.txt-rw-rw-r-- 1 aman aman    0 Oct  7 10:30 two.phpfind is very handy command and I hope this article helped you get an insight on how you can use find to search files and directories you need.",
            "content_html": "<p>The <code class=\"language-plaintext highlighter-rouge\">find</code> command is one of the most important and much used command in Linux systems. <code class=\"language-plaintext highlighter-rouge\">find</code> command is used to search and locate list of files and directories based on conditions you specify for files that match the arguments. In this article we will get familier with linux <code class=\"language-plaintext highlighter-rouge\">find</code> command.</p><p>First things first, to get more knowledge on any linux command we can use linux manual page using <code class=\"language-plaintext highlighter-rouge\">man &lt;command_name&gt;</code>. For more information about find you can use <code class=\"language-plaintext highlighter-rouge\">man find</code> and you’ll get in depth description on how we can use linux command.</p><p>Basic use of find looks somewhat like below</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span></code></pre></div></div><p>Let’s get familier which the syntax of <code class=\"language-plaintext highlighter-rouge\">find</code>. In above example we have two parts</p><ol>  <li><code class=\"language-plaintext highlighter-rouge\">find</code> : find is the command itself</li>  <li><code class=\"language-plaintext highlighter-rouge\">.</code> : <code class=\"language-plaintext highlighter-rouge\">.</code> (dot) represents the path from where we want to search. We can pass any path here and find will start to look from the path what was provided.</li></ol><p>If you run the command, you will get list of all the files and directories that is inside the path that was given as argument.</p><p>But I assume you don’t want to search for all files. You may want to search for file from <code class=\"language-plaintext highlighter-rouge\">/</code> directories that has specific name. To seach for specific file <code class=\"language-plaintext highlighter-rouge\">/</code> directories we can use <code class=\"language-plaintext highlighter-rouge\">-name option</code>. Here’s an example of <code class=\"language-plaintext highlighter-rouge\">find</code> which search for the file <code class=\"language-plaintext highlighter-rouge\">/</code> directories with the name <code class=\"language-plaintext highlighter-rouge\">.gitignore</code></p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-name</span> <span class=\"s1\">'.gitignore'</span><span class=\"c\"># OUTPUT</span>./.gitignore</code></pre></div></div><p>You can see that we are using <code class=\"language-plaintext highlighter-rouge\">.</code> here. If you wanted to start search from root you are free to pass <code class=\"language-plaintext highlighter-rouge\">/</code> as you seach directory.</p><p>Did you notice that I kept on saying search for file or directories. By default <code class=\"language-plaintext highlighter-rouge\">find</code> will try to match the option of <code class=\"language-plaintext highlighter-rouge\">-name</code> on both directories and files. If you want to limit your search for file or directories you can use <code class=\"language-plaintext highlighter-rouge\">-type</code> option.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-type</span> d <span class=\"nt\">-name</span> <span class=\"s1\">'img'</span><span class=\"c\"># OUTPUT</span>./_site/img./img</code></pre></div></div><p>If you pass <code class=\"language-plaintext highlighter-rouge\">d</code> argument on <code class=\"language-plaintext highlighter-rouge\">-type</code> option your search will limit to directories only.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-type</span> f <span class=\"nt\">-name</span> <span class=\"s1\">'.gitignore'</span><span class=\"c\"># OUTPUT</span>./.gitignore</code></pre></div></div><p>If you pass <code class=\"language-plaintext highlighter-rouge\">f</code> argument on <code class=\"language-plaintext highlighter-rouge\">-type</code> option your search will limit to files.</p><p>Linux system are case sensitive. What if you want to seach file ignoring the case. <code class=\"language-plaintext highlighter-rouge\">-iname</code> can be use to do just that.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-iname</span> <span class=\"s1\">'.gitignore'</span></code></pre></div></div><p>You can also search file with certain extention. Let’s search file with <code class=\"language-plaintext highlighter-rouge\">.css</code> extention</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-type</span> f <span class=\"nt\">-name</span> <span class=\"s1\">'*.css'</span><span class=\"c\"># OUTPUT</span>./css/bootstrap-theme.css./css/pygment_highlights.css./css/main-minimal.css./css/bootstrap.css./css/bootstrap.min.css./css/normalize.css./css/bootstrap-theme.min.css./css/main.css</code></pre></div></div><p>We can use <code class=\"language-plaintext highlighter-rouge\">*</code> to indicate any character. We can also search files with multiple extention. Suppose you want to search file with <code class=\"language-plaintext highlighter-rouge\">.css</code> and <code class=\"language-plaintext highlighter-rouge\">.html</code>. You can do that with</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-name</span> <span class=\"s1\">'*.css'</span> <span class=\"nt\">-or</span> <span class=\"nt\">-name</span> <span class=\"s1\">'*.html'</span><span class=\"c\"># OUTPUT</span>./_layouts/post.html./_layouts/default.html./_layouts/page.html./_layouts/base.html./index.html./css/bootstrap-theme.css./css/pygment_highlights.css./css/main-minimal.css./css/bootstrap.css./css/bootstrap.min.css./css/normalize.css./css/bootstrap-theme.min.css./css/main.css</code></pre></div></div><p>Notice how we are joining the option <code class=\"language-plaintext highlighter-rouge\">-name</code> in above syntax using <code class=\"language-plaintext highlighter-rouge\">-or</code>. <code class=\"language-plaintext highlighter-rouge\">-or</code> can be used with its alias <code class=\"language-plaintext highlighter-rouge\">-o</code> You may have guessed that we can use <code class=\"language-plaintext highlighter-rouge\">-and</code> too. Here’s an example of <code class=\"language-plaintext highlighter-rouge\">find</code> using <code class=\"language-plaintext highlighter-rouge\">-and</code>.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># find . -name 'm*' -name '*.css'</span>find <span class=\"nb\">.</span> <span class=\"nt\">-name</span> <span class=\"s1\">'m*'</span> <span class=\"nt\">-and</span> <span class=\"nt\">-name</span> <span class=\"s1\">'*.css'</span><span class=\"c\"># OUTPUT</span>./_site/css/main-minimal.css./_site/css/main.css./css/main-minimal.css./css/main.css</code></pre></div></div><p>Now that you know about <code class=\"language-plaintext highlighter-rouge\">-or</code> and <code class=\"language-plaintext highlighter-rouge\">-and</code>, you may have imagined endless possibilities of search patterns. Just a quick note, if you use two <code class=\"language-plaintext highlighter-rouge\">-name</code> without <code class=\"language-plaintext highlighter-rouge\">-and</code> on above example it would act as <code class=\"language-plaintext highlighter-rouge\">-and</code>. Quick hint !! you have <code class=\"language-plaintext highlighter-rouge\">-not</code> option too. <code class=\"language-plaintext highlighter-rouge\">-not</code> can be used with its alias <code class=\"language-plaintext highlighter-rouge\">!</code>. <code class=\"language-plaintext highlighter-rouge\">-or</code> , <code class=\"language-plaintext highlighter-rouge\">-and</code> and <code class=\"language-plaintext highlighter-rouge\">-not</code> can be used with other option too.</p><p>You can also control how deep you want to search usign <code class=\"language-plaintext highlighter-rouge\">-maxdepth</code></p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-maxdepth</span> 1 <span class=\"nt\">-name</span> <span class=\"s1\">'*.html'</span><span class=\"c\"># OUTPUT</span>./index.html</code></pre></div></div><p>You can use <code class=\"language-plaintext highlighter-rouge\">find</code> to search the files / directories based on modified, changed or accessed days and minutes.</p><p>For days you have <code class=\"language-plaintext highlighter-rouge\">-mtime</code>, <code class=\"language-plaintext highlighter-rouge\">-atime</code>, <code class=\"language-plaintext highlighter-rouge\">-ctime</code> and for minutes you have <code class=\"language-plaintext highlighter-rouge\">-mmin</code>, <code class=\"language-plaintext highlighter-rouge\">-amin</code>, <code class=\"language-plaintext highlighter-rouge\">-cmin</code>. Option prefixed with <code class=\"language-plaintext highlighter-rouge\">m</code> denotes modified, <code class=\"language-plaintext highlighter-rouge\">a</code> denotes accessed and <code class=\"language-plaintext highlighter-rouge\">c</code> denotes changed.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-mtime</span> 20find <span class=\"nb\">.</span> <span class=\"nt\">-atime</span> 20find <span class=\"nb\">.</span> <span class=\"nt\">-ctime</span> 20find <span class=\"nb\">.</span> <span class=\"nt\">-mmin</span> 20find <span class=\"nb\">.</span> <span class=\"nt\">-amin</span> 20find <span class=\"nb\">.</span> <span class=\"nt\">-cmin</span> 20</code></pre></div></div><p>We can also use <code class=\"language-plaintext highlighter-rouge\">+</code> and <code class=\"language-plaintext highlighter-rouge\">-</code> symbol number provied. For example</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-mtime</span> +5</code></pre></div></div><p>Above command  find the file which was not modified in last 5 days.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-mtime</span> <span class=\"nt\">-5</span></code></pre></div></div><p>Above command  find the file which was modified within last 5 days.</p><p>You can also go for range of days and minutes. Here’s an example</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-mtime</span> +5 <span class=\"nt\">-mtime</span> <span class=\"nt\">-10</span></code></pre></div></div><p>Above command finds the files / directories that are modifined between 5 to 10 days</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-mmin</span> +5 <span class=\"nt\">-mtime</span> <span class=\"nt\">-10</span></code></pre></div></div><p>Above command finds the files / directories that are modifined between 5 to 10 minutes.</p><p>To search the file that has specific size you can use <code class=\"language-plaintext highlighter-rouge\">-size</code> option</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-type</span> f <span class=\"nt\">-size</span> 2M</code></pre></div></div><p>Above command search file that has exactly 50M. We can also use <code class=\"language-plaintext highlighter-rouge\">+</code> and <code class=\"language-plaintext highlighter-rouge\">-</code> symbol on the number here. For example</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-type</span> f <span class=\"nt\">-size</span> <span class=\"nt\">-2M</span></code></pre></div></div><p>This command will find the files that has size of 2MB and less</p><p>For range you can do</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-type</span> f <span class=\"nt\">-size</span> +2M <span class=\"nt\">-size</span> <span class=\"nt\">-10M</span></code></pre></div></div><p>To find empty file or directory you can use <code class=\"language-plaintext highlighter-rouge\">-empty</code> option</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-empty</span></code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">find</code> also has option <code class=\"language-plaintext highlighter-rouge\">-user</code>, <code class=\"language-plaintext highlighter-rouge\">-group</code> and <code class=\"language-plaintext highlighter-rouge\">-perm</code> which lets you search the file that is associated with specific user, group or if the file has certain permission.</p><p>You can also perform certain operation on the files / directories that are searched and found using <code class=\"language-plaintext highlighter-rouge\">-exec</code> option.</p><p>For this example here is the list of files and dir that I have</p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>-rw-rw-r--  1 aman aman    0 Oct  7 10:30 four.html-rw-rw-r--  1 aman aman    0 Oct  7 10:30 one.txtdrwxrwxr-x  2 aman aman 4096 Oct  7 10:31 somedir-rw-rw-r--  1 aman aman    0 Oct  7 10:30 three.txt-rw-rw-r--  1 aman aman    0 Oct  7 10:30 two.php</code></pre></div></div><p>To rename the two.php to two.html you can issue following command</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-type</span> f <span class=\"nt\">-name</span> <span class=\"s1\">'two.php'</span> <span class=\"nt\">-exec</span> <span class=\"nb\">mv</span> <span class=\"nt\">-f</span> <span class=\"o\">{}</span> two.html <span class=\"se\">\\;</span><span class=\"c\"># ls -l</span><span class=\"nt\">-rw-rw-r--</span>  1 aman aman    0 Oct  7 10:30 four.html<span class=\"nt\">-rw-rw-r--</span>  1 aman aman    0 Oct  7 10:30 one.txtdrwxrwxr-x  2 aman aman 4096 Oct  7 10:31 somedir<span class=\"nt\">-rw-rw-r--</span>  1 aman aman    0 Oct  7 10:30 three.txt<span class=\"nt\">-rw-rw-r--</span>  1 aman aman    0 Oct  7 10:30 two.html</code></pre></div></div><p>Let’s explain what <code class=\"language-plaintext highlighter-rouge\">-exec</code> is performing. After <code class=\"language-plaintext highlighter-rouge\">-exec</code> we are writing the command that we want to execute. In our example we wanted to change <code class=\"language-plaintext highlighter-rouge\">two.php</code> to <code class=\"language-plaintext highlighter-rouge\">two.html</code>. Notice we are using <code class=\"language-plaintext highlighter-rouge\">{}</code> placeholder in <strong>source</strong> section. To end the <code class=\"language-plaintext highlighter-rouge\">-exec</code> command we are using <code class=\"language-plaintext highlighter-rouge\">\\;</code>.</p><p>I know on destination we used static text. What if we want to use change all <code class=\"language-plaintext highlighter-rouge\">html</code> files to <code class=\"language-plaintext highlighter-rouge\">php</code> now. Here’s the command</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>find <span class=\"nb\">.</span> <span class=\"nt\">-type</span> f <span class=\"nt\">-name</span> <span class=\"s1\">'*.html'</span> <span class=\"nt\">-exec</span> bash <span class=\"nt\">-c</span> <span class=\"s1\">'mv \"$1\" \"${1%.html}\".php'</span> - <span class=\"o\">{}</span> <span class=\"se\">\\;</span></code></pre></div></div><p>Now that’s a complex command. Let’s me explain what’s happening.</p><p>First we are passing <code class=\"language-plaintext highlighter-rouge\">bash -c '&lt;command_to_execute_inside_bash&gt;' - &lt;param_to_send&gt;</code> on <code class=\"language-plaintext highlighter-rouge\">-exec</code>. The command will execute for each entry that is found by <code class=\"language-plaintext highlighter-rouge\">find</code> command. If find finds 5 files with <code class=\"language-plaintext highlighter-rouge\">*.html</code> it will run the command 5 times.</p><p>Lets look at the command that we passed for execution i.e <code class=\"language-plaintext highlighter-rouge\">mv \"$1\" \"${1%.html}\".php</code>.</p><p><code class=\"language-plaintext highlighter-rouge\">$1</code> is the first argument that was passed to command. For example if we have 2 file with html extention. It will send 1st file found to command as its 1st argument and command execution will take place. Then, it goes for 2nd find found and will again pass the file name as its 1st argument.So if we have two file <code class=\"language-plaintext highlighter-rouge\">one.html</code> and <code class=\"language-plaintext highlighter-rouge\">two.html</code> our <code class=\"language-plaintext highlighter-rouge\">find</code> command will find the <code class=\"language-plaintext highlighter-rouge\">one.html</code> first and it will execute our command which argument <code class=\"language-plaintext highlighter-rouge\">one.html</code>. So on first execution <code class=\"language-plaintext highlighter-rouge\">$1</code> value will be <code class=\"language-plaintext highlighter-rouge\">one.html</code> and on second execution <code class=\"language-plaintext highlighter-rouge\">$1</code> will be <code class=\"language-plaintext highlighter-rouge\">two.html</code></p><p>Next we have <code class=\"language-plaintext highlighter-rouge\">\"${1%.html}\".php</code>. In a simple term if <code class=\"language-plaintext highlighter-rouge\">$1</code> represents <code class=\"language-plaintext highlighter-rouge\">one.html</code> then <code class=\"language-plaintext highlighter-rouge\">\"${1%.html}\"</code> will represent <code class=\"language-plaintext highlighter-rouge\">one</code>. So <code class=\"language-plaintext highlighter-rouge\">\"${1%.html}\".php</code> will represent <code class=\"language-plaintext highlighter-rouge\">one.php</code>. Visit <a href=\"http://www.gnu.org/software/bash/manual/bashref.html#Shell-Parameter-Expansion\">Bash Referrence Manural</a> for more detail.</p><p>If we have two file <code class=\"language-plaintext highlighter-rouge\">one.html</code> and <code class=\"language-plaintext highlighter-rouge\">two.html</code>. When our command execute the first time ti will look like <code class=\"language-plaintext highlighter-rouge\">bash -c 'mv one.html one.php'</code> and second time <code class=\"language-plaintext highlighter-rouge\">bash -c 'mv two.html two.php'</code>.</p><p>Here’s the output</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">-rw-rw-r--</span> 1 aman aman    0 Oct  7 10:30 four.php<span class=\"nt\">-rw-rw-r--</span> 1 aman aman    0 Oct  7 10:30 one.txtdrwxrwxr-x 2 aman aman 4.0K Oct  7 10:31 somedir<span class=\"nt\">-rw-rw-r--</span> 1 aman aman    0 Oct  7 10:30 three.txt<span class=\"nt\">-rw-rw-r--</span> 1 aman aman    0 Oct  7 10:30 two.php</code></pre></div></div><p><code class=\"language-plaintext highlighter-rouge\">find</code> is very handy command and I hope this article helped you get an insight on how you can use <code class=\"language-plaintext highlighter-rouge\">find</code> to search files and directories you need.</p>",
            "url": "https://babal.dev/2016/10/07/getting-familier-with-find",
            
            
            
            "tags": ["linux","shell"],
            
            "date_published": "2016-10-07T00:00:00-04:00",
            "date_modified": "2016-10-07T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/10/04/bash-useful-shortcuts",
            "title": "Bash Shortcuts",
            "summary": "Useful shortcuts that we can use on Bash",
            "content_text": "Most of us are familiar with executing commands on terminal. But, did you now that bash has set of convinent shortcuts that can make our life a lot more easier.Sometimes when we are typing command and all of a sudden we forget to add sudo. We can press CTRL + a and goto start of command line then type sudoNow we are at the middle and we want to complete our command. Pressing CTRL + e will move your cursor to End of lineWhen we try to install VLC we forget to add -y on our command. We know how to move cursor in the beginning but, how do we move cursor back a word. Don’t worry bash has just the shortcut we need. If you want to traverse back a word at a time you can press ALT + bIn above GIF you can see that cursor is moved back twice. Hmm. All things looks good now. But WAIT!!!! We want to install GIT before VLC (consider it as dependency). We need to move cursor foward a word. We can press ALT + fAll of sudden you don’t want to install VLC now. Cursor is at beginning of vlc. To delete the line after the cursor we can use CTRL + k.Hmm. now we don’t want to install GIT either. Since your cursor is at end we can use CTRL + w to delete just one word before the cursor.We don’t know what to install now. To delete remaining incomplete command you can use CTRL + uSearching HistoryLets see how we can search through history. For demonstration here is the list of history that I havePressing CTRL + p will navigate back to history.You may have guessed to go foward we have CTRL + nCTRL + p and CTRL + n is handy shortcut but often when we search our history we may know letter / word the command starts with. Lets say we want to search history that start with command. Type command on terminal and pressing ALT + p will go back one history which starts with letter / word that is provided in our case command.Similarly pressing ALT + n will navigate foward one history which starts with letter / word that is provided.When we search through history we may not know how command is started. But, we may have a know some letters / word that the command has. In that case we can use CTRL + r to search history. Pressing CTRL + r will search the history and checks if the letters / word you provided is avaiable on any part of the command. Suppose you have a command like belowbundle exec jekyll serveTo search this command you can press CTRL + r and press any letters / word that is present on command. For example we can search by using word jekyll.We may not find the command right away. We can go back a history again by pressing CTRL + r. If you want to move foward you can use CTRL + s.Here’s the simple example of moving backward and foward a history. (Using the history that was shown above)Notice in above GIF when I was traversing back to history [CTRL + r], we can see text bck-i-search. And when I was traversing foward to history [CTRL + s], we can see text fwd-i-searchLet me know if you found this post useful. If I missed some cool shortcut that bash provides please add it in the comment below.Source  howtogeek",
            "content_html": "<p>Most of us are familiar with executing commands on terminal. But, did you now that bash has set of convinent shortcuts that can make our life a lot more easier.</p><p>Sometimes when we are typing command and all of a sudden we forget to add <strong>sudo</strong>. We can press <code class=\"language-plaintext highlighter-rouge\">CTRL + a</code> and goto start of command line then type <strong>sudo</strong></p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-a.gif\" width=\"40%\" /></p><p>Now we are at the middle and we want to complete our command. Pressing <code class=\"language-plaintext highlighter-rouge\">CTRL + e</code> will move your cursor to End of line</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-e.gif\" width=\"40%\" /></p><p>When we try to install <code class=\"language-plaintext highlighter-rouge\">VLC</code> we forget to add <code class=\"language-plaintext highlighter-rouge\">-y</code> on our command. We know how to move cursor in the beginning but, how do we move cursor back a word. Don’t worry <code class=\"language-plaintext highlighter-rouge\">bash</code> has just the shortcut we need. If you want to traverse back a word at a time you can press <code class=\"language-plaintext highlighter-rouge\">ALT + b</code></p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/alt-b.gif\" width=\"40%\" /></p><p>In above <em>GIF</em> you can see that cursor is moved back twice. Hmm. All things looks good now. But <strong><code class=\"language-plaintext highlighter-rouge\">WAIT!!!!</code></strong> We want to install <code class=\"language-plaintext highlighter-rouge\">GIT</code> before <code class=\"language-plaintext highlighter-rouge\">VLC</code> (consider it as dependency). We need to move cursor foward a word. We can press <code class=\"language-plaintext highlighter-rouge\">ALT + f</code></p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/alt-f.gif\" width=\"40%\" /></p><p>All of sudden you don’t want to install <code class=\"language-plaintext highlighter-rouge\">VLC</code> now. Cursor is at beginning of <strong>vlc</strong>. To delete the line after the cursor we can use <code class=\"language-plaintext highlighter-rouge\">CTRL + k</code>.</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-k.gif\" width=\"40%\" /></p><p>Hmm. now we don’t want to install <code class=\"language-plaintext highlighter-rouge\">GIT</code> either. Since your cursor is at end we can use <code class=\"language-plaintext highlighter-rouge\">CTRL + w</code> to delete just one word before the cursor.</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-w.gif\" width=\"40%\" /></p><p>We don’t know what to install now. To delete remaining incomplete command you can use <code class=\"language-plaintext highlighter-rouge\">CTRL + u</code></p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-u.gif\" width=\"40%\" /></p><hr /><h3 id=\"searching-history\">Searching History</h3><p>Lets see how we can search through history. For demonstration here is the list of history that I have</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/series-of-history.png\" width=\"30%\" /></p><p>Pressing <code class=\"language-plaintext highlighter-rouge\">CTRL + p</code> will navigate back to history.</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-p.gif\" width=\"40%\" /></p><p>You may have guessed to go foward we have <code class=\"language-plaintext highlighter-rouge\">CTRL + n</code></p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-n.gif\" width=\"40%\" /></p><p><code class=\"language-plaintext highlighter-rouge\">CTRL + p</code> and <code class=\"language-plaintext highlighter-rouge\">CTRL + n</code> is handy shortcut but often when we search our history we may know <code class=\"language-plaintext highlighter-rouge\">letter / word</code> the command starts with. Lets say we want to search history that start with <code class=\"language-plaintext highlighter-rouge\">command</code>. Type <code class=\"language-plaintext highlighter-rouge\">command</code> on terminal and pressing <code class=\"language-plaintext highlighter-rouge\">ALT + p</code> will go back one history which starts with <code class=\"language-plaintext highlighter-rouge\">letter / word</code> that is provided in our case <code class=\"language-plaintext highlighter-rouge\">command</code>.</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/alt-p.gif\" width=\"40%\" /></p><p>Similarly pressing <code class=\"language-plaintext highlighter-rouge\">ALT + n</code> will navigate foward one history which starts with <code class=\"language-plaintext highlighter-rouge\">letter / word</code> that is provided.</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/alt-n.gif\" width=\"40%\" /></p><p>When we search through history we may not know how command is started. But, we may have a know some <code class=\"language-plaintext highlighter-rouge\">letters / word</code> that the command has. In that case we can use <code class=\"language-plaintext highlighter-rouge\">CTRL + r</code> to search history. Pressing <code class=\"language-plaintext highlighter-rouge\">CTRL + r</code> will search the history and checks if the <code class=\"language-plaintext highlighter-rouge\">letters / word</code> you provided is avaiable on any part of the command. Suppose you have a command like below</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>bundle <span class=\"nb\">exec </span>jekyll serve</code></pre></div></div><p>To search this command you can press <code class=\"language-plaintext highlighter-rouge\">CTRL + r</code> and press any <code class=\"language-plaintext highlighter-rouge\">letters / word</code> that is present on command. For example we can search by using word <strong>jekyll</strong>.</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-r.gif\" width=\"40%\" /></p><p>We may not find the command right away. We can go back a history again by pressing <code class=\"language-plaintext highlighter-rouge\">CTRL + r</code>. If you want to move foward you can use <code class=\"language-plaintext highlighter-rouge\">CTRL + s</code>.</p><p>Here’s the simple example of moving <strong>backward</strong> and <strong>foward</strong> a history. (Using the history that was shown above)</p><p><img src=\"/assets/blog/2016-10-04-BashShortcuts/ctrl-rNs.gif\" width=\"40%\" /></p><p>Notice in above <em>GIF</em> when I was traversing back to history [<code class=\"language-plaintext highlighter-rouge\">CTRL + r</code>], we can see text <code class=\"language-plaintext highlighter-rouge\">bck-i-search</code>. And when I was traversing foward to history [<code class=\"language-plaintext highlighter-rouge\">CTRL + s</code>], we can see text <code class=\"language-plaintext highlighter-rouge\">fwd-i-search</code></p><hr /><p>Let me know if you found this post useful. If I missed some cool shortcut that bash provides please add it in the comment below.</p><hr /><h3 id=\"source\">Source</h3><ul>  <li><a href=\"http://www.howtogeek.com/howto/ubuntu/keyboard-shortcuts-for-bash-command-shell-for-ubuntu-debian-suse-redhat-linux-etc/\">howtogeek</a></li></ul>",
            "url": "https://babal.dev/2016/10/04/bash-useful-shortcuts",
            
            
            
            "tags": ["linux","shell"],
            
            "date_published": "2016-10-04T00:00:00-04:00",
            "date_modified": "2016-10-04T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/10/03/debugging-java-application",
            "title": "Debugging Java Application Running on Docker",
            "summary": "Remote Debugging Java Application like a boss",
            "content_text": "In this post I will explain how you can debugging Java Application that is running on Docker like a boss. To be precise I will explain how we can debug the application that uses Maven. I will show you how we can attach our debugger on IntelliJ Idea.Let’s assume we have a SpringBoot Application. To run our application we use mvn spring-boot:run. If we were to use IDE directly to run our application, we can directly use debugging feature provided by IDE. But, when we run our application on Docker we execute our application with help of command [mvn spring-boot:run].When we use IDE to debug our application it adds some meta-data information on run command. The meta-data information to be precise is a JVM Arguments. This is what JVM Arguments looks like:-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005To send this meta-data information [i.e JVM Arguments] when we run our application, we need to do something like below :mvn spring-boot:run -Drun.jvmArguments=\"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005\"You can see that we are sending those meta information with help of -Drun.jvmArguments.Options on agentlib:jdwp  transport=dt_socket  means the way used to connect to JVM.  address=5005 : TCP/IP port exposed, to connect from the debugger  suspend=y : if y, tell the JVM to wait until debugger is attached to begin execution, otherwise (if n), starts execution right away.Debugging with IntelliJ IdeaOpen IntelliJ Idea and Go to Edit Coniguration ( Run &gt; Edit Configuration)Click + Icon. [Alt + Insert] then Type remote and select RemoteYou will see dialog like below.From the information you can see that I copied the Remote Debugging information from this dialog. If you didn’t change any of the option from previous section you are good to go.Just a quick note though, on Host if you are using Linux 'localhost' will work but, if you are on Windows / Mac replace localhost with IP Docker Machine is running on. Before you click Debug make sure you already executed your application with meta information.If you change the address option when you added meta information just replace the port number with same.You should be able to debug your application. If you were stuck on some step please comment below.Some references  Remote Debugging Maven Spring Boot  Remote Debugging Options",
            "content_html": "<p>In this post I will explain how you can <strong>debugging Java Application</strong> that is running on <strong>Docker</strong> like a <strong><code class=\"language-plaintext highlighter-rouge\">boss</code></strong>. To be precise I will explain how we can debug the application that uses <code class=\"language-plaintext highlighter-rouge\">Maven</code>. I will show you how we can attach our debugger on <code class=\"language-plaintext highlighter-rouge\">IntelliJ Idea</code>.</p><p>Let’s assume we have a <code class=\"language-plaintext highlighter-rouge\">SpringBoot Application</code>. To run our application we use <code class=\"language-plaintext highlighter-rouge\">mvn spring-boot:run</code>. If we were to use <code class=\"language-plaintext highlighter-rouge\">IDE</code> directly to run our application, we can directly use <code class=\"language-plaintext highlighter-rouge\">debugging</code> feature provided by <code class=\"language-plaintext highlighter-rouge\">IDE</code>. But, when we run our application on <code class=\"language-plaintext highlighter-rouge\">Docker</code> we execute our application with help of <code class=\"language-plaintext highlighter-rouge\">command [mvn spring-boot:run]</code>.</p><p>When we use <code class=\"language-plaintext highlighter-rouge\">IDE</code> to debug our application it <em>adds</em> some <em>meta-data</em> information on <em>run</em> command. The <em>meta-data</em> information to be precise is a <code class=\"language-plaintext highlighter-rouge\">JVM Arguments</code>. This is what <strong>JVM Arguments</strong> looks like:</p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005</code></pre></div></div><p>To send this meta-data information [i.e JVM Arguments] when we run our application, we need to do something like below :</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>mvn spring-boot:run <span class=\"nt\">-Drun</span>.jvmArguments<span class=\"o\">=</span><span class=\"s2\">\"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005\"</span></code></pre></div></div><p>You can see that we are sending those meta information with help of <code class=\"language-plaintext highlighter-rouge\">-Drun.jvmArguments</code>.</p><h3 id=\"options-on-agentlibjdwp\">Options on <code class=\"language-plaintext highlighter-rouge\">agentlib:jdwp</code></h3><ul>  <li><code class=\"language-plaintext highlighter-rouge\">transport=dt_socket</code>  means the way used to connect to JVM.</li>  <li><code class=\"language-plaintext highlighter-rouge\">address=5005</code> : <strong>TCP/IP</strong> port exposed, to connect from the debugger</li>  <li><code class=\"language-plaintext highlighter-rouge\">suspend=y</code> : if <strong><code class=\"language-plaintext highlighter-rouge\">y</code></strong>, tell the JVM to wait until debugger is attached to begin execution, otherwise (if <strong><code class=\"language-plaintext highlighter-rouge\">n</code></strong>), starts execution right away.</li></ul><h3 id=\"debugging-with-intellij-idea\">Debugging with <code class=\"language-plaintext highlighter-rouge\">IntelliJ Idea</code></h3><p>Open <code class=\"language-plaintext highlighter-rouge\">IntelliJ Idea</code> and Go to <code class=\"language-plaintext highlighter-rouge\">Edit Coniguration</code> ( Run &gt; Edit Configuration)</p><p><img height=\"200px\" width=\"500px\" src=\"/assets/blog/2016-10-03-remote-debugging/01-edit-configuration.png\" alt=\"Edit Configuration PNG\" /></p><p>Click <code class=\"language-plaintext highlighter-rouge\">+</code> Icon. [Alt + Insert] then Type <code class=\"language-plaintext highlighter-rouge\">remote</code> and select <code class=\"language-plaintext highlighter-rouge\">Remote</code><img height=\"200px\" width=\"500px\" src=\"/assets/blog/2016-10-03-remote-debugging/02-select-remote.png\" alt=\"Select Remote PNG\" /></p><p>You will see dialog like below.<img height=\"200px\" width=\"500px\" src=\"/assets/blog/2016-10-03-remote-debugging/03-remote-option.png\" alt=\"Remote Option PNG\" /></p><p>From the information you can see that I copied the <code class=\"language-plaintext highlighter-rouge\">Remote Debugging</code> information from this dialog. If you didn’t change any of the option from previous section you are good to go.Just a quick note though, on <code class=\"language-plaintext highlighter-rouge\">Host</code> if you are using <code class=\"language-plaintext highlighter-rouge\">Linux</code> <code class=\"language-plaintext highlighter-rouge\">'localhost'</code> will work but, if you are on <code class=\"language-plaintext highlighter-rouge\">Windows / Mac</code> replace <code class=\"language-plaintext highlighter-rouge\">localhost</code> with <code class=\"language-plaintext highlighter-rouge\">IP Docker Machine</code> is running on. Before you click Debug make sure you already executed your application with <em>meta information</em>.If you change the <code class=\"language-plaintext highlighter-rouge\">address</code> option when you added <em>meta information</em> just replace the port number with same.</p><p>You should be able to debug your application. If you were stuck on some step please comment below.</p><h3 id=\"some-references\">Some references</h3><ul>  <li><a href=\"http://stackoverflow.com/questions/39469438/how-to-execute-spring-bootrun-from-terminal-for-remote-debugging\">Remote Debugging Maven Spring Boot</a></li>  <li><a href=\"http://stackoverflow.com/questions/138511/what-are-java-command-line-options-to-set-to-allow-jvm-to-be-remotely-debugged\">Remote Debugging Options</a></li></ul>",
            "url": "https://babal.dev/2016/10/03/debugging-java-application",
            
            
            
            "tags": ["java","docker"],
            
            "date_published": "2016-10-03T00:00:00-04:00",
            "date_modified": "2016-10-03T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://babal.dev/2016/10/02/post-construct",
            "title": "@PostConstruct",
            "summary": "What and where can we use PostConstruct",
            "content_text": "In this article we will talk about @PostConstruct. Let’s start with simple example@Service@Slf4jpublic class SomeServiceImpl implements SomeService{    public SomeServiceImpl(){        log.info(\"From constructor\");    }    @PostConstruct    public void postConstruct(){        log.info(\"From PostConstruct\");    }}If we run our application we will see output displayed on following sequenceFrom constructorFrom PostConstructFrom the output we can see that method annotated with @PostConstruct is called after the Constructor.@PostConstruct is an annotation which can be used on a method that needs to be executed after dependency injection is done to perform any initialization. So method annotated with @PostConstruct are called after the Constructor and after all the dependency of the class are resolved too. This kind of behaviour is not much important when we are doing Constructor Injection. But if we are using Setter or Field Injection then dependency of the class may not be resolved when Constructor is invoked. For example@Service@Slf4jpublic class SomeServiceImpl implements SomeService{    @Autowired    SomeRepository someRepository;    public SomeServiceImpl(){        someRepository.someMethod();        log.info(\"From constructor\");    }    @PostConstruct    public void postConstruct(){        log.info(\"From PostConstruct\");    }}In above code we are Autowiring (Field Injection)  SomeRepository and we are calling the method of someRepository on Constructor. If we try to run this program then we will get a NullPointerException on Line Number 9. When Constructor is invoked SomeRepository is not yet resolved and is still null.If we move the method call from Constructor to @PostConstruct like below@Service@Slf4jpublic class SomeServiceImpl implements SomeService{    @Autowired    SomeRepository someRepository;    public SomeServiceImpl(){        log.info(\"From constructor\");    }    @PostConstruct    public void postConstruct(){        someRepository.someMethod();        log.info(\"From PostConstruct\");    }}all the dependencies will be resolve and instance of someRepository will not be null when @PostConstruct is called.Some Key Points  @PostConstruct is called after Constructor  By the time @PostConstruct is called all the dependencies of the class will already be resolved  Can be annotated for one method per class  The method on which @PostConstruct is applied MAY be public, protected, package private or private.  The method MUST NOT be static except for the application client.  The method MAY be final.Click here for more information",
            "content_html": "<p>In this article we will talk about <code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code>. Let’s start with simple example</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@Service</span><span class=\"nd\">@Slf4j</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SomeServiceImpl</span> <span class=\"kd\">implements</span> <span class=\"nc\">SomeService</span><span class=\"o\">{</span>    <span class=\"kd\">public</span> <span class=\"nf\">SomeServiceImpl</span><span class=\"o\">(){</span>        <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"na\">info</span><span class=\"o\">(</span><span class=\"s\">\"From constructor\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span>    <span class=\"nd\">@PostConstruct</span>    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">postConstruct</span><span class=\"o\">(){</span>        <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"na\">info</span><span class=\"o\">(</span><span class=\"s\">\"From PostConstruct\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>If we run our application we will see output displayed on following sequence</p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>From constructorFrom PostConstruct</code></pre></div></div><p>From the output we can see that method annotated with <code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code> is called after the <code class=\"language-plaintext highlighter-rouge\">Constructor</code>.</p><p><code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code> is an annotation which can be used on a method that needs to be executed after <em>dependency injection</em> is done to perform any <em>initialization</em>. So method annotated with <code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code> are called after the <code class=\"language-plaintext highlighter-rouge\">Constructor</code> and after all the dependency of the class are resolved too. This kind of behaviour is not much important when we are doing <strong>Constructor Injection</strong>. But if we are using <strong>Setter or Field Injection</strong> then dependency of the class may not be resolved when <code class=\"language-plaintext highlighter-rouge\">Constructor</code> is invoked. For example</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@Service</span><span class=\"nd\">@Slf4j</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SomeServiceImpl</span> <span class=\"kd\">implements</span> <span class=\"nc\">SomeService</span><span class=\"o\">{</span>    <span class=\"nd\">@Autowired</span>    <span class=\"nc\">SomeRepository</span> <span class=\"n\">someRepository</span><span class=\"o\">;</span>    <span class=\"kd\">public</span> <span class=\"nf\">SomeServiceImpl</span><span class=\"o\">(){</span>        <span class=\"n\">someRepository</span><span class=\"o\">.</span><span class=\"na\">someMethod</span><span class=\"o\">();</span>        <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"na\">info</span><span class=\"o\">(</span><span class=\"s\">\"From constructor\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span>    <span class=\"nd\">@PostConstruct</span>    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">postConstruct</span><span class=\"o\">(){</span>        <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"na\">info</span><span class=\"o\">(</span><span class=\"s\">\"From PostConstruct\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>In above code we are <code class=\"language-plaintext highlighter-rouge\">Autowiring</code> <strong>(Field Injection)</strong>  <code class=\"language-plaintext highlighter-rouge\">SomeRepository</code> and we are calling the method of <em>someRepository</em> on <code class=\"language-plaintext highlighter-rouge\">Constructor</code>. If we try to run this program then we will get a <code class=\"language-plaintext highlighter-rouge\">NullPointerException</code> on Line Number 9. When <code class=\"language-plaintext highlighter-rouge\">Constructor</code> is invoked <code class=\"language-plaintext highlighter-rouge\">SomeRepository</code> is not yet resolved and is still <code class=\"language-plaintext highlighter-rouge\">null</code>.</p><p>If we move the <em>method call</em> from <code class=\"language-plaintext highlighter-rouge\">Constructor</code> to <code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code> like below</p><div class=\"language-java highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nd\">@Service</span><span class=\"nd\">@Slf4j</span><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SomeServiceImpl</span> <span class=\"kd\">implements</span> <span class=\"nc\">SomeService</span><span class=\"o\">{</span>    <span class=\"nd\">@Autowired</span>    <span class=\"nc\">SomeRepository</span> <span class=\"n\">someRepository</span><span class=\"o\">;</span>    <span class=\"kd\">public</span> <span class=\"nf\">SomeServiceImpl</span><span class=\"o\">(){</span>        <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"na\">info</span><span class=\"o\">(</span><span class=\"s\">\"From constructor\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span>    <span class=\"nd\">@PostConstruct</span>    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">postConstruct</span><span class=\"o\">(){</span>        <span class=\"n\">someRepository</span><span class=\"o\">.</span><span class=\"na\">someMethod</span><span class=\"o\">();</span>        <span class=\"n\">log</span><span class=\"o\">.</span><span class=\"na\">info</span><span class=\"o\">(</span><span class=\"s\">\"From PostConstruct\"</span><span class=\"o\">);</span>    <span class=\"o\">}</span><span class=\"o\">}</span></code></pre></div></div><p>all the dependencies will be resolve and instance of <code class=\"language-plaintext highlighter-rouge\">someRepository</code> will not be <code class=\"language-plaintext highlighter-rouge\">null</code> when <code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code> is called.</p><h1 id=\"some-key-points\">Some Key Points</h1><ul>  <li><code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code> is called after <code class=\"language-plaintext highlighter-rouge\">Constructor</code></li>  <li>By the time <code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code> is called all the dependencies of the class will already be resolved</li>  <li>Can be annotated for one method per class</li>  <li>The method on which <code class=\"language-plaintext highlighter-rouge\">@PostConstruct</code> is applied <strong>MAY</strong> be <code class=\"language-plaintext highlighter-rouge\">public, protected, package private or private</code>.</li>  <li>The method <strong>MUST NOT</strong> be <code class=\"language-plaintext highlighter-rouge\">static</code> except for the application client.</li>  <li>The method <strong>MAY</strong> be <code class=\"language-plaintext highlighter-rouge\">final</code>.</li></ul><p><a href=\"http://docs.oracle.com/javaee/7/api/javax/annotation/PostConstruct.html\">Click here for more information</a></p>",
            "url": "https://babal.dev/2016/10/02/post-construct",
            
            
            
            "tags": ["spring-boot","spring","java"],
            
            "date_published": "2016-10-02T00:00:00-04:00",
            "date_modified": "2016-10-02T00:00:00-04:00",
            
                "author":  {
                "name": "Aman Tuladhar",
                "url": null,
                "avatar": null
                }
                
            
        }
    
    ]
}